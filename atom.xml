<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Sander Lee</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://lisongda.com/"/>
  <updated>2018-11-21T07:28:23.135Z</updated>
  <id>http://lisongda.com/</id>
  
  <author>
    <name>Sander Lee</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Androidè¾“å…¥æ³•ä»é›¶åˆ°ä¸€ç³»åˆ—ï¼ˆä¹‹ä¸€ï¼‰</title>
    <link href="http://lisongda.com/2018/10/30/Android%E8%BE%93%E5%85%A5%E6%B3%95%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E7%B3%BB%E5%88%97%EF%BC%88%E4%B9%8B%E4%B8%80%EF%BC%89/"/>
    <id>http://lisongda.com/2018/10/30/Androidè¾“å…¥æ³•ä»é›¶åˆ°ä¸€ç³»åˆ—ï¼ˆä¹‹ä¸€ï¼‰/</id>
    <published>2018-10-30T07:14:41.000Z</published>
    <updated>2018-11-21T07:28:23.135Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç³»åˆ—å°†ä¼šå®Œæ•´å®ç°ä¸€ä¸ªè¾“å…¥æ³•ã€‚</p><h2 id="åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon"><a href="#åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon" class="headerlink" title="åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon"></a>åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 27</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.lee.lim&quot;</span><br><span class="line">        minSdkVersion 19</span><br><span class="line">        targetSdkVersion 27</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line">        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>appä¸‹build.gradleæ–‡ä»¶éƒ¨åˆ†å†…å®¹å¦‚ä¸Šï¼ŒåŒ…å<code>com.lee.lim</code>,<code>targetSdkVersion</code>ä¸º27ã€‚</p><h3 id="æ·»åŠ icon"><a href="#æ·»åŠ icon" class="headerlink" title="æ·»åŠ icon"></a>æ·»åŠ icon</h3><p><code>File-&gt;New-&gt;Image Asset</code>æ‰“å¼€<code>Asset Studio</code>:</p><p><img src="/images/asset_studio1.png" alt=""></p><p>åœ¨è¿™é‡Œè®¾ç½®å‰æ™¯å›¾å±‚å’ŒèƒŒæ™¯å›¾å±‚ã€‚å…·ä½“å¦‚ä½•è®¾ç½®ï¼Œå‚è§<a href="https://developer.android.com/studio/write/image-asset-studio" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚<br>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/images/assetStudio2.png" alt=""></p><p>ç‚¹å‡»<code>next</code>ï¼Œç„¶åç‚¹å‡» <code>Finish</code>ã€‚æœ€åçœ‹ä¸‹è¿è¡Œåçš„iconæ•ˆæœï¼š</p><p><img src="/images/icon.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°é’ˆå¯¹Android 8.1ç³»ç»Ÿå·²ç»åšå‡ºäº†iconé€‚é…ã€‚</p><p>ä»¥ä¸Šä»£ç <a href="https://github.com/Brooks0129/LowInputMethod/releases/tag/%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B9%B6%E6%B7%BB%E5%8A%A0icon" target="_blank" rel="noopener">åœ°å€</a>ã€‚</p><h2 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ³•"><a href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ³•" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ³•"></a>åˆ›å»ºä¸€ä¸ªç®€å•çš„è¾“å…¥æ³•</h2><h2 id="å¼•å¯¼ç”¨æˆ·æ‰“å¼€è¾“å…¥æ³•"><a href="#å¼•å¯¼ç”¨æˆ·æ‰“å¼€è¾“å…¥æ³•" class="headerlink" title="å¼•å¯¼ç”¨æˆ·æ‰“å¼€è¾“å…¥æ³•"></a>å¼•å¯¼ç”¨æˆ·æ‰“å¼€è¾“å…¥æ³•</h2>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬ç³»åˆ—å°†ä¼šå®Œæ•´å®ç°ä¸€ä¸ªè¾“å…¥æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon&quot;&gt;&lt;a href=&quot;#åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon&quot;&gt;&lt;/a&gt;åˆ›å»ºé¡¹ç›®å¹¶æ·»åŠ icon&lt;/h2&gt;&lt;figure class=
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="è¾“å…¥æ³•" scheme="http://lisongda.com/tags/%E8%BE%93%E5%85%A5%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Androidä½¿ç”¨EmojiCompatå…¼å®¹Emojiè¡¨æƒ…</title>
    <link href="http://lisongda.com/2018/06/07/Android%E4%BD%BF%E7%94%A8EmojiCompat%E5%85%BC%E5%AE%B9Emoji%E8%A1%A8%E6%83%85/"/>
    <id>http://lisongda.com/2018/06/07/Androidä½¿ç”¨EmojiCompatå…¼å®¹Emojiè¡¨æƒ…/</id>
    <published>2018-06-07T12:31:27.000Z</published>
    <updated>2018-06-08T04:27:41.970Z</updated>
    
    <content type="html"><![CDATA[<p>ç§»åŠ¨è®¾å¤‡ä¹‹é—´æ–‡å­—èŠå¤©å¯ä»¥è‡ªç”±ä½¿ç”¨Emojiè¡¨æƒ…ï¼Œä½†æ˜¯åœ¨ä¸€äº›ä½ç‰ˆæœ¬çš„Androidè®¾å¤‡ä¸Šï¼Œå¦‚æœæ¥æ”¶åˆ°æ— æ³•è¯†åˆ«çš„emojiå­—ç¬¦ï¼Œå°±ä¼šæ˜¾ç¤ºä¹±ç <code>â˜</code>ã€‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­å°±å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéƒ¨åˆ†æ‰‹æœºæ— æ³•è¯†åˆ«å¯¹æ–¹å‘æ¥çš„Emojiè¡¨æƒ…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/25.png" alt=""></p><p>ä¸Šå›¾æ˜¯Emojiè¡¨æƒ…çš„å‘é€æ–¹ï¼ˆå°ç±³æ‰‹æœºï¼‰ï¼Œä¸€å…±æ¶‰åŠåˆ°å››ä¸ªEmojiè¡¨æƒ…ã€‚</p><p>å†çœ‹ä¸‹Emojiè¡¨æƒ…çš„æ¥æ”¶æ–¹ï¼ˆMotorolaï¼‰ï¼š</p><p><img src="/images/26.png" alt=""></p><p>æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œé™¤äº†ğŸ˜Šï¼Œå…¶ä»–Emojiè¡¨æƒ…å…¨éƒ¨æ˜¾ç¤ºä¸å‡ºæ¥ã€‚</p><p>è€Œæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/images/27.png" alt=""></p><p><code>EmojiCompat</code>å…¼å®¹åº“æä¾›äº†å‘ä¸‹å…¼å®¹çš„Emojiè¡¨æƒ…ï¼Œä½¿å…¶å¯ä»¥åœ¨Android 4.4ï¼ˆAPI 19ï¼‰åŠä»¥ä¸Šç‰ˆæœ¬æ­£å¸¸æ˜¾ç¤ºã€‚</p><p>ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>EmojiCompat</code>å®Œæˆä¸Šè¿°æ•ˆæœã€‚</p><p>æ¯ä¸ªEmojiè¡¨æƒ…å¯¹åº”ä¸€ä¸ªunicodeå­—ç¬¦ï¼Œ<code>EmojiCompat</code>åœ¨ç³»ç»Ÿå­—ä½“æ— æ³•è§£æunicodeå­—ç¬¦æ—¶ï¼Œä¼šä½¿ç”¨<code>EmojiSpans</code>æ ‡è¯†å®ƒï¼Œå¹¶ä¸”è½¬åŒ–ä¸ºemojiå›¾æ¡ˆã€‚</p><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡å‡ºè‡ªAndroidå®˜ç½‘ï¼‰ï¼š</p><p><img src="/images/28.png" alt=""></p><p>å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥é…ç½®<code>EmojiCompat</code>ï¼š</p><ul><li>Downloadable fonts configuration</li><li>Bundled fonts configuration</li></ul><h3 id="Downloadable-fonts-configuration"><a href="#Downloadable-fonts-configuration" class="headerlink" title="Downloadable fonts configuration"></a>Downloadable fonts configuration</h3><p>ä½¿ç”¨<code>the Downloadable Fonts support library</code>æ¥ä¸‹è½½Emojiå­—ä½“ã€‚å®ƒä¹Ÿä¼šæŠŠæœ€æ–°çš„Emojiçš„è¡¨æƒ…ä¸‹è½½ä¸‹æ¥ã€‚</p><p>é¦–å…ˆéœ€è¦åœ¨<code>build.gradle</code>æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    compile &quot;com.android.support:support-emoji:27.1.1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ‰§è¡Œ<code>EmojiCompat</code>åˆå§‹åŒ–çš„æ“ä½œï¼Œä¸€å…±åˆ†ä¸‰æ­¥ï¼š</p><p>1.åˆ›å»º<code>FontRequest</code>å®ä¾‹.<a href="https://developer.android.com/guide/topics/ui/look-and-feel/downloadable-fonts#top_of_page" target="_blank" rel="noopener">è¯¦è§</a></p><p>2.é€šè¿‡Contextå’Œ<code>FontRequest</code>å®ä¾‹åˆ›å»º<code>FontRequestEmojiCompatConfig</code>å®ä¾‹</p><p>3.è°ƒç”¨<code>EmojiCompat</code>çš„<code>init</code>æ–¹æ³•å®Œæˆåˆå§‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FontRequest fontRequest = <span class="keyword">new</span> FontRequest(</span><br><span class="line">              <span class="string">"com.example.fontprovider"</span>,</span><br><span class="line">              <span class="string">"com.example"</span>,</span><br><span class="line">              <span class="string">"emoji compat Font Query"</span>, CERTIFICATES);</span><br><span class="line">       EmojiCompat.Config config = <span class="keyword">new</span> FontRequestEmojiCompatConfig(<span class="keyword">this</span>, fontRequest);</span><br><span class="line">       EmojiCompat.init(config);</span><br></pre></td></tr></table></figure><p>åœ¨<code>EmojiCompat</code>åˆå§‹åŒ–åï¼Œå°†xmlæ–‡ä»¶ä¸­çš„æ§ä»¶æ›¿æ¢ä¸º<code>EmojiCompat</code>ç›¸å…³æ§ä»¶ã€‚å¦‚<code>TextView</code>-&gt;<code>EmojiTextView</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiTextView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiEditText</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiButton</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Library-components"><a href="#Library-components" class="headerlink" title="Library components"></a>Library components</h3><p>EmojiCompatåº“åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><p><img src="/images/29.png" alt=""></p><p><code>Widgets</code>ï¼š<code>EmojiEditText</code>, <code>EmojiTextView</code>, <code>EmojiButton</code></p><p><code>EmojiCompat</code>ï¼šæ ¸å¿ƒéƒ¨åˆ†ï¼Œæä¾›å¯¹å¤–æ‰€æœ‰å›è°ƒï¼Œæ˜¯è¿æ¥å„éƒ¨åˆ†çš„æ¡¥æ¢</p><p><code>EmojiCompat.Config</code>ï¼šåˆå§‹åŒ–å•ä¾‹</p><p><code>EmojiSpan</code>ï¼š<code>ReplacementSpan</code>çš„å­ç±»ï¼Œç”¨äºæ¸²æŸ“emojiè¡¨æƒ…</p><p><code>EmojiCompat Font</code>ï¼šä½¿ç”¨å­—ä½“æ¥æ˜¾ç¤ºemoji</p><h3 id="åˆå§‹åŒ–é…ç½®æ—¶çš„å¯é€‰é¡¹"><a href="#åˆå§‹åŒ–é…ç½®æ—¶çš„å¯é€‰é¡¹" class="headerlink" title="åˆå§‹åŒ–é…ç½®æ—¶çš„å¯é€‰é¡¹"></a>åˆå§‹åŒ–é…ç½®æ—¶çš„å¯é€‰é¡¹</h3><p><code>setReplaceAll()</code>ï¼šå‚æ•°å¯è®¾trueæˆ–è€…falseï¼Œå†³å®šæ˜¯å¦è¦æŠŠæ‰€æœ‰<code>EmojiSpans</code>å¯ä»¥æ‰¾åˆ°çš„emojiè¡¨æƒ…éƒ½æ›¿æ¢ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œè¡¨ç¤ºå¦‚æœç³»ç»Ÿå¯ä»¥è¯†åˆ«è¯¥emojiè¡¨æƒ…ï¼Œåˆ™ä¸æ›¿æ¢ã€‚</p><p><code>setEmojiSpanIndicatorEnabled()</code>ï¼šå‚æ•°å¯è®¾trueæˆ–è€…falseï¼Œå¦‚æœä¸ºtrueï¼Œè¡¨ç¤ºæŠŠ<code>EmojiSpan</code>è¯†åˆ«çš„emojiè¡¨æƒ…ä½¿ç”¨ç‰¹å®šçš„èƒŒæ™¯è‰²æ ‡æ ‡è¯†å‡ºæ¥ã€‚ä¸»è¦ç”¨äºè°ƒè¯•ã€‚</p><p><code>setEmojiSpanIndicatorColor()</code>ï¼šç‰¹å®šæ ‡è¯†çš„é¢œè‰²ï¼Œé»˜è®¤ä¸ºç»¿è‰²ã€‚</p><p><code>registerInitCallback</code>ï¼šæ³¨å†Œ<code>EmojiCompat</code>åˆå§‹åŒ–çš„å›è°ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EmojiCompat.Config config = <span class="keyword">new</span> FontRequestEmojiCompatConfig(...)</span><br><span class="line">       .setReplaceAll(<span class="keyword">true</span>)</span><br><span class="line">       .setEmojiSpanIndicatorEnabled(<span class="keyword">true</span>)</span><br><span class="line">       .setEmojiSpanIndicatorColor(Color.GREEN)</span><br><span class="line">       .registerInitCallback(<span class="keyword">new</span> InitCallback() &#123;...&#125;)</span><br></pre></td></tr></table></figure><h3 id="Bundled-fonts-configuration"><a href="#Bundled-fonts-configuration" class="headerlink" title="Bundled fonts configuration"></a>Bundled fonts configuration</h3><p>ä½¿ç”¨<code>Bundled fonts configuration</code>å¯ä»¥ç›´æ¥æœ¬åœ°åŠ è½½emojiå­—ä½“ï¼Œæ— éœ€ä¸‹è½½ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¼šå¢åŠ æˆ‘ä»¬çš„apkå¤§å°ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼ä¼šæŠŠemojiå­—ä½“ç›´æ¥æ”¾å…¥assetsç›®å½•ä¸‹ã€‚å¦‚å›¾ï¼š</p><p><img src="/images/30.png" alt=""></p><p>NotoColorEmojiCompatå­—ä½“è®©æˆ‘ä»¬çš„apkä½“ç§¯å¢åŠ äº†6Må¤šã€‚ã€‚ã€‚</p><p>anywayï¼Œå…ˆçœ‹çœ‹è¿™ç§æ–¹æ³•æ€ä¹ˆç”¨å§ã€‚</p><p>é¦–å…ˆä»ç„¶æ˜¯æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    compile &quot;com.android.support:support-emoji-bundled:$version&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯<code>EmojiCompat</code>çš„åˆå§‹åŒ–æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EmojiCompat.Config config = <span class="keyword">new</span> BundledEmojiCompatConfig(<span class="keyword">this</span>);</span><br><span class="line">EmojiCompat.init(config);</span><br></pre></td></tr></table></figure><p>åœ¨<code>EmojiCompat</code>åˆå§‹åŒ–åï¼Œå°†xmlæ–‡ä»¶ä¸­çš„æ§ä»¶æ›¿æ¢ä¸º<code>EmojiCompat</code>ç›¸å…³æ§ä»¶ã€‚å¦‚<code>TextView</code>-&gt;<code>EmojiTextView</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiTextView</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiEditText</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.text.emoji.widget.EmojiButton</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>/&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Using-EmojiCompat-without-widgets"><a href="#Using-EmojiCompat-without-widgets" class="headerlink" title="Using EmojiCompat without widgets"></a>Using EmojiCompat without widgets</h3><p><code>EmojiCompat</code>ä½¿ç”¨<code>EmojiSpan</code>ç”Ÿæˆemojiè¡¨æƒ…ã€‚<code>EmojiCompat</code>æä¾›äº†ä¸€ä¸ªæ–¹æ³•ç”¨äºå°†emojiå­—ç¬¦è½¬åŒ–ä¸º<code>Spanned</code>å®ä¾‹ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¤„ç†æˆ–è€…ç¼“å­˜è¿™ä¸ª<code>Spanned</code>å®ä¾‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CharSequence processed = EmojiCompat.get().process(<span class="string">"neutral face \uD83D\uDE10"</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç§»åŠ¨è®¾å¤‡ä¹‹é—´æ–‡å­—èŠå¤©å¯ä»¥è‡ªç”±ä½¿ç”¨Emojiè¡¨æƒ…ï¼Œä½†æ˜¯åœ¨ä¸€äº›ä½ç‰ˆæœ¬çš„Androidè®¾å¤‡ä¸Šï¼Œå¦‚æœæ¥æ”¶åˆ°æ— æ³•è¯†åˆ«çš„emojiå­—ç¬¦ï¼Œå°±ä¼šæ˜¾ç¤ºä¹±ç &lt;code&gt;â˜&lt;/code&gt;ã€‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­å°±å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéƒ¨åˆ†æ‰‹æœºæ— æ³•è¯†åˆ«å¯¹æ–¹å‘æ¥çš„Emojiè¡¨æƒ…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="-Android" scheme="http://lisongda.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Androidå¼€å‘å¸¸è§å®‰å…¨æ¼æ´æ€»ç»“</title>
    <link href="http://lisongda.com/2018/05/25/Android%E5%BC%80%E5%8F%91%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>http://lisongda.com/2018/05/25/Androidå¼€å‘å¸¸è§å®‰å…¨æ¼æ´æ€»ç»“/</id>
    <published>2018-05-25T13:41:03.000Z</published>
    <updated>2018-05-28T12:19:36.090Z</updated>
    
    <content type="html"><![CDATA[<h2 id="WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h2><h3 id="addJavascriptInterfaceæ¥å£"><a href="#addJavascriptInterfaceæ¥å£" class="headerlink" title="addJavascriptInterfaceæ¥å£"></a>addJavascriptInterfaceæ¥å£</h3><p>Android API level 16ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œå®‰å…¨æ¼æ´ï¼Œè¯¥æ¼æ´æºäºç¨‹åºæ²¡æœ‰æ­£ç¡®é™åˆ¶ä½¿ç”¨WebView.addJavascriptInterfaceæ–¹æ³•ï¼Œè¿œç¨‹æ”»å‡»è€…å¯é€šè¿‡ä½¿ç”¨Java Reflection APIåˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„Javaå¯¹è±¡çš„æ–¹æ³•ï¼Œç®€å•çš„è¯´å°±æ˜¯é€šè¿‡addJavascriptInterfaceç»™WebViewåŠ å…¥ä¸€ä¸ªJavaScriptæ¡¥æ¥æ¥å£ï¼ŒJavaScripté€šè¿‡è°ƒç”¨è¿™ä¸ªæ¥å£å¯ä»¥ç›´æ¥æ“ä½œæœ¬åœ°çš„JAVAæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mWebView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);  </span><br><span class="line">mWebView.addJavascriptInterface(<span class="keyword">new</span> JSInterface(), <span class="string">"jsInterface"</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘WebViewæ³¨å†Œä¸€ä¸ªåå«â€œjsInterfaceâ€çš„å¯¹è±¡ï¼Œç„¶ååœ¨JSä¸­å¯ä»¥è®¿é—®åˆ°jsInterfaceè¿™ä¸ªå¯¹è±¡ï¼Œå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ä¸€äº›æ–¹æ³•ï¼Œæœ€ç»ˆå¯ä»¥è°ƒç”¨åˆ°Javaä»£ç ä¸­ï¼Œä»è€Œå®ç°äº†JSä¸Javaä»£ç çš„äº¤äº’ã€‚</p><p>JSä¸­å¯ä»¥éå†windowå¯¹è±¡ï¼Œæ‰¾åˆ°å­˜åœ¨â€œgetClassâ€æ–¹æ³•çš„å¯¹è±¡çš„å¯¹è±¡ï¼Œç„¶åå†é€šè¿‡åå°„çš„æœºåˆ¶ï¼Œå¾—åˆ°Runtimeå¯¹è±¡ï¼Œç„¶åè°ƒç”¨é™æ€æ–¹æ³•æ¥æ‰§è¡Œä¸€äº›å‘½ä»¤ã€‚</p><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">cmdArgs</span>)  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> obj <span class="keyword">in</span> <span class="built_in">window</span>) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"getClass"</span> <span class="keyword">in</span> <span class="built_in">window</span>[obj]) &#123;  </span><br><span class="line">            alert(obj);  </span><br><span class="line">            <span class="keyword">return</span>  <span class="built_in">window</span>[obj].getClass().forName(<span class="string">"java.lang.Runtime"</span>)  </span><br><span class="line">                 .getMethod(<span class="string">"getRuntime"</span>,<span class="literal">null</span>).invoke(<span class="literal">null</span>,<span class="literal">null</span>).exec(cmdArgs);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ol><li>Google åœ¨Android 4.2 ç‰ˆæœ¬ä¸­è§„å®šå¯¹è¢«è°ƒç”¨çš„å‡½æ•°ä»¥ @JavascriptInterfaceè¿›è¡Œæ³¨è§£ä»è€Œé¿å…æ¼æ´æ”»å‡»</li><li>Android 4.2ç‰ˆæœ¬ä¹‹å‰é‡‡ç”¨æ‹¦æˆª<code>prompt()</code>è¿›è¡Œæ¼æ´ä¿®å¤ã€‚ <a href="https://blog.csdn.net/leehong2005/article/details/11808557/" target="_blank" rel="noopener">è¯¦è§</a></li></ol><h3 id="searchBoxJavaBridge-æ¥å£"><a href="#searchBoxJavaBridge-æ¥å£" class="headerlink" title="searchBoxJavaBridge_æ¥å£"></a>searchBoxJavaBridge_æ¥å£</h3><p>åœ¨Android 3.0ä»¥ä¸‹ï¼ŒAndroidç³»ç»Ÿä¼šé»˜è®¤é€šè¿‡searchBoxJavaBridge_çš„Jsæ¥å£ç»™ WebView æ·»åŠ ä¸€ä¸ªJSæ˜ å°„å¯¹è±¡ï¼šsearchBoxJavaBridge_å¯¹è±¡ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åˆ é™¤é»˜è®¤æ·»åŠ çš„â€searchBoxJavaBridge_â€ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.removeJavascriptInterface(<span class="string">"searchBoxJavaBridge_"</span>);</span><br></pre></td></tr></table></figure></p><h3 id="accessibility-å’Œ-accessibilityTraversal"><a href="#accessibility-å’Œ-accessibilityTraversal" class="headerlink" title="accessibility å’Œ accessibilityTraversal"></a>accessibility å’Œ accessibilityTraversal</h3><p>æ­¤æ¼æ´åŸç†ä¸searchBoxJavaBridge_æ¥å£è¿œç¨‹ä»£ç æ‰§è¡Œç›¸ä¼¼ï¼Œå‡ä¸ºæœªç§»é™¤ä¸å®‰å…¨çš„é»˜è®¤æ¥å£ï¼Œä¸è¿‡æ­¤æ¼æ´éœ€è¦ç”¨æˆ·å¯åŠ¨ç³»ç»Ÿè®¾ç½®ä¸­çš„ç¬¬ä¸‰æ–¹è¾…åŠ©æœåŠ¡ï¼Œåˆ©ç”¨æ¡ä»¶è¾ƒå¤æ‚ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä¸searchBoxJavaBridge_çš„è§£å†³æ–¹æ¡ˆç±»ä¼¼ï¼šå¯ä»¥è°ƒç”¨removeJavascriptInterface(â€œaccessibilityâ€) å’ŒremoveJavascriptInterface(â€œaccessibilityTraversalâ€) æ–¹æ³•ç§»é™¤è¿™ä¸¤ä¸ªé»˜è®¤æ¥å£ã€‚</p><h2 id="WebViewè·¨åŸŸè®¿é—®æ¼æ´"><a href="#WebViewè·¨åŸŸè®¿é—®æ¼æ´" class="headerlink" title="WebViewè·¨åŸŸè®¿é—®æ¼æ´"></a>WebViewè·¨åŸŸè®¿é—®æ¼æ´</h2><p>å¦‚æœä¸€ä¸ªActivityå¯ä»¥è¢«å…¶ä»–åº”ç”¨è°ƒèµ·ï¼Œä¾‹å¦‚å£°æ˜äº†<code>android:exported=&quot;true&quot;</code>ï¼Œç›¸å…³WebViewåˆå¼€å¯äº†fileåŸŸè®¿é—®ï¼ŒåŒæ—¶æœªå¯¹file åŸŸçš„è·¯å¾„è¿›è¡Œä¸¥æ ¼é™åˆ¶æ‰€è‡´ã€‚æ”»å‡»è€…é€šè¿‡URL Scheme çš„æ–¹å¼ï¼Œå¯è¿œç¨‹æ‰“å¼€å¹¶åŠ è½½æ¶æ„HTMLæ–‡ä»¶ï¼Œè¿œç¨‹è·å–APPä¸­åŒ…æ‹¬ç”¨æˆ·ç™»å½•å‡­è¯åœ¨å†…çš„æ‰€æœ‰æœ¬åœ°æ•æ„Ÿæ•°æ®ã€‚</p><p>æ¶‰åŠåˆ°ä¸‰ä¸ªæ–¹æ³•ï¼š</p><ul><li><p>setAllowFileAccess</p><p>è®¾ç½®æ˜¯å¦å…è®¸WebViewä½¿ç”¨Fileåè®®,é»˜è®¤è®¾ç½®ä¸ºtrueï¼Œå³å…è®¸åœ¨FileåŸŸä¸‹æ‰§è¡Œä»»æ„JavaScriptä»£ç ã€‚</p></li><li><p>setAllowFileAccessFromFileURLs</p><p>è®¾ç½®æ˜¯å¦å…è®¸é€šè¿‡ file url åŠ è½½çš„ Jsä»£ç è¯»å–å…¶ä»–çš„æœ¬åœ°æ–‡ä»¶ã€‚</p></li><li><p>setAllowUniversalAccessFromFileURLs</p><p>è®¾ç½®æ˜¯å¦å…è®¸é€šè¿‡ file url åŠ è½½çš„ Javascript å¯ä»¥è®¿é—®å…¶ä»–çš„æº(åŒ…æ‹¬httpã€httpsç­‰æº)ã€‚</p></li></ul><h3 id="è§£å†³æ–¹æ¡ˆ-3"><a href="#è§£å†³æ–¹æ¡ˆ-3" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1.fileåŸŸè®¿é—®ä¸ºéåŠŸèƒ½éœ€æ±‚æ—¶ï¼Œæ‰‹åŠ¨é…ç½®setAllowFileAccessFromFileURLsæˆ–setAllowUniversalAccessFromFileURLsä¸¤ä¸ªAPIä¸ºfalseã€‚ï¼ˆAndroid4.1ç‰ˆæœ¬ä¹‹å‰è¿™ä¸¤ä¸ªAPIé»˜è®¤æ˜¯trueï¼Œéœ€è¦æ˜¾å¼è®¾ç½®ä¸ºfalseï¼‰</p><p>2.è‹¥éœ€è¦å¼€å¯fileåŸŸè®¿é—®ï¼Œåˆ™è®¾ç½®fileè·¯å¾„çš„ç™½åå•ï¼Œä¸¥æ ¼æ§åˆ¶fileåŸŸçš„è®¿é—®èŒƒå›´ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰å›ºå®šä¸å˜çš„HTMLæ–‡ä»¶å¯ä»¥æ”¾åœ¨assetsæˆ–resç›®å½•ä¸‹ï¼Œ<code>file:///android_asset</code>å’Œ<code>file:///android_res</code> åœ¨ä¸å¼€å¯APIçš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥è®¿é—®ï¼›</p><p>ï¼ˆ2ï¼‰å¯èƒ½ä¼šæ›´æ–°çš„HTMLæ–‡ä»¶æ”¾åœ¨<code>/data/data/(app)</code> ç›®å½•ä¸‹ï¼Œé¿å…è¢«ç¬¬ä¸‰æ–¹æ›¿æ¢æˆ–ä¿®æ”¹ï¼›</p><p>ï¼ˆ3ï¼‰å¯¹fileåŸŸè¯·æ±‚åšç™½åå•é™åˆ¶æ—¶ï¼Œéœ€è¦å¯¹â€œ../../â€ç‰¹æ®Šæƒ…å†µè¿›è¡Œå¤„ç†ï¼Œé¿å…ç™½åå•è¢«ç»•è¿‡ã€‚<br>3.é¿å…Appå†…éƒ¨çš„WebViewè¢«ä¸ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹è°ƒç”¨ã€‚æ’æŸ¥å†…ç½®WebViewçš„ Activityæ˜¯å¦è¢«å¯¼å‡ºã€å¿…é¡»å¯¼å‡ºçš„Activityæ˜¯å¦ä¼šé€šè¿‡å‚æ•°ä¼ é€’è°ƒèµ·å†…ç½®çš„WebViewç­‰ã€‚</p><p>4.å»ºè®®è¿›ä¸€æ­¥å¯¹APPç›®å½•ä¸‹çš„æ•æ„Ÿæ•°æ®è¿›è¡Œä¿æŠ¤ã€‚å®¢æˆ·ç«¯APPåº”ç”¨è®¾å¤‡ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚IMEIã€IMSIã€Android_idç­‰ï¼‰ä½œä¸ºå¯†é’¥å¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ä½¿æ”»å‡»è€…éš¾ä»¥åˆ©ç”¨ç›¸å…³æ¼æ´è·å¾—æ•æ„Ÿä¿¡æ¯ã€‚  </p><h2 id="WebViewç»„ä»¶å¿½ç•¥SSLè¯ä¹¦éªŒè¯é”™è¯¯æ¼æ´"><a href="#WebViewç»„ä»¶å¿½ç•¥SSLè¯ä¹¦éªŒè¯é”™è¯¯æ¼æ´" class="headerlink" title="WebViewç»„ä»¶å¿½ç•¥SSLè¯ä¹¦éªŒè¯é”™è¯¯æ¼æ´"></a>WebViewç»„ä»¶å¿½ç•¥SSLè¯ä¹¦éªŒè¯é”™è¯¯æ¼æ´</h2><p>Android WebViewç»„ä»¶åŠ è½½ç½‘é¡µå‘ç”Ÿè¯ä¹¦è®¤è¯é”™è¯¯æ—¶ï¼Œä¼šè°ƒç”¨WebViewClientç±»çš„onReceivedSslErroræ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•å®ç°è°ƒç”¨äº†handler.proceed()æ¥å¿½ç•¥è¯¥è¯ä¹¦é”™è¯¯ï¼Œåˆ™ä¼šå—åˆ°ä¸­é—´äººæ”»å‡»çš„å¨èƒï¼Œå¯èƒ½å¯¼è‡´éšç§æ³„éœ²ã€‚</p><p>å®ç°onReceivedSslErrorçš„å¤„ç†ï¼Œæ¼æ´ä»£ç æ ·ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler, SslError error)</span> </span>&#123;</span><br><span class="line">                handler.proceed(); <span class="comment">// Ignore SSL certificate errors</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç åœ¨onReceivedSslErrorå¤„ç†æ—¶æ²¡æœ‰è¿›è¡Œcancelï¼Œè¿˜æ˜¯ä½¿ç”¨äº†proceed()ï¼Œå¿½ç•¥æ‰äº†å‘ç”Ÿçš„SSLå¼‚å¸¸ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-4"><a href="#è§£å†³æ–¹æ¡ˆ-4" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1.éæµè§ˆå™¨ç±»appï¼Œæœ‰æ¡ä»¶çš„å¯ä»¥ç”³è¯·æ­£å¼çš„caè¯ä¹¦ï¼Œæ²¡æ¡ä»¶çš„å¯ä»¥åœ¨å®¢æˆ·ç«¯ä¸­æ·»åŠ è¯ä¹¦,åˆ‡å‹¿ä¿¡ä»»æ‰€æœ‰è¯ä¹¦æˆ–è€…å¿½ç•¥sslè¯ä¹¦è®¤è¯é”™è¯¯ã€‚</p><p>2.æµè§ˆå™¨ appï¼Œä¸¥æ ¼æŒ‰ç…§å®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡å™¨è¯ä¹¦æµç¨‹å¤„ç†</p><pre><code>1) å®¢æˆ·ç«¯éœ€è¦æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ2) è¯ä¹¦ç­¾å‘çš„ CA æ˜¯å¦å¯é 3) CA çš„å…¬é’¥èƒ½å¦æ­£ç¡®è§£å¼€æœåŠ¡å™¨è¯ä¹¦çš„ CA æ•°å­—ç­¾åï¼Œå¯¹è¯ä¹¦çš„ç­¾åå€¼çš„æœ‰æ•ˆæ€§åšéªŒè¯4) æœåŠ¡å™¨è¯ä¹¦ä¸Šçš„åŸŸåæ˜¯å¦å’ŒæœåŠ¡å™¨çš„å®é™…åŸŸåç›¸åŒ¹é…</code></pre><p>3.é‡è½½äº† onReceivedSslError æ–¹æ³•å¤„ç†æ—¶ä½¿ç”¨ cancel æ–¹æ³•æ¥åœæ­¢åŠ è½½ ssl éªŒè¯é”™è¯¯çš„é¡µé¢ï¼Œå¦‚ä¸‹ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler, SslError error)</span> </span>&#123;</span><br><span class="line">                handler.cancel(); <span class="comment">// Ignore SSL certificate errors</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h2 id="WebViewå¯†ç æ˜æ–‡ä¿å­˜æ¼æ´"><a href="#WebViewå¯†ç æ˜æ–‡ä¿å­˜æ¼æ´" class="headerlink" title="WebViewå¯†ç æ˜æ–‡ä¿å­˜æ¼æ´"></a>WebViewå¯†ç æ˜æ–‡ä¿å­˜æ¼æ´</h2><p>åœ¨ä½¿ç”¨WebViewçš„è¿‡ç¨‹ä¸­å¿½ç•¥äº†<code>WebView setSavePassword</code>ï¼Œå½“ç”¨æˆ·é€‰æ‹©ä¿å­˜åœ¨WebViewä¸­è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™ä¼šè¢«æ˜æ–‡ä¿å­˜åˆ°åº”ç”¨æ•°æ®ç›®å½•çš„<code>databases/webview.db</code>ä¸­ã€‚å¦‚æœæ‰‹æœºè¢«rootå°±å¯ä»¥è·å–æ˜æ–‡ä¿å­˜çš„å¯†ç ï¼Œé€ æˆç”¨æˆ·çš„ä¸ªäººæ•æ„Ÿæ•°æ®æ³„éœ²ã€‚</p><p>å¦‚æœä»£ç ä¸­æ²¡æœ‰æ˜¾ç¤ºè°ƒç”¨<code>setSavePassword(false)</code> ï¼Œé»˜è®¤ä¸ºtrueã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-5"><a href="#è§£å†³æ–¹æ¡ˆ-5" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä½¿ç”¨<code>WebView.getSettings().setSavePassword(false)</code>æ¥ç¦æ­¢ä¿å­˜å¯†ç ã€‚</p><h2 id="æœ¬åœ°ç«¯å£å¼€æ”¾è¶Šæƒé£é™©"><a href="#æœ¬åœ°ç«¯å£å¼€æ”¾è¶Šæƒé£é™©" class="headerlink" title="æœ¬åœ°ç«¯å£å¼€æ”¾è¶Šæƒé£é™©"></a>æœ¬åœ°ç«¯å£å¼€æ”¾è¶Šæƒé£é™©</h2><p>Androidåº”ç”¨é€šå¸¸ä½¿ç”¨<code>PF_UNIX</code>ã€<code>PF_INET</code>ã€<code>PF_NETLINK</code>ç­‰ä¸åŒdomainçš„socketæ¥è¿›è¡Œæœ¬åœ°IPCæˆ–è€…è¿œç¨‹ç½‘ç»œé€šä¿¡ï¼Œè¿™äº›æš´éœ²çš„socketä»£è¡¨äº†æ½œåœ¨çš„æœ¬åœ°æˆ–è¿œç¨‹æ”»å‡»é¢ï¼Œå†å²ä¸Šä¹Ÿå‡ºç°è¿‡ä¸å°‘åˆ©ç”¨socketè¿›è¡Œæ‹’ç»æœåŠ¡ã€rootææƒæˆ–è€…è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ¡ˆä¾‹ã€‚ç‰¹åˆ«æ˜¯PF_INETç±»å‹çš„ç½‘ç»œsocketï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œä¸Androidåº”ç”¨é€šä¿¡ï¼Œå…¶åŸæœ¬ç”¨äºlinuxç¯å¢ƒä¸‹å¼€æ”¾ç½‘ç»œæœåŠ¡ï¼Œç”±äºç¼ºä¹å¯¹ç½‘ç»œè°ƒç”¨è€…èº«ä»½æˆ–è€…æœ¬åœ°è°ƒç”¨è€…idã€permissionç­‰ç»†ç²’åº¦çš„å®‰å…¨æ£€æŸ¥æœºåˆ¶ï¼Œåœ¨å®ç°ä¸å½“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çªç ´Androidçš„æ²™ç®±é™åˆ¶ï¼Œä»¥è¢«æ”»å‡»åº”ç”¨çš„æƒé™æ‰§è¡Œå‘½ä»¤ï¼Œé€šå¸¸å‡ºç°æ¯”è¾ƒä¸¥é‡çš„æ¼æ´ã€‚</p><p>å¦‚æœæ²¡æœ‰å¯¹æ”¶åˆ°çš„socketå’Œå†…å®¹åšä»»ä½•æ ¡éªŒæ£€æŸ¥ï¼Œä¼šç»•è¿‡androidå„ç§å®‰å…¨æœºåˆ¶ä»¥è¢«æ”»å‡»çš„åº”ç”¨çš„æƒé™æ‰§è¡Œã€‚æŸäº›æƒ…å†µä¸‹ä¼šç›´æ¥å¯¼è‡´è¿œç¨‹å‘½ä»¤ä»»æ„æ‰§è¡Œï¼ŒåŒç†ä½¿ç”¨UDPé€šä¿¡ä½¿ç”¨ä¸Šè¿°é€»è¾‘çš„ä»£ç ä¹Ÿä¼šå­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-6"><a href="#è§£å†³æ–¹æ¡ˆ-6" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ç›´æ¥ä¼ é€’å‘½ä»¤å­—æˆ–è€…é—´æ¥å¤„ç†æœ‰æ•æ„Ÿä¿¡æ¯æˆ–æ“ä½œæ—¶ï¼Œé¿å…ä½¿ç”¨socketå®ç°ï¼Œä½¿ç”¨èƒ½å¤Ÿæ§åˆ¶æƒé™æ ¡éªŒèº«ä»½çš„æ–¹å¼é€šè®¯ã€‚</p><h2 id="Content-Providerç›®å½•éå†æ¼æ´"><a href="#Content-Providerç›®å½•éå†æ¼æ´" class="headerlink" title="Content Providerç›®å½•éå†æ¼æ´"></a>Content Providerç›®å½•éå†æ¼æ´</h2><p>åœ¨ä½¿ç”¨<code>Content Provider</code>æ—¶ï¼Œå°†ç»„ä»¶å¯¼å‡ºï¼Œæä¾›äº†openfileæ¥å£ã€‚åœ¨ä½¿ç”¨<code>Content Provider</code>æ—¶ï¼Œå°†ç»„ä»¶å¯¼å‡ºï¼Œå¹¶ä¸”å®ç°äº†OpenFileæ¥å£ã€‚ç”±äºå¯¹URIè·¯å¾„æ²¡æœ‰åšç›¸åº”è¿‡æ»¤ï¼Œå¯¼è‡´ç›®å½•éå†ï¼Œé€ æˆä¿¡æ¯æ³„æ¼ä»¥åŠè¿œç¨‹ä»£ç æ‰§è¡Œé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//  é‡å†™è¯¥æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ParcelFileDescriptor <span class="title">openFile</span><span class="params">(Uri uri, String mode)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(getContext().getFilesDir(),uri.getPath());</span><br><span class="line">        <span class="keyword">if</span>(file.exists())&#123;</span><br><span class="line">            <span class="keyword">return</span> ParcelFileDescriptor.open(file, ParcelFileDescriptor.MODE_READ_ONLY);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException(uri.getPath());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ„é€ <code>../../../../../system/etc/hosts</code>URIè·¯å¾„ï¼Œå¦‚æœè¯¥providerå¯¼å‡ºæˆ–è€…è®¾ç½®äº†protectåŠä»¥ä¸‹æƒé™ï¼Œå°†ä¼šè¯»å‡ºhostsæ–‡ä»¶çš„å†…å®¹ã€‚å¦‚æœè¯»å–äº†APP dataç›®å½•ä¸‹çš„æ–‡ä»¶å°†ä¼šå¯¼è‡´éšç§çš„æ³„æ¼ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-7"><a href="#è§£å†³æ–¹æ¡ˆ-7" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ul><li>Providerä¸éœ€è¦å¯¼å‡ºï¼Œè¯·å°†exportå±æ€§è®¾ç½®ä¸ºfalseï¼›</li><li>è‹¥å¯¼å‡ºä»…ä¸ºå†…éƒ¨é€šä¿¡ä½¿ç”¨ï¼Œåˆ™è®¾ç½®<code>protectionLevel=signature</code>ï¼›</li><li>è‹¥<code>Openfile</code>æ¥å£ä¸éœ€è¦å®ç°ï¼Œè¯·ç§»é™¤è¯¥æ¥å£çš„å®ç°ï¼›</li><li>è‹¥ç¡®å®éœ€è¦Openfileæ¥å£ï¼Œè¯·å¯¹URIä¸­å¦‚../ï¼Œå¯èƒ½å¼•å‘éå†çš„è·¯å¾„å­—ç¬¦åšç›¸åº”è¿‡æ»¤ã€‚</li></ul><h2 id="SQLæ³¨å…¥æ¼æ´"><a href="#SQLæ³¨å…¥æ¼æ´" class="headerlink" title="SQLæ³¨å…¥æ¼æ´"></a>SQLæ³¨å…¥æ¼æ´</h2><p>  å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œæ—¶ï¼Œç¨‹åºæ²¡æœ‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œæœªé‡‡ç”¨å‚æ•°åŒ–æŸ¥è¯¢çš„æ–¹å¼ï¼Œå¯èƒ½å¯¼è‡´sqlæ³¨å…¥æ”»å‡»ã€‚è¿™æ ·æ”»å‡»è€…å¯ä»¥ç²¾å¿ƒæ„é€ selectionã€projectionå‚æ•°ç­‰sqlè¯­å¥ç»„æˆéƒ¨åˆ†ï¼Œå®ç°åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹ä»æ•°æ®åº“è·å–æ›´å¤šçš„ä¿¡æ¯ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-8"><a href="#è§£å†³æ–¹æ¡ˆ-8" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ul><li>Providerä¸éœ€è¦å¯¼å‡ºï¼Œè¯·å°†exportå±æ€§è®¾ç½®ä¸ºfalse</li><li>è‹¥å¯¼å‡ºä»…ä¸ºå†…éƒ¨é€šä¿¡ä½¿ç”¨ï¼Œåˆ™è®¾ç½®protectionLevel=signature</li><li>ä¸ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„æŸ¥è¯¢è¯­å¥ç”¨äºprojectionå’Œselectionï¼Œä½¿ç”¨ç”±queryç»‘å®šçš„å‚æ•°selectionArgs</li><li>å®Œå¤‡çš„SQLæ³¨å…¥è¯­å¥æ£€æµ‹é€»è¾‘  </li></ul><h2 id="ZIPæ–‡ä»¶è§£å‹ç›®å½•éå†é£é™©"><a href="#ZIPæ–‡ä»¶è§£å‹ç›®å½•éå†é£é™©" class="headerlink" title="ZIPæ–‡ä»¶è§£å‹ç›®å½•éå†é£é™©"></a>ZIPæ–‡ä»¶è§£å‹ç›®å½•éå†é£é™©</h2><p>ç”±äºzipå…è®¸å…¶ä¸­çš„æ–‡ä»¶å«æœ‰ <code>.</code>, <code>/</code>, <code>Â¥</code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå½“ä»ä¸å®‰å…¨çš„æ¥æºå¦‚HTTPä¸‹è½½æˆ–è€…SDKå¡è·å¾—ZIPæ ¼å¼æ–‡ä»¶å¹¶è§£å‹ç¼©æ—¶ï¼Œå¦‚æœè¯¥ZIPæ–‡ä»¶è¢«åŠ«æŒæ’å…¥æ¶æ„ä»£ç ï¼Œä¸”æ²¡æœ‰ç¦æ­¢ZIPç›®å½•éå†ï¼Œå¯èƒ½å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>å¦‚æœè§£å‹è·¯å¾„ä¸­åŒ…å«../å­—ç¬¦ä¸²ï¼Œå°±ä¼šé€ æˆç›®å½•çš„éå†é—®é¢˜ï¼Œä¸€æ—¦é­åˆ°ä¸­é—´äººæ”»å‡»æ›¿æ¢ä¸‹è½½çš„æ–‡ä»¶ï¼Œå°†ä¼šå¯¼è‡´æŸäº›æ¶æ„æ–‡ä»¶è¢«æ‰§è¡Œã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-9"><a href="#è§£å†³æ–¹æ¡ˆ-9" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>è§£å‹ç¼©ZIPæ ¼å¼æ–‡ä»¶æ—¶ï¼Œæ³¨æ„éªŒè¯å…¶æ¥æºå’Œå®Œæ•´æ€§ï¼Œå¹¶ç¦æ­¢è§£å‹ç›®å½•éå†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BUFFER = <span class="number">512</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOOBIG = <span class="number">0x6400000</span>; <span class="comment">// upper limit of filesize, 100MB</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TOOMANY = <span class="number">1024</span>; <span class="comment">// upper limit of entries</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">validateFilename</span><span class="params">(String filename, String intendedDir)</span> </span>&#123;</span><br><span class="line">     File f = <span class="keyword">new</span> File(filename);</span><br><span class="line">     String canonicalPath = f.getCanonicalPath();</span><br><span class="line">     File iD = <span class="keyword">new</span> File(intendedDir);</span><br><span class="line">     String canonicalID = iD.getCanonicalPath();</span><br><span class="line">     <span class="keyword">if</span> (canonicalPath.startsWith(canonicalID)) &#123;</span><br><span class="line">     <span class="keyword">return</span> canonicalPath;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"File is outside extraction target</span></span><br><span class="line"><span class="string">    directory."</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="PendingIntentåŒ…å«éšå¼Intenté£é™©"><a href="#PendingIntentåŒ…å«éšå¼Intenté£é™©" class="headerlink" title="PendingIntentåŒ…å«éšå¼Intenté£é™©"></a>PendingIntentåŒ…å«éšå¼Intenté£é™©</h2><p>PendingIntentå¯ä»¥è®©å…¶ä»–APPä¸­çš„ä»£ç åƒæ˜¯è¿è¡Œè‡ªå·±APPä¸­ã€‚PendingIntentçš„intentæ¥æ”¶æ–¹åœ¨ä½¿ç”¨è¯¥intentæ—¶ä¸å‘é€æ–¹æœ‰ç›¸åŒçš„æƒé™ã€‚åœ¨ä½¿ç”¨PendingIntentæ—¶ï¼ŒPendingIntentä¸­åŒ…è£…çš„intentå¦‚æœæ˜¯éšå¼çš„Intentï¼Œå®¹æ˜“é­åˆ°åŠ«æŒï¼Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€‚</p><p>PendingIntentå¯ä»¥è°ƒç”¨ä»¥ä¸‹å‡ ç±»ç»„ä»¶å‘é€intentï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getActivity(Context, <span class="keyword">int</span>, Intent, <span class="keyword">int</span>)</span><br><span class="line">getActivities(Context, <span class="keyword">int</span>, Intent[], <span class="keyword">int</span>)</span><br><span class="line">getBroadcast(Context, <span class="keyword">int</span>, Intent, <span class="keyword">int</span>)</span><br><span class="line">getService(Context, <span class="keyword">int</span>, Intent, <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨PendingIntentå‘é€å¹¿æ’­ï¼Œæ¼æ´ä»£ç æ ·ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(</span><br><span class="line">            <span class="string">"com.lsd.sss.action.METHOD"</span>);</span><br><span class="line">    intent.addFlags(<span class="number">32</span>);</span><br><span class="line">    intent.putExtra(<span class="string">"app"</span>,</span><br><span class="line">    PendingIntent.getBroadcast(<span class="keyword">this</span>, <span class="number">0</span>, intent, <span class="number">0</span>));</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç <code>PendingIntent.getBroadcast</code>ï¼ŒPendingItentä¸­åŒ…å«çš„Intentä¸ºéšå¼intentï¼Œå› æ­¤å½“PendingIntentè§¦å‘æ‰§è¡Œæ—¶ï¼Œå‘é€çš„intentå¾ˆå¯èƒ½è¢«å—…æ¢æˆ–è€…åŠ«æŒï¼Œå¯¼è‡´intentå†…å®¹æ³„æ¼ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-10"><a href="#è§£å†³æ–¹æ¡ˆ-10" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä½¿ç”¨PendingIntentæ—¶ï¼Œå»ºè®®ä½¿ç”¨æ˜¾ç¤ºIntentã€‚</p><h2 id="å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©"><a href="#å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©" class="headerlink" title="å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©"></a>å‰ªè´´æ¿æ•æ„Ÿä¿¡æ¯æ³„éœ²é£é™©</h2><p>åŒä¸€éƒ¨æ‰‹æœºä¸­å®‰è£…çš„å…¶ä»–appï¼Œç”šè‡³æ˜¯ä¸€äº›æƒé™ä¸é«˜çš„appï¼Œéƒ½å¯ä»¥é€šè¿‡å‰ªè´´æ¿åŠŸèƒ½è·å–å¯†ç ç®¡ç†å™¨ä¸­çš„è´¦æˆ·å¯†ç ä¿¡æ¯ã€‚åŸå› æ˜¯Androidå‰ªè´´æ¿çš„å†…å®¹å‘ä»»ä½•æƒé™çš„appå¼€æ”¾ï¼Œå¾ˆå®¹æ˜“å°±è¢«å—…æ¢æ³„å¯†ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-11"><a href="#è§£å†³æ–¹æ¡ˆ-11" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>é¿å…ä½¿ç”¨å‰ªè´´æ¿æ˜æ–‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</p><h2 id="éšæœºæ•°ä½¿ç”¨ä¸å½“æ¼æ´"><a href="#éšæœºæ•°ä½¿ç”¨ä¸å½“æ¼æ´" class="headerlink" title="éšæœºæ•°ä½¿ç”¨ä¸å½“æ¼æ´"></a>éšæœºæ•°ä½¿ç”¨ä¸å½“æ¼æ´</h2><p>å½±å“ç‰ˆæœ¬ï¼šAndroid4.2ä»¥å‰ç‰ˆæœ¬</p><p>2013å¹´æ¯”ç‰¹å¸å¼€å‘å•†åœ¨ä¸€ç¯‡åšå®¢ä¸­é€éœ²ï¼Œç”±äºAndroidç³»ç»Ÿå­˜åœ¨ä¸€å¤„å…³é”®æ¼æ´ï¼Œè¯¥å¹³å°ä¸Šçš„æ¯”ç‰¹å¸ç”µå­é’±åŒ…å¾ˆå®¹æ˜“å¤±çªƒã€‚æ¯”ç‰¹å¸å¼€å‘å•†ç§°ï¼Œè¯¥æ¼æ´å½±å“åˆ°Androidå¹³å°ä¸Šçš„æ¯ä¸€ä¸ªæ¯”ç‰¹å¸ç”µå­é’±åŒ…åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬æµè¡Œçš„æ¯”ç‰¹å¸é’±åŒ…ï¼ˆBitcoin Walletï¼‰ã€blockchain.infoé’±åŒ…ï¼ˆblockchain.info walletï¼‰ã€BitcoinSpinneré’±åŒ…ï¼ˆBitcoinSpinner Walletï¼‰å’ŒMyceliumé’±åŒ…ï¼ˆMycelium Walletï¼‰ç­‰è¯¥æ¼æ´æ˜¯ç”±äºAndroidç³»ç»Ÿéšæœºç”Ÿæˆæ•°å­—ä¸²å®‰å…¨å¯†é’¥æ—¶ï¼Œå¯¹SecureRandom ç±»çš„ä½¿ç”¨æ–¹å¼ä¸æ°å½“å¯¼è‡´çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SecureRandom secureRandom = <span class="keyword">new</span> SecureRandom(<span class="keyword">new</span> <span class="keyword">byte</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;);</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¼šå¯¼è‡´ç”Ÿæˆçš„éšæœºæ•°å¯ä»¥é¢„æµ‹ï¼Œå¯¼è‡´åç»­ä¾èµ–äºè¯¥éšæœºæ•°çš„åŠ å¯†ä¸å®‰å…¨ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-12"><a href="#è§£å†³æ–¹æ¡ˆ-12" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><ul><li>ä¸ä½¿ç”¨setSeedæ–¹æ³•</li><li>ä½¿ç”¨/dev/urandomæˆ–è€…/dev/randomæ¥åˆå§‹åŒ–ä¼ªéšæœºæ•°ç”Ÿæˆå™¨</li></ul><h2 id="SharedPreferenceå…¨å±€è¯»å†™æ¼æ´"><a href="#SharedPreferenceå…¨å±€è¯»å†™æ¼æ´" class="headerlink" title="SharedPreferenceå…¨å±€è¯»å†™æ¼æ´"></a>SharedPreferenceå…¨å±€è¯»å†™æ¼æ´</h2><p>APPåœ¨åˆ›å»ºSharedPreferenceæ—¶ï¼Œå°†æ•°æ®åº“è®¾ç½®äº†å…¨å±€çš„å¯è¯»æƒé™ï¼Œæ”»å‡»è€…æ¶æ„è¯»å–SharedPreferenceå†…å®¹ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚åœ¨è®¾ç½®SharedPreferenceå±æ€§æ—¶å¦‚æœè®¾ç½®å…¨å±€å¯å†™ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šç¯¡æ”¹ã€ä¼ªé€ å†…å®¹ï¼Œå¯ä»¥èƒ½ä¼šè¿›è¡Œè¯ˆéª—ç­‰è¡Œä¸ºï¼Œé€ æˆç”¨æˆ·è´¢äº§æŸå¤±ã€‚</p><p>ä»¥ä¸‹ä¸ºSharedPreferenceå…¨å±€è¯»å†™çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ¼æ´ä»£ç æ ·ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    SharedPreferences r_preferences = getSharedPreferences(<span class="string">"r_preferences"</span>,</span><br><span class="line">            Context.MODE_WORLD_READABLE);</span><br><span class="line">    SharedPreferences w_preferences = getSharedPreferences(<span class="string">"w_preferences"</span>,</span><br><span class="line">            Context.MODE_WORLD_WRITEABLE);</span><br><span class="line">    SharedPreferences.Editor editor = r_preferences.edit();</span><br><span class="line">    editor.putString(<span class="string">"name"</span>, <span class="string">"James"</span>);</span><br><span class="line">    editor.putString(<span class="string">"password"</span>, <span class="string">"Gosling"</span>);</span><br><span class="line">    editor.commit();</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ-13"><a href="#è§£å†³æ–¹æ¡ˆ-13" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1.ç”¨MODE_PRIVATEæ¨¡å¼åˆ›å»ºSharedPreference</p><p>2.é¿å…åœ¨SharedPreferenceä¸­å­˜å‚¨æ˜æ–‡å’Œæ•æ„Ÿä¿¡æ¯</p><h2 id="æ•°æ®åº“å…¨å±€è¯»å†™æ¼æ´"><a href="#æ•°æ®åº“å…¨å±€è¯»å†™æ¼æ´" class="headerlink" title="æ•°æ®åº“å…¨å±€è¯»å†™æ¼æ´"></a>æ•°æ®åº“å…¨å±€è¯»å†™æ¼æ´</h2><p>APPåœ¨åˆ›å»ºæ•°æ®åº“æ—¶ï¼Œå°†æ•°æ®åº“è®¾ç½®äº†å…¨å±€çš„å¯è¯»æƒé™ï¼Œæ”»å‡»è€…æ¶æ„è¯»å–æ•°æ®åº“å†…å®¹ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚åœ¨è®¾ç½®æ•°æ®åº“å±æ€§æ—¶å¦‚æœè®¾ç½®å…¨å±€å¯å†™ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šç¯¡æ”¹ã€ä¼ªé€ å†…å®¹ï¼Œå¯ä»¥èƒ½ä¼šè¿›è¡Œè¯ˆéª—ç­‰è¡Œä¸ºï¼Œé€ æˆç”¨æˆ·è´¢äº§æŸå¤±ã€‚<br>ä»¥ä¸‹ä¸ºæ•°æ®åº“å…¨å±€è¯»å†™çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œæ¼æ´ä»£ç æ ·ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        SQLiteDatabase rdb = openOrCreateDatabase(<span class="string">"all_r_db"</span>,</span><br><span class="line">                Context.MODE_WORLD_READABLE, <span class="keyword">null</span>);</span><br><span class="line">        SQLiteDatabase wdb = openOrCreateDatabase(<span class="string">"all_w_db"</span>,</span><br><span class="line">                Context.MODE_WORLD_WRITEABLE, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLiteException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ-14"><a href="#è§£å†³æ–¹æ¡ˆ-14" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1.ç”¨MODE_PRIVATEæ¨¡å¼åˆ›å»ºæ•°æ®åº“</p><p>2.ä½¿ç”¨sqlcipherç­‰å·¥å…·åŠ å¯†æ•°æ®åº“</p><p>3.é¿å…åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ˜æ–‡å’Œæ•æ„Ÿä¿¡æ¯</p><h2 id="åŠ¨æ€åŠ è½½DEXæ–‡ä»¶é£é™©"><a href="#åŠ¨æ€åŠ è½½DEXæ–‡ä»¶é£é™©" class="headerlink" title="åŠ¨æ€åŠ è½½DEXæ–‡ä»¶é£é™©"></a>åŠ¨æ€åŠ è½½DEXæ–‡ä»¶é£é™©</h2><p>Androidç³»ç»Ÿæä¾›äº†ä¸€ç§ç±»åŠ è½½å™¨<code>DexClassLoader</code>ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ‰§è¡ŒåŒ…å«åœ¨JARæˆ–APKæ–‡ä»¶å†…çš„DEXæ–‡ä»¶ã€‚åŠ¨æ€åŠ è½½DEXæ–‡ä»¶çš„å®‰å…¨é£é™©æºäºï¼šAnroid4.1ä¹‹å‰çš„ç³»ç»Ÿç‰ˆæœ¬å…è®¸APPåŠ¨æ€åŠ è½½å­˜å‚¨åœ¨å¯ä»¥è¢«å…¶ä»–åº”ç”¨è¯»å†™çš„ç›®å½•ä¸­çš„DEXæ–‡ä»¶(å¦‚sdcard)ï¼Œå› æ­¤ä¸èƒ½å¤Ÿä¿æŠ¤åº”ç”¨å…é­æ¶æ„ä»£ç çš„åŠ«æŒæ³¨å…¥ã€‚</p><p>å¦‚æœAPPå¤–éƒ¨åŠ è½½çš„DEXæ–‡ä»¶æ²¡åšå®Œæ•´æ€§æ ¡éªŒï¼Œæ‰€åŠ è½½çš„DEXæ˜“è¢«æ¶æ„åº”ç”¨æ‰€åŠ«æŒæˆ–è€…ä»£ç æ³¨å…¥ã€‚ä¸€æ—¦APPå¤–éƒ¨çš„DEXè¢«åŠ«æŒï¼Œå°†ä¼šæ‰§è¡Œæ”»å‡»è€…çš„æ¶æ„ä»£ç ï¼Œè¿›ä¸€æ­¥å®æ–½æ¬ºè¯ˆã€è·å–è´¦å·å¯†ç æˆ–å…¶ä»–æ¶æ„è¡Œä¸ºã€‚</p><p>ç›´æ¥åŠ è½½å¯ä»¥ä»»æ„è¯»å†™çš„dexã€apkæ–‡ä»¶ï¼Œæ¼æ´ä»£ç æ ·ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">String apkPath = <span class="string">"/sdcard/dynamicload.apk"</span>;</span><br><span class="line">DexClassLoader calssLoader = <span class="keyword">new</span> DexClassLoader(apkPath, dexOutputDir, libPath,</span><br><span class="line">                <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä»£ç ä¸­ç›´æ¥ä»SDCARDä¸Šè¯»å–ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹åŠ è½½çš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œè¿™ç§åšæ³•å¾ˆå®¹æ˜“é­åˆ°åŠ«æŒã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-15"><a href="#è§£å†³æ–¹æ¡ˆ-15" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1.åŠ è½½çš„APKã€DEXæ–‡ä»¶æ—¶è¦è¿›è¡Œåˆç†çš„æ ¡éªŒ</p><p>2.åŠ¨æ€åŠ è½½çš„æ–‡ä»¶åº”è¯¥å­˜å‚¨åœ¨APPæ˜¯ç§æœ‰ç›®å½•ï¼Œé˜²æ­¢æƒé™æ³›æ»¥å¯¼è‡´è¢«ç¯¡æ”¹</p><h2 id="åº”ç”¨æ•°æ®ä»»æ„å¤‡ä»½é£é™©"><a href="#åº”ç”¨æ•°æ®ä»»æ„å¤‡ä»½é£é™©" class="headerlink" title="åº”ç”¨æ•°æ®ä»»æ„å¤‡ä»½é£é™©"></a>åº”ç”¨æ•°æ®ä»»æ„å¤‡ä»½é£é™©</h2><p>å½“AndroidManifest.xmlé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æœ‰è®¾ç½®allowBackupæ ‡å¿—(é»˜è®¤ä¸ºtrue)æˆ–å°†allowBackupæ ‡å¿—è®¾ç½®ä¸ºtrueæ—¶ï¼Œåº”ç”¨ç¨‹åºçš„æ•°æ®å¯ä»¥è¢«ä»»æ„å¤‡ä»½å’Œæ¢å¤ï¼Œæ¶æ„æ”»å‡»è€…å¯ä»¥é€šè¿‡adbå·¥å…·å¤‡ä»½å¤åˆ¶åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-16"><a href="#è§£å†³æ–¹æ¡ˆ-16" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è®¾ç½®applicationçš„å±æ€§ android:allowBackup=â€falseâ€ã€‚</p><h2 id="ç¨‹åºå¯è¢«ä»»æ„è°ƒè¯•é£é™©"><a href="#ç¨‹åºå¯è¢«ä»»æ„è°ƒè¯•é£é™©" class="headerlink" title="ç¨‹åºå¯è¢«ä»»æ„è°ƒè¯•é£é™©"></a>ç¨‹åºå¯è¢«ä»»æ„è°ƒè¯•é£é™©</h2><p>åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­ android:debuggable è¢«è®¾ç½®ä¸º trueæ—¶ï¼Œåº”ç”¨ç¨‹åºçš„Javaå±‚ä»£ç å¯ä»¥è¢«è°ƒè¯•ï¼Œå­˜åœ¨æ½œåœ¨çš„é£é™©ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-17"><a href="#è§£å†³æ–¹æ¡ˆ-17" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è®¾ç½®applicationçš„å±æ€§ android:debuggable=â€falseâ€ï¼Œæˆ–è€…ä½¿ç”¨releaseæ¨¡å¼ç¼–è¯‘å‘å¸ƒçš„åº”ç”¨ç¨‹åºã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&quot;&gt;&lt;a href=&quot;#WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&quot; class=&quot;headerlink&quot; title=&quot;WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&quot;&gt;&lt;/a&gt;WebViewç»„ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´&lt;/h2&gt;&lt;h3 id=&quot;addJa
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–ç¨‹å¸¸ç”¨è¯æ±‡</title>
    <link href="http://lisongda.com/2018/05/19/%E7%BC%96%E7%A8%8B%E5%B8%B8%E7%94%A8%E8%AF%8D%E6%B1%87/"/>
    <id>http://lisongda.com/2018/05/19/ç¼–ç¨‹å¸¸ç”¨è¯æ±‡/</id>
    <published>2018-05-19T07:03:16.000Z</published>
    <updated>2018-07-17T12:30:07.923Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>è‹±æ–‡</th><th>ä¸­æ–‡</th></tr></thead><tbody><tr><td>expressiveness</td><td>è¡¨è¾¾å¼</td></tr><tr><td>scalebility</td><td>å¯æ‰©å±•æ€§</td></tr><tr><td>migration</td><td>è¿ç§»</td></tr><tr><td>footprint</td><td>å ç”¨ç©ºé—´</td></tr><tr><td>boilerplate</td><td>æ¨¡ç‰ˆ</td></tr><tr><td>wildcard</td><td>é€šé…ç¬¦</td></tr><tr><td>line-wrapped</td><td>è‡ªåŠ¨æ¢è¡Œ</td></tr><tr><td>idiomatic</td><td>ç¬¦åˆè¯­æ³•çš„</td></tr><tr><td>semicolon</td><td>åˆ†å·</td></tr><tr><td>trivial</td><td>ä¸é‡è¦çš„</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è‹±æ–‡&lt;/th&gt;
&lt;th&gt;ä¸­æ–‡&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;expressiveness&lt;/td&gt;
&lt;td&gt;è¡¨è¾¾å¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scalebility&lt;/td
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Android WebViewåŠ è½½æœ¬åœ°h5é—®é¢˜</title>
    <link href="http://lisongda.com/2018/05/14/Android-WebView%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0h5%E9%97%AE%E9%A2%98/"/>
    <id>http://lisongda.com/2018/05/14/Android-WebViewåŠ è½½æœ¬åœ°h5é—®é¢˜/</id>
    <published>2018-05-14T11:35:36.000Z</published>
    <updated>2018-05-30T07:17:30.457Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å°æ¸¸æˆå¾ˆç«çˆ†ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä»åŠå¹´å‰åˆ°ç°åœ¨ä¹Ÿé™†é™†ç»­ç»­ä¸Šäº†å‡ æ¬¾å°æ¸¸æˆï¼Œæˆ‘ä»¬çš„å°æ¸¸æˆæ˜¯é€šè¿‡h5æ–¹å¼å®ç°çš„ï¼Œä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯é€šè¿‡Androidä¸­WebViewçš„<code>loadUrl</code>æ–¹æ³•ç›´æ¥å°†h5çš„<code>index.html</code>åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯è¿™æ ·æœ€å¤§çš„é—®é¢˜å°±æ˜¯æ‰€æœ‰çš„èµ„æºï¼ˆåŒ…æ‹¬htmlã€jsã€pngç­‰ç­‰ï¼‰éƒ½è¦é€šè¿‡ç½‘ç»œåŠ è½½ï¼Œä¸€ä¸ªæ¸¸æˆæ‰€æœ‰èµ„æºå°†è¿‘3Mï¼Œæ•´ä¸ªåŠ è½½æ—¶é—´ä¹Ÿæ¯”è¾ƒè€—æ—¶ï¼Œæœ‰å¾ˆå¤šç”¨æˆ·åœ¨è¿™ä¸€é˜¶æ®µå°±æµå¤±æ‰äº†ã€‚æ‰€ä»¥PMè¿™ä¸€æœŸæçš„éœ€æ±‚å°±æ˜¯åŠ å¿«æ¸¸æˆèµ„æºçš„åŠ è½½ï¼ˆä»æŠ€æœ¯è§’åº¦æ¥è¯´è¿™ä¹Ÿæ˜¯å¿…é¡»è¦å®Œæˆçš„ï¼‰ï¼Œå®ç°æ–¹å¼æ˜¯å°†æ¸¸æˆèµ„æºæ‰“åŒ…æˆzipï¼ˆå¤§çº¦1Mï¼‰ï¼Œç›´æ¥ä¸‹è½½zipåŒ…ï¼Œç„¶åè§£å‹åˆ°æœ¬åœ°ï¼Œç„¶åWebViewç›´æ¥åŠ è½½æœ¬åœ°h5å³å¯ã€‚</p><p>ä¹ä¸€çœ‹æ–¹æ¡ˆå¾ˆå®Œç¾ï¼Œæ‰€ä»¥å°±å±é¢ å±é¢ å¼€å§‹åšäº†ã€‚</p><p>è¿‡ç¨‹åˆ†ä¸‰æ­¥ï¼š</p><blockquote><p>ä¸‹è½½zip -&gt; è§£å‹ -&gt; WebViewåŠ è½½æœ¬åœ°èµ„æº</p></blockquote><p>ç„¶è€Œé—®é¢˜å‡ºç°åœ¨ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨WebViewåŠ è½½æœ¬åœ°èµ„æºæ—¶å‡ºç°äº†é—®é¢˜ï¼šjsä¸­æç¤ºæŸäº›å˜é‡ä¸ºnullï¼å¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/19.png" alt=""></p><hr><p>å…ˆç®€å•ä»‹ç»ä¸‹å¦‚ä½•ä½¿ç”¨Chromeè°ƒè¯•Android WebViewã€‚<br>åœ¨WebViewä¸­è®¾ç½®<code>WebView.setWebContentsDebuggingEnabled(true);</code>ï¼Œç„¶åå¦‚å›¾åœ¨chromeä¸­è¾“å…¥<code>chrome://inspect/</code>ï¼Œç„¶åchromeå°±æ˜¾ç¤ºäº†æˆ‘ä»¬çš„åº”ç”¨ä»¥åŠå¯ä»¥è°ƒè¯•çš„WebViewï¼Œç‚¹å‡»å¯¹åº”çš„<code>inspect</code>å³å¯ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä½¿ç”¨chromeè¯¥åŠŸèƒ½æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹åº”ç”¨çš„æ•°æ®åº“ä¿¡æ¯ã€SharedPrederenceä¿¡æ¯ç­‰ã€‚</p><p><img src="/images/20.png" alt=""></p><p>é‚£ä¹ˆå‡ºç°è¯¥bugæœ‰æ²¡æœ‰å¯èƒ½å°±æ˜¯ç”±äºæˆ‘ä»¬çš„jsä»£ç æœ¬èº«é—®é¢˜å‘¢ï¼Ÿæˆ‘å°†æ¸¸æˆèµ„æºäº¤ç»™æœåŠ¡ç«¯åŒå­¦ï¼Œè®©ä»–ä»¬éƒ¨ç½²åˆ°æ²™æ²³ç¯å¢ƒï¼ŒæŠ‘æˆ–æ˜¯è‡ªå·±çš„ç”µè„‘ä½¿ç”¨tomcatåˆ›å»ºæœ¬åœ°æœåŠ¡ï¼Œç„¶åé€šè¿‡ç›´æ¥åŠ è½½Urlçš„æ–¹å¼éƒ½æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œæ¸¸æˆçš„ï¼Œä½†æ˜¯å°†ç›¸åŒçš„æ¸¸æˆèµ„æºpushåˆ°æ‰‹æœºå†…ï¼Œé€šè¿‡WebViewè®¿é—®å°±æ˜¯ä¸å¯ä»¥çš„ã€‚å¦å¤–ä½¿ç”¨æœ¬åœ°htmlæ–¹æ³•åŠ è½½ä¸åŒçš„æ¸¸æˆéƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—çœŸçš„ä¸æ˜¯æ¸¸æˆä»£ç æœ¬èº«çš„é—®é¢˜ï¼Œè€Œæ˜¯æˆ‘ä»¬çš„WebViewçš„æŸäº›è®¾ç½®å‡ºç°äº†é—®é¢˜ã€‚</p><p>æœ€å¼€å§‹çš„æ—¶å€™æˆ‘æ˜¯å°†æ¸¸æˆèµ„æºæ”¾ç½®åˆ°å†…éƒ¨å­˜å‚¨ï¼Œå³<code>/data/data/åŒ…å/....</code>,åæ¥æˆ‘è¯•ç€æ”¹æˆsdcardå­˜å‚¨ï¼Œä¾æ—§æ˜¯ä¸è¡Œã€‚</p><p>å†…éƒ¨å­˜å‚¨æ—¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.loadUrl(<span class="string">"file:///"</span>+CustomApp.getContext().getFilesDir()+<span class="string">"/game/index.html"</span>);</span><br></pre></td></tr></table></figure><p>å¤–éƒ¨å­˜å‚¨æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.loadUrl(<span class="string">"file:///mnt/sdcard/game/index.html"</span>);</span><br></pre></td></tr></table></figure><p>å½“çœ‹åˆ°æŠ¥é”™ä¿¡æ¯æ˜¯<code>Uncaught TypeError: Cannot read property &#39;modules&#39; of null</code>æ—¶ï¼Œç¬¬ä¸€æ„Ÿè§‰å½“ç„¶æ˜¯å»googleï¼Œ<a href="https://stackoverflow.com/questions/33079762/android-webview-uncaught-typeerror-cannot-read-property-getitem-of-null" target="_blank" rel="noopener">stackoverflow</a>ä¸ŠçœŸçš„æœ‰ç›¸å…³è§£ç­”,ç­”æ¡ˆå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebSettings settings = webView.getSettings();</span><br><span class="line">settings.setDomStorageEnabled(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><p>setDomStorageEnabledè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>DOM Storageï¼šå­˜å‚¨ä¸€äº›ç®€å•çš„ç”¨key/valueå¯¹å³å¯è§£å†³çš„æ•°æ®ï¼Œæ ¹æ®ä½œç”¨èŒƒå›´çš„ä¸åŒï¼Œæœ‰Session Storageå’ŒLocal Storageä¸¤ç§ï¼Œåˆ†åˆ«ç”¨äºä¼šè¯çº§åˆ«çš„å­˜å‚¨ï¼ˆé¡µé¢å…³é—­å³æ¶ˆå¤±ï¼‰å’Œæœ¬åœ°åŒ–å­˜å‚¨ï¼ˆé™¤éä¸»åŠ¨åˆ é™¤ï¼Œå¦åˆ™æ•°æ®æ°¸è¿œä¸ä¼šè¿‡æœŸï¼‰åœ¨Androidä¸­å¯ä»¥æ‰‹åŠ¨å¼€å¯DOM Storageï¼ˆsetDomStorageEnabledï¼‰ã€‚</p></blockquote><p>å½“æ»¡æ€€æœŸå¾…çš„è®¾ç½®è¯¥æ–¹æ³•åï¼Œç»“æœè¿˜æ˜¯ä¸å¯ä»¥ã€‚</p><p>ç»†æƒ³ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå‡ºç°å˜é‡ä¸ºnullå‘¢ï¼ŸçŒœæƒ³æ˜¯ç”±äºæ²¡æœ‰åŠ è½½åˆ°éƒ¨åˆ†èµ„æºã€‚ä¸‹é¢æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><p>æˆ‘ä»¬æ‹¿åˆ°æ­£å¸¸æƒ…å†µä¸‹çš„æ¸¸æˆçš„åŠ è½½èµ„æºï¼š<br>å¦‚å›¾ï¼š</p><p><img src="/images/23.png" alt=""></p><p>ç„¶åå†çœ‹ä¸‹å¼‚å¸¸æƒ…å†µä¸‹çš„æ¸¸æˆèµ„æºï¼š</p><p><img src="/images/22.png" alt=""></p><p>å¼‚å¸¸æƒ…å†µä¸‹ç¡®å®å°‘äº†å¾ˆå¤šå›¾ç‰‡èµ„æºï¼Œé‚£ä¹ˆæ˜¯å¦æ˜¯ç”±äºæ–‡ä»¶è®¿é—®çš„é™åˆ¶å¯¼è‡´å›¾ç‰‡èµ„æºæ— æ³•åŠ è½½ï¼Œæ‰€ä»¥æ‰ä¼šå¯¼è‡´æŸäº›å˜é‡ä¸ºnullå‘¢ï¼Ÿjsä¸­åŠ è½½èµ„æºçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res_gaming = &#123;</span><br><span class="line">background: <span class="string">"res/img/background.png"</span>,</span><br><span class="line">game_ccb: <span class="string">"res/ccb/GameCCB.ccbi"</span>,</span><br><span class="line">game_bg: <span class="string">"res/img/game_bg.png"</span>,</span><br><span class="line">img_1_png: <span class="string">"res/img/img_1.png"</span>,</span><br><span class="line">img_1_plist: <span class="string">"res/img/img_1.plist"</span>,</span><br><span class="line">lose: <span class="string">"res/img/lose.png"</span>,</span><br><span class="line">win: <span class="string">"res/img/win.png"</span>,</span><br><span class="line">time_fnt: <span class="string">"res/img/time.fnt"</span>,</span><br><span class="line">time_png: <span class="string">"res/img/time.png"</span>,</span><br><span class="line">share_plist: <span class="string">"res/img/share.plist"</span>,</span><br><span class="line">share_png: <span class="string">"res/img/share.png"</span>,</span><br><span class="line">beginFont_fnt: <span class="string">"res/img/beginFont.fnt"</span>,</span><br><span class="line">begin_ccbi: <span class="string">"res/ccb/Begin.ccbi"</span>,</span><br><span class="line">beginFont_png: <span class="string">"res/img/beginFont.png"</span></span><br><span class="line">&#125;,</span><br><span class="line">res_music = &#123;</span><br><span class="line">effect_lose: <span class="string">"res/music/effect_lose.mp3"</span>,</span><br><span class="line">effect_move: <span class="string">"res/music/effect_move.mp3"</span>,</span><br><span class="line">effect_bomb: <span class="string">"res/music/effect_bomb.mp3"</span>,</span><br><span class="line">effect_win: <span class="string">"res/music/effect_win.mp3"</span>,</span><br><span class="line">music_bg: <span class="string">"res/music/music_bg.mp3"</span>,</span><br><span class="line">UI_mp3: <span class="string">"res/music/UI.mp3"</span></span><br><span class="line">&#125;,</span><br><span class="line">res_loading = &#123;</span><br><span class="line">loading_ccb: <span class="string">"res/ccb/LoadingCCB.ccbi"</span>,</span><br><span class="line">public_png: <span class="string">"res/img/public.png"</span>,</span><br><span class="line">public_plist: <span class="string">"res/img/public.plist"</span>,</span><br><span class="line">background: <span class="string">"res/img/background.png"</span>,</span><br><span class="line">loading_plist: <span class="string">"res/img/loading.plist"</span>,</span><br><span class="line">loading_png: <span class="string">"res/img/loading.png"</span>,</span><br><span class="line">loading_1_png: <span class="string">"res/img/loading_1.png"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>å…ˆä¸ç®¡è¿™ä¸ªæ€è·¯å¯¹ä¸å¯¹ï¼Œå¤§èƒ†çš„å°è¯•æ€»å¥½è¿‡äºåŸåœ°è¸æ­¥ã€‚</p><p>æˆ‘å‘ç°WebViewæœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// è®¾ç½®æ˜¯å¦å…è®¸ WebView ä½¿ç”¨ File åè®®</span></span><br><span class="line">mWebView.getSettings().setAllowFileAccess(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®æ˜¯å¦å…è®¸é€šè¿‡ file url åŠ è½½çš„ Jsä»£ç è¯»å–å…¶ä»–çš„æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">mWebView.getSettings().setAllowFileAccessFromFileURLs(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®æ˜¯å¦å…è®¸é€šè¿‡ file url åŠ è½½çš„ Javascript å¯ä»¥è®¿é—®å…¶ä»–çš„æº(åŒ…æ‹¬httpã€httpsç­‰æº)</span></span><br><span class="line">mWebView.getSettings().setAllowUniversalAccessFromFileURLs(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><p>çœ‹æ–¹æ³•åå­—æ˜¯æ­£åˆæˆ‘æ„å•Šï¼Œä½†æ˜¯ã€‚ã€‚ã€‚ç»“æœä¾æ—§æ²¡ç”¨ã€‚è€Œä¸”è¿™ä¸‰ä¸ªæ–¹æ³•å¥½åƒè¿˜å¯èƒ½é€ æˆå®‰å…¨æ¼æ´ã€‚è¯¦è§<a href="https://blog.csdn.net/carson_ho/article/details/64904635" target="_blank" rel="noopener">https://blog.csdn.net/carson_ho/article/details/64904635</a>ã€‚</p><p>å‘¨ä¸€ä¸Šç­åï¼Œæˆ‘ä¸åŒäº‹è®¨è®ºäº†ä¸‹è¯¥æƒ…å†µï¼Œä»”ç»†æƒ³æƒ³å…¶å®ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç¨‹åºå¼‚å¸¸æ‰€ä»¥å¯¼è‡´å›¾ç‰‡èµ„æºæ²¡æœ‰åŠ è½½ï¼Œå¦‚æœçœŸæ˜¯è¿™æ ·ï¼Œé‚£å°±æœ¬æœ«å€’ç½®äº†ã€‚</p><hr><p>åæ¥åœ¨ç½‘ä¸ŠæŸ¥é˜…Android WebViewåŠ è½½æœ¬åœ°htmlæ—¶ï¼Œå¤§å®¶ç»™å‡ºçš„æ–¹æ³•éƒ½æ˜¯å°†h5èµ„æºæ”¾å…¥åˆ°Android<br> Studioçš„assetsç›®å½•ä¸‹ï¼Œç„¶åä»¥assetsæ–¹å¼å»åŠ è½½h5ã€‚æ‰€ä»¥æˆ‘å°è¯•å°†h5ç›¸å…³èµ„æºå…¨éƒ¨æ”¾å…¥åˆ°assetsç›®å½•ä¸‹ï¼Œçœ‹çœ‹è¿™æ ·æ˜¯å¦è¿˜æŠ¥é”™ã€‚å¦‚å›¾ï¼š</p><p> <img src="/images/24.png" alt=""></p><p> WebViewåŠ è½½h5:</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.loadUrl(<span class="string">"file:///android_asset/10001single/index.html"</span>);</span><br></pre></td></tr></table></figure><p>ä»¥è¿™ç§æ–¹å¼åŠ è½½æ¸¸æˆæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ä½†æ˜¯ã€‚ã€‚ã€‚</p><p>é¦–å…ˆå¯ä»¥ç¡®å®šçš„æ˜¯è¿™æ ·çš„æ–¹å¼æ˜¯è‚¯å®šæ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„ï¼Œå› ä¸ºassetsçš„èµ„æºéœ€è¦æ‰“åŒ…è¿›apkçš„ï¼Œå±äºé¢„ç½®èµ„æºï¼Œç„¶è€Œæˆ‘ä»¬çš„æ¸¸æˆèµ„æºæ˜¯éœ€è¦å®æ—¶ä»ç½‘ç»œä¸­åŠ è½½çš„ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å°†æ¸¸æˆèµ„æºä¸‹è½½åˆ°assetsç›®å½•ä¸‹å‘¢ï¼Ÿå¾ˆé—æ†¾ï¼Œassetsç›®å½•ä¸‹çš„èµ„æºåªèƒ½è¯»å–æ— æ³•å†™å…¥ã€‚</p><p>æ‰€ä»¥ç°åœ¨æ¥æ€»ç»“ä¸€ä¸‹ï¼šç›¸åŒçš„ä¸€ä»½æ¸¸æˆä»£ç ï¼Œæ”¾åˆ°æœåŠ¡ç«¯åŠ è½½æ²¡æœ‰é—®é¢˜ï¼Œä½¿ç”¨æœ¬åœ°tomcatåŠ è½½æ²¡æœ‰é—®é¢˜ï¼Œæ”¾å…¥assetsç›®å½•ä¸‹åŠ è½½æ²¡æœ‰é—®é¢˜ï¼Œä»æœ¬åœ°åŠ è½½å°±æœ‰é—®é¢˜ã€‚</p><p>ç›´åˆ°ç°åœ¨æˆ‘ä¹Ÿè®¤ä¸ºæ˜¯WebViewçš„ä¸€äº›é…ç½®ä¸å½“ï¼Œå¯¼è‡´ä»æœ¬åœ°åŠ è½½h5èµ„æºå‡ºç°é—®é¢˜ã€‚ä½†æ˜¯è¯•è¿‡äº†å¯èƒ½çš„ä¸€äº›æ–¹æ³•åä»ç„¶æ˜¯ä¸å¯ä»¥ã€‚</p><hr><p>ç›´åˆ°æˆ‘çœ‹åˆ°äº†è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p><p><a href="http://asialee.iteye.com/blog/2043289" target="_blank" rel="noopener">androidå…³äºåŠ è½½æœ¬åœ°html5çš„é—®é¢˜</a></p><p><a href="http://asialee.iteye.com/blog/2043291" target="_blank" rel="noopener">androidå…³äºåŠ è½½æœ¬åœ°html5çš„é—®é¢˜(è§£å†³åŠæ³•)</a></p><p>æ–‡ç« é‡Œçš„æ„æ€å°±æ˜¯webkitå†…æ ¸ç¦æ­¢<code>Ajax</code>åŠ è½½æœ¬åœ°html5ï¼Œè¿˜æœ‰æµè§ˆå™¨çš„å®‰å…¨æ€§è®¾ç½®é—®é¢˜ã€‚</p><p>è¿™ç¯‡æ–‡ç« æ˜¯å¾ˆä¹…ä»¥å‰çš„äº†ï¼Œç°åœ¨æ˜¯å¦æœ‰è¿™ä¸ªé—®é¢˜æœ‰å¾…è€ƒç©¶ï¼Œä¸è¿‡é‡Œé¢æ¶‰åŠçš„ä¸€äº›é—®é¢˜å€’æ˜¯è›®ç¬¦åˆæˆ‘çš„bugã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæ–‡ç« é‡Œæåˆ°çš„è§£å†³æ–¹æ¡ˆï¼Œè®©æˆ‘çœ¼å‰ä¸€äº®ï¼šæ—¢ç„¶ä»ç½‘ç»œä¸­åŠ è½½h5æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä½•ä¸è®©æ‰‹æœºæœ¬åœ°åˆ›å»ºä¸€ä¸ªserverä½œä¸ºæœåŠ¡ç«¯å‘¢ï¼Ÿ</p><p>è¿™é‡Œä½¿ç”¨nanohttpdåˆ›å»ºserverï¼š</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> fi.iki.elonen.NanoHTTPD;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebServer</span> <span class="keyword">extends</span> <span class="title">NanoHTTPD</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_JAVASCRIPT = <span class="string">"text/javascript"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_CSS = <span class="string">"text/css"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_JPEG = <span class="string">"image/jpeg"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_PNG = <span class="string">"image/png"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_SVG = <span class="string">"image/svg+xml"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MIME_JSON = <span class="string">"application/json"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">serve</span><span class="params">(IHTTPSession session)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String mime_type = NanoHTTPD.MIME_PLAINTEXT;</span><br><span class="line">        Method method = session.getMethod();</span><br><span class="line">        String uri = session.getUri();</span><br><span class="line">        System.out.println(method + <span class="string">" '"</span> + uri + <span class="string">"' "</span>);</span><br><span class="line">        InputStream descriptor = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (method.toString().equalsIgnoreCase(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">            String path;</span><br><span class="line">            <span class="keyword">if</span> (uri.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                path = <span class="string">"/index.html"</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                path = uri;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (path.endsWith(<span class="string">".js"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_JAVASCRIPT;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".css"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_CSS;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".html"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_HTML;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".jpeg"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_JPEG;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".png"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_PNG;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".jpg"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_JPEG;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".svg"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_SVG;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.endsWith(<span class="string">".json"</span>)) &#123;</span><br><span class="line">                        mime_type = MIME_JSON;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            String sub = path.substring(path.indexOf(<span class="string">"lsd"</span>) + <span class="number">4</span>);</span><br><span class="line">            <span class="comment">// LogHelper.d("lsd", "path:" + path);</span></span><br><span class="line">            <span class="comment">// LogHelper.d("lsd", "sub:" + sub);</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                File file = <span class="keyword">new</span> File(Environment.getExternalStorageDirectory() + <span class="string">"/lsd/"</span> + sub);</span><br><span class="line">                descriptor = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">                Log.w(<span class="string">"Httpd"</span>, ioe.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> newFixedLengthResponse(Response.Status.OK, mime_type, descriptor, descriptor.available());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶WebViewåŠ è½½çš„urlå˜ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mWebView.loadUrl(<span class="string">"http://127.0.0.1:8080/mnt/sdcard/lsd/index.html"</span>);</span><br></pre></td></tr></table></figure><p>è¯•äº†ä¸€ä¸‹ï¼Œsuccessï¼</p><p>åœ¨ä¹‹åçš„æµ‹è¯•ä¸­å‘ç°æœ‰æ—¶ä¼šå‡ºç°åŠ è½½å¤±è´¥çš„æƒ…å†µï¼Œç»è°ƒè¯•nanoHttpdå¤šå“åº”äº†ä¸€æ¬¡â€œ/favicon.icoâ€ï¼Œè€Œæˆ‘ä»¬çš„èµ„æºæ–‡ä»¶ä¸­å®é™…ä¸Šå¹¶æ²¡æœ‰è¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥è¦å°†è¿™æ¬¡è¯·æ±‚å•ç‹¬å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (uri.endsWith(<span class="string">"favicon.ico"</span>)) &#123;</span><br><span class="line">   <span class="keyword">return</span> newFixedLengthResponse(<span class="string">""</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><hr><p>åæœŸQAåŒå­¦æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªæ·±å‘ï¼š</p><p>åœ¨ç©å®Œå•äººç‰ˆçš„æ¸¸æˆåï¼ŒåŠ è½½åŒäººç‰ˆæ¸¸æˆä¸€å®šä¼šå‡ºé—®é¢˜ï¼ï¼ˆæ¸¸æˆåˆ†ä¸ºå•äººç‰ˆå’ŒåŒäººç‰ˆï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒh5èµ„æºï¼‰</p><p>åŒäººæ¸¸æˆä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œå•äººæ¸¸æˆä¹‹é—´ä¹Ÿä¸ä¼šç›¸äº’å½±å“ï¼ŒåŒäººæ¸¸æˆä¸ä¼šå½±å“å•äººæ¸¸æˆï¼Œä½†æ˜¯å•äººæ¸¸æˆä¼šå½±å“åŒäººæ¸¸æˆï¼å¦‚æœå°†appè¿›ç¨‹killæ‰ï¼Œåˆ™åŒäººæ¸¸æˆåˆæ¢å¤æ­£å¸¸ã€‚</p><p>é—®é¢˜å…·ä½“è¡¨ç°ä¸ºï¼š</p><p>æ¸¸æˆèµ„æºåŠ è½½ä¸å®Œæ•´ã€‚å³éƒ¨åˆ†å›¾ç‰‡æˆ–è€…jsæ²¡æœ‰åŠ è½½ã€‚</p><p>æˆ‘ä»¥ä¸ºæ˜¯å•äººæ¸¸æˆçš„ç¼“å­˜å¯èƒ½å½±å“åˆ°äº†åŒäººæ¸¸æˆç¼“å­˜ï¼Œæ‰€ä»¥å¯¼è‡´åŒäººæ¸¸æˆåŠ è½½é”™è¯¯ã€‚WebViewç¼“å­˜åˆ†ä¸ºRAMç¼“å­˜å’Œæœ¬åœ°ç¼“å­˜ï¼Œç”±äºå°†App Killæ‰ååŒäººæ¸¸æˆåˆå¯ä»¥æ­£å¸¸è¿›è¡Œï¼Œæ‰€ä»¥åˆæ­¥å®šä¸ºä¸ºRAMç¼“å­˜é—®é¢˜ã€‚é‚£ä¹ˆå°è¯•åœ¨å•äººæ¸¸æˆç»“æŸåå°†RAMç¼“å­˜æ¸…ç†å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¸…ç†ä¸€ä¸ªåº”ç”¨ä¸­æ‰€æœ‰WebViewä½¿ç”¨çš„ç¼“å­˜</span></span><br><span class="line">mWebView.clearCache(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure><p>å‚æ•°falseè¡¨ç¤ºåªæ¸…ç†RAMç¼“å­˜ã€‚ç»“æœåŒäººæ¸¸æˆè¿˜æ˜¯æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><p>åæ¥æˆ‘åˆå°è¯•äº†å°†WebViewçš„ç¼“å­˜æ¨¡å¼è®¾ç½®ä¸ºLOAD_NO_CACHEã€‚å³ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebSettings settings = mWebView.getSettings();</span><br><span class="line">settings.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br></pre></td></tr></table></figure><p> ç»“æœä¾ç„¶æ— æ•ˆã€‚</p><p> æ­¤è·¯ä¸é€šã€‚</p><p> æ—¢ç„¶é—®é¢˜è¡¨ç°ä¸ºéƒ¨åˆ†èµ„æºæ²¡æœ‰ä¸‹è½½ï¼Œé‚£ä¹ˆæˆ‘å°±å°è¯•è·Ÿåˆ°jsä¸­å…·ä½“åŠ è½½èµ„æºçš„ä»£ç éƒ¨åˆ†ï¼Œé€šè¿‡logè§‚å¯Ÿæ˜¯å¦ç¨‹åºè¿è¡Œåˆ°äº†è¿™ä¸€æ­¥ã€‚</p><p> å½“æˆ‘è·Ÿåˆ°äº†è¿™ä¸ªrunæ–¹æ³•ä¸­è°ƒç”¨çš„çš„setIntervalæ–¹æ³•æ—¶ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">run: function(a) &#123;</span><br><span class="line">     var b = <span class="keyword">this</span></span><br><span class="line">       , c = function() &#123;</span><br><span class="line">         a &amp;&amp; (b.config[b.CONFIG_KEY.id] = a);</span><br><span class="line">         b._prepareCalled || b.prepare(function() &#123;</span><br><span class="line">             b._prepared = !<span class="number">0</span></span><br><span class="line">         &#125;);</span><br><span class="line">         cc._supportRender &amp;&amp; (b._checkPrepare = setInterval(function() &#123;</span><br><span class="line">             b._prepared &amp;&amp; (cc._setup(b.config[b.CONFIG_KEY.id]),</span><br><span class="line">             b._runMainLoop(),</span><br><span class="line">             b._eventHide = b._eventHide || <span class="keyword">new</span> cc.EventCustom(b.EVENT_HIDE),</span><br><span class="line">             b._eventHide.setUserData(b),</span><br><span class="line">             b._eventShow = b._eventShow || <span class="keyword">new</span> cc.EventCustom(b.EVENT_SHOW),</span><br><span class="line">             b._eventShow.setUserData(b),</span><br><span class="line">             b.onStart(),</span><br><span class="line">             clearInterval(b._checkPrepare))</span><br><span class="line">         &#125;, <span class="number">10</span>))</span><br><span class="line">     &#125;;</span><br><span class="line">     document.body ? c() : cc._addEventListener(window, <span class="string">"load"</span>, function() &#123;</span><br><span class="line">         <span class="keyword">this</span>.removeEventListener(<span class="string">"load"</span>, arguments.callee, !<span class="number">1</span>);</span><br><span class="line">         c()</span><br><span class="line">     &#125;, !<span class="number">1</span>)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p> æˆ‘å‘çº¿setIntervalæ–¹æ³•é‡Œçš„å®šæ—¶ä»»åŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè€Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œçš„<code>b.onStart()</code>æ˜¯æ¸¸æˆèµ„æºçš„åŠ è½½ã€‚éš¾é“æ˜¯æˆ‘ä»¬çš„è¿™ä¸ªsetIntervalæ–¹æ³•æœ‰é—®é¢˜å—ï¼Ÿå¯æ˜¯å¦‚æœæœ‰é—®é¢˜ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåªåŠ è½½åŒäººæ¸¸æˆçš„æ—¶å€™è¿™æ®µä»£ç å¯ä»¥æ­£å¸¸æ‰§è¡Œå‘¢ï¼Ÿåªæœ‰åŠ è½½äº†å•äººæ¸¸æˆåï¼Œè¿™æ®µä»£ç å°±ä¸å†æ‰§è¡Œäº†ã€‚</p><p>æˆ‘å°†setIntervalæ–¹æ³•é‡Œçš„æ‰§è¡Œé€»è¾‘å•ç‹¬æ‹¿å‡ºæ¥ï¼Œå°†setIntervalè¿™å±‚å£³å»æ‰ï¼Œå‘ç°é‡Œé¢çš„é€»è¾‘æœç„¶æ‰§è¡Œäº†ã€‚é‚£ä¹ˆç°åœ¨å°±æœ‰ä¸¤ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªsetIntervalæ–¹æ³•ä¸ä¼šæ‰§è¡Œå‘¢ï¼Ÿç¬¬äºŒï¼Œå¦‚æœæˆ‘å°†setIntervalæ–¹æ³•é‡Œçš„é€»è¾‘æŠ½å‡ºæ¥ç«‹åˆ»æ‰§è¡Œï¼ˆä¸å½±å“å…¶ä»–é€»è¾‘ï¼‰ï¼Œæˆ‘ä»¬çš„æ¸¸æˆæ˜¯å¦å°±å¯ä»¥æ­£å¸¸ç©è€äº†å‘¢ï¼Ÿ</p><p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æ–‡ç« çš„æœ€åä¼šè¿›è¡Œè§£ç­”ã€‚å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ä¸å¯ä»¥ï¼Œè¿™ä¹ˆåšæ˜¯å¯ä»¥ä¿è¯è¿™æ®µä»£ç æˆåŠŸæ‰§è¡Œï¼Œä½†æ˜¯æ¥ç€èµ°ä¸‹å»ï¼Œåˆä¼šæœ‰å…¶ä»–çš„é—®é¢˜ã€‚åœ¨æ­¤å°±ä¸è´´å‡ºé—®é¢˜äº†ã€‚å› ä¸ºæˆ‘ä»¬çš„jsä»£ç æœ‰5ä¸‡å¤šè¡Œï¼Œæˆ‘å¾ˆæ¸…æ¥šï¼Œè¿™æ ·ä¸€ä¸ªä¸ªå¡«å‘ç»å¯¹ä¸æ˜¯æ­£é“ã€‚å†µä¸”æœ‰è¶³å¤Ÿçš„ç†ç”±æ”¯æ’‘æˆ‘è¿™æ ·åšï¼šåªåŠ è½½åŒäººæ¸¸æˆæ˜¯æ²¡é—®é¢˜çš„ï¼</p><p>çœ‹æ¥æ­¤è·¯ä¹Ÿæ˜¯è¡Œä¸é€šã€‚</p><p>ç°åœ¨æˆ‘ä»¬ä»javaå±‚çœ‹è¿™ä¸ªé—®é¢˜ï¼Œå•äººæ¸¸æˆå’ŒåŒäººæ¸¸æˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿç”±äºä¸šåŠ¡è¦æ±‚ï¼Œæˆ‘ä»¬å•äººæ¸¸æˆä½¿ç”¨çš„WebViewç›´æ¥æ”¾ç½®åœ¨Activityä¸­ï¼Œè€ŒåŒäººæ¸¸æˆçš„WebViewåˆ™æ”¾åœ¨Fragmentä¸­ï¼Œé‚£ä¹ˆæ˜¯å¦æ˜¯å› ä¸ºè¿™ä¸ªåŸå› å‘¢ï¼Ÿæˆ‘å°†åŒäººæ¸¸æˆä½¿ç”¨çš„Fragmentæ”¾åœ¨çš„å•äººæ¸¸æˆçš„Activityä¸­ï¼Œç„¶åå°†å•äººæ¸¸æˆçš„Activityä½¿ç”¨çš„åŸWebViewç›¸å…³ä»£ç å…¨éƒ¨æ³¨é‡Šæ‰ï¼ŒæƒŠå¥‡çš„å‘ç°ç«Ÿç„¶å¯ä»¥äº†ï¼ï¼ï¼</p><p>é‚£ä¹ˆåŸå› æ¸æ¸æ‰¾åˆ°äº†ï¼Œæ˜¯å•äººæ¸¸æˆä¸­çš„WebViewçš„æŸäº›è®¾ç½®æœ‰é—®é¢˜ã€‚</p><p>é€šè¿‡å°†WebViewçš„ç›¸å…³ä»£ç ä¸€è¡Œè¡Œæ³¨é‡Šï¼Œç»ˆäºå‘ç°äº†ç½ªé­ç¥¸é¦–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStart();</span><br><span class="line">    mWebView.onResume();     </span><br><span class="line">    mWebView.resumeTimers();  <span class="comment">//&lt;----------</span></span><br><span class="line">    <span class="keyword">if</span> (mGameSession.lIsStartLoading) &#123;</span><br><span class="line">        mJsIface.loadUrl(GameSession.JsFunc.ON_GAME_START);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStop();</span><br><span class="line">    <span class="keyword">if</span> (mGameSession.lIsStartLoading &amp;&amp; !isFinishing()) &#123;</span><br><span class="line">        mJsIface.loadUrl(GameSession.JsFunc.ON_GAME_STOP);</span><br><span class="line">    &#125;</span><br><span class="line">    mWebView.onPause();</span><br><span class="line">    mWebView.pauseTimers();   <span class="comment">//&lt;----------</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®­å¤´æ‰€æŒ‡çš„ä¸¤è¡Œï¼Œåœ¨Activity onStartçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>mWebView.resumeTimers();</code>;åœ¨Activity OnStopçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>mWebView.pauseTimers();</code>ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><blockquote><p>pauseTimers, onPause åœæ­¢è§£æ,javascriptæ‰§è¡Œç­‰æ“ä½œ.åŒºåˆ«æ˜¯ onPause åªä½œç”¨äºè°ƒç”¨å®ƒçš„WebView,è€Œ pauseTimers ä½œç”¨äºå½“å‰åº”ç”¨ä¸­æ‰€æœ‰çš„WebViewã€‚</p><p>resumeTimers, onResume æ¢å¤è§£æ,javascriptæ‰§è¡Œç­‰æ“ä½œ.åŒºåˆ«æ˜¯ onResume åªä½œç”¨äºè°ƒç”¨å®ƒçš„WebView,è€Œ resumeTimers ä½œç”¨äºå½“å‰åº”ç”¨ä¸­æ‰€æœ‰çš„WebViewã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åœ¨å•äººæ¸¸æˆç»“æŸæ—¶ï¼Œæˆ‘ä»¬å°†åº”ç”¨ä¸­æ‰€æœ‰çš„WebViewéƒ½æ‰§è¡Œäº†pauseTimersæ–¹æ³•ï¼Œç»æ£€æŸ¥åœ¨åŒäººæ¸¸æˆå¼€å§‹æ—¶å¹¶æ²¡æœ‰è°ƒç”¨resumeTimersæ–¹æ³•ã€‚æ‰å¯¼è‡´h5èµ„æºåŠ è½½ä¸å®Œæ•´ã€‚è¿™ä¹Ÿæ­£å¥½è§£é‡Šäº†ä¸Šé¢jsä¸­setIntervalæ–¹æ³•ä¸ºä»€ä¹ˆä¸è°ƒç”¨ï¼ï¼ï¼</p><p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œåœ¨åŒäººæ¸¸æˆå¼€å§‹å‰è°ƒç”¨WebViewçš„resumeTimersæ–¹æ³•å³å¯ã€‚</p><hr><p>ok, ä¸ºä»€ä¹ˆç›´æ¥ä»æœ¬åœ°åŠ è½½htmlä¼šå‡ºç°å¼‚å¸¸è¿™ä¸ªé—®é¢˜ä¸€ç›´åœ¨å›°æ‰°æˆ‘ï¼Œæˆ‘å†³å®šä»å¤´æ¢³ç†ä¸€ä¸‹ï¼Œç»è¿‡å®šä½æˆ‘æœ€ç»ˆå‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">loadTxt: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (cc._isNodeJs) <span class="built_in">require</span>(<span class="string">"fs"</span>).readFile(a, <span class="function"><span class="keyword">function</span>(<span class="params">a, c</span>) </span>&#123;</span><br><span class="line">a ? b(a) : b(<span class="literal">null</span>, c.toString())</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">this</span>.getXMLHttpRequest(),</span><br><span class="line">d = <span class="string">"load "</span> + a + <span class="string">" failed!"</span>;</span><br><span class="line">c.open(<span class="string">"GET"</span>, a, !<span class="number">0</span>);</span><br><span class="line">/msie/i.test(navigator.userAgent) &amp;&amp; !<span class="regexp">/opera/i</span>.test(navigator.userAgent) ? (c.setRequestHeader(<span class="string">"Accept-Charset"</span>, <span class="string">"utf-8"</span>), c.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="number">4</span> === c.readyState &amp;&amp; (<span class="number">200</span> === c.status ? b(<span class="literal">null</span>, c.responseText) : b(&#123;</span><br><span class="line">status: c.status,</span><br><span class="line">errorMessage: d</span><br><span class="line">&#125;, <span class="literal">null</span>))</span><br><span class="line">&#125;) : (c.overrideMimeType &amp;&amp; c.overrideMimeType(<span class="string">"text/plain; charset\x3dutf-8"</span>), c.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="number">0</span> &lt;= c._timeoutId &amp;&amp; clearTimeout(c._timeoutId);</span><br><span class="line"><span class="number">4</span> === c.readyState &amp;&amp; (<span class="number">200</span> === c.status ? b(<span class="literal">null</span>, c.responseText) : b(&#123;</span><br><span class="line">status: c.status,</span><br><span class="line">errorMessage: d</span><br><span class="line">&#125;, <span class="literal">null</span>))</span><br><span class="line">&#125;, c.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">b(&#123;</span><br><span class="line">status: c.status,</span><br><span class="line">errorMessage: d</span><br><span class="line">&#125;, <span class="literal">null</span>)</span><br><span class="line">&#125;, <span class="keyword">void</span> <span class="number">0</span> === c.ontimeout &amp;&amp; (c._timeoutId = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">c.ontimeout()</span><br><span class="line">&#125;, c.timeout)), c.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">b(&#123;</span><br><span class="line">status: c.status,</span><br><span class="line">errorMessage: <span class="string">"Request timeout: "</span> + d</span><br><span class="line">&#125;, <span class="literal">null</span>)</span><br><span class="line">&#125;);</span><br><span class="line">c.send(<span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>é—®é¢˜æ ¹æºå°±åœ¨äºXHRä¸æ”¯æŒåŠ è½½æœ¬åœ°fileï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¿…è¦ä¸€å®šä½¿ç”¨XHRæ–¹å¼å»åŠ è½½ï¼Œè€Œæ˜¯ä½¿ç”¨jsä¸­çš„ä¸€äº›File APIå»åŠ è½½ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„web serverï¼Œæ¥å°†fileåŸŸçš„æ–‡ä»¶è½¬åŒ–ä¸ºhttpå½¢å¼ã€‚</p><p>ç°åœ¨æƒ³ä¸€æƒ³å½“åˆçœŸçš„èµ°äº†å¾ˆå¤šå¼¯è·¯ã€‚</p><p>åœ¨<a href="https://stackoverflow.com/questions/7683596/xmlhttprequest-for-local-files?answertab=votes#tab-top" target="_blank" rel="noopener">stackoverflow</a>ä¸Šç›¸å…³é—®é¢˜çš„ä¸€ä¸ªå›ç­”å®Œç¾çš„æ€»ç»“äº†è¯¥é—®é¢˜ï¼š</p><blockquote><p>Historically, you canâ€™t query for local files from JavaScript (or shouldnâ€™t be allowed to, or somethingâ€™s odd). This would be a serious breach of security.</p></blockquote><blockquote><p>There are only a few circumstances where you can do this, but in general they involve specific security settings requiring to be set for your browser, to either lift the limitation or to notify the current pageâ€™s execution process that that is is granted this exceptional right. This is for instance doable in Firefox by editing the properties. Itâ€™s also commonly OK when developing browser extensions (for instance for Chrome or FF) if they request the file access permissions.</p></blockquote><blockquote><p>Another way to go around this limitation is to host a local web-server, and to declare virtual hosts on it to be able to do this sort of AJAX request to fetch local files. Itâ€™s quite common for web-developers to resort to this trick (more like a standard, really) to have the benefits of local development but at the same time replicate a production system. You could for instance use a lightweight web-server like Jetty.</p></blockquote><blockquote></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å°æ¸¸æˆå¾ˆç«çˆ†ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä»åŠå¹´å‰åˆ°ç°åœ¨ä¹Ÿé™†é™†ç»­ç»­ä¸Šäº†å‡ æ¬¾å°æ¸¸æˆï¼Œæˆ‘ä»¬çš„å°æ¸¸æˆæ˜¯é€šè¿‡h5æ–¹å¼å®ç°çš„ï¼Œä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯é€šè¿‡Androidä¸­WebViewçš„&lt;code&gt;loadUrl&lt;/code&gt;æ–¹æ³•ç›´æ¥å°†h5çš„&lt;code&gt;index.html&lt;/code&gt;åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯è¿™
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="Webview" scheme="http://lisongda.com/tags/Webview/"/>
    
  </entry>
  
  <entry>
    <title>DownLoadManagerä¸å±•ç¤ºé€šçŸ¥æ </title>
    <link href="http://lisongda.com/2018/05/09/DownLoadManager%E4%B8%8D%E5%B1%95%E7%A4%BA%E9%80%9A%E7%9F%A5%E6%A0%8F/"/>
    <id>http://lisongda.com/2018/05/09/DownLoadManagerä¸å±•ç¤ºé€šçŸ¥æ /</id>
    <published>2018-05-09T03:32:58.000Z</published>
    <updated>2018-05-09T03:51:02.742Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšä¸€ä¸ªä¸‹è½½çš„éœ€æ±‚ï¼Œå› ä¸ºAndroidåŸç”Ÿæœ‰ä¸€ä¸ªDownLoadManagerï¼Œé€šè¿‡ç®€å•è°ƒç ”ï¼Œè§‰å¾—å®ƒå¾ˆä¸é”™ï¼Œäºæ˜¯å°±å¼€å§‹åšäº†ã€‚ã€‚ã€‚</p><p>å› ä¸ºæˆ‘ä»¬çš„ä¸‹è½½æ˜¯ä¸éœ€è¦æ˜¾ç¤ºé€šçŸ¥æ çš„ï¼Œè€ŒDownLoadManageråˆ™éœ€è¦ä¸€å¥è¯åˆ™å¯ä»¥è¾¾åˆ°è¦æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">downRequest.setNotificationVisibility(DownloadManager.Request.VISIBILITY_HIDDEN);</span><br></pre></td></tr></table></figure><p>æŠŠæ•´ä½“æ¡†æ¶æ‰“å®Œåï¼Œä¸€æµ‹è¯•ï¼Œcrashã€‚ã€‚ã€‚ã€‚</p><blockquote><p>Caused by: java.lang.SecurityException: Invalid value for visibility: 2<br>    at android.os.Parcel.readException(Parcel.java:1592)<br>    at android.database.DatabaseUtils.readExceptionFromParcel(DatabaseUtils.java:190)<br>    at android.database.DatabaseUtils.readExceptionFromParcel(DatabaseUtils.java:142)<br>    at android.content.ContentProviderProxy.insert(ContentProviderNative.java:476)<br>    at android.content.ContentResolver.insert(ContentResolver.java:1207)<br>    at android.app.DownloadManager.enqueue(DownloadManager.java:946)</p></blockquote><p>åŸå› ç«Ÿç„¶æ˜¯éšè—é€šçŸ¥æ éœ€è¦æƒé™ï¼ï¼ï¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!--DownloadManagerä¸‹è½½æ—¶ä¸æ˜¾ç¤ºNotification--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.DOWNLOAD_WITHOUT_NOTIFICATION"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºæ–°å¢æƒé™ä¼šå¤§å¤§å½±å“appçš„å‡çº§ç‡ï¼Œæˆ‘ä»¬çš„PMæ˜¯ä¸å…è®¸å¢åŠ æ–°æƒé™çš„ã€‚ã€‚ã€‚åªèƒ½æ”¾å¼ƒDownloadManagerè¿™ä¸ªæ–¹æ¡ˆäº†ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘åœ¨åšä¸€ä¸ªä¸‹è½½çš„éœ€æ±‚ï¼Œå› ä¸ºAndroidåŸç”Ÿæœ‰ä¸€ä¸ªDownLoadManagerï¼Œé€šè¿‡ç®€å•è°ƒç ”ï¼Œè§‰å¾—å®ƒå¾ˆä¸é”™ï¼Œäºæ˜¯å°±å¼€å§‹åšäº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬çš„ä¸‹è½½æ˜¯ä¸éœ€è¦æ˜¾ç¤ºé€šçŸ¥æ çš„ï¼Œè€ŒDownLoadManageråˆ™éœ€è¦ä¸€å¥è¯åˆ™å¯ä»¥è¾¾åˆ°è¦æ±‚ï¼š&lt;/p&gt;
&lt;figure cl
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨getSimpleName()ä½œä¸ºFragmentçš„TAGæ—¶çš„æ½œåœ¨é£é™©</title>
    <link href="http://lisongda.com/2018/04/26/%E4%BD%BF%E7%94%A8getSimpleName-%E4%BD%9C%E4%B8%BAFragment%E7%9A%84TAG%E6%97%B6%E7%9A%84%E6%BD%9C%E5%9C%A8%E9%A3%8E%E9%99%A9/"/>
    <id>http://lisongda.com/2018/04/26/ä½¿ç”¨getSimpleName-ä½œä¸ºFragmentçš„TAGæ—¶çš„æ½œåœ¨é£é™©/</id>
    <published>2018-04-26T12:43:05.000Z</published>
    <updated>2018-04-29T14:19:41.463Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç¿»è¯‘è‡ª<a href="https://medium.com/@elye.project/the-danger-of-using-class-getsimplename-as-tag-for-fragment-5cdf3a35bfe2" target="_blank" rel="noopener">https://medium.com/@elye.project/the-danger-of-using-class-getsimplename-as-tag-for-fragment-5cdf3a35bfe2</a></p><p> å½“æˆ‘ä»¬åœ¨Activityä¸­æ·»åŠ ä¸€ä¸ªFragmentæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨TAGä½œä¸ºå®ƒçš„idã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getFragmentManager().beginTransaction()</span><br><span class="line">        .add(containerResource, fragment, fragmentTAG).commit();</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¼šé€‰æ‹©ç±»åä½œä¸ºè¿™é‡Œçš„fragmentTagã€‚ä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œçš„ç±»åå¹¶ä¸åŒ…å«åŒ…åã€‚å½“ç„¶å‰ææ˜¯æˆ‘ä»¬çŸ¥é“é¡¹ç›®ä¸­ä¸åŒçš„åŒ…ä¸‹æ²¡æœ‰é‡åçš„ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MyClassFragment.class.getSimpleName();</span><br></pre></td></tr></table></figure><p>å½“éœ€è¦ä½¿ç”¨è¯¥fragmentæ—¶ï¼Œæˆ‘ä»¬é€šè¿‡findFragmentByTagæ–¹æ³•è·å–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragment = getFragmentManager().findFragmentByTag(tag);</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™æ ·åšæ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ï¼Œå³ä½¿æ˜¯åœ¨æ··æ·†åã€‚</p><p>çœŸçš„æ²¡æœ‰é—®é¢˜å—ï¼Ÿ</p><p>å°½ç®¡ç±»ä¸åŒï¼Œä½†æ˜¯å®ƒä»¬è¿˜æ˜¯å¯èƒ½ä½¿ç”¨<strong>ç›¸åŒçš„Tag</strong>ã€‚</p><p>How this happenï¼Ÿ</p><p>å‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ªfragmentï¼Œä»¥åŠå®ƒä»¬åœ¨æ··æ·†åçš„ç±»åå¦‚ä¸‹ï¼š</p><blockquote><p>com.mypackage1.FragmentA â†’ com.mypackage1.a</p><p>com.mypackage2.FragmentB â†’ com.mypackage2.a</p></blockquote><p>è¿™æ ·ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨<code>simple name</code>å‘¢ï¼Ÿ</p><blockquote><p>com.mypackage1.FragmentA â†’ a</p><p>com.mypackage2.FragmentB â†’ a</p></blockquote><p>ï¼ï¼ï¼</p><p>ä¹Ÿè®¸å‡ºç°è¿™ç§æƒ…å†µçš„æ¦‚ç‡å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œä½†ä¹Ÿæ˜¯æœ‰å¯èƒ½å‡ºç°çš„ã€‚</p><p>ä¸ºäº†ä¸å‡ºç°è¿™ç§æƒ…å†µï¼Œå¯ä»¥æœ‰å¦‚ä¸‹å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä½¿ç”¨<code>full name</code></li><li>ä½¿ç”¨åˆ«å</li><li>ä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ç¿»è¯‘è‡ª&lt;a href=&quot;https://medium.com/@elye.project/the-danger-of-using-class-getsimplename-as-tag-for-fragment-5cdf3a35bfe2&quot; target=&quot;_blank&quot; 
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="Fragment" scheme="http://lisongda.com/tags/Fragment/"/>
    
  </entry>
  
  <entry>
    <title>Android Fragmentçš„ä¸€äº›å‘æ€»ç»“</title>
    <link href="http://lisongda.com/2018/04/26/Android-Fragment%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91%E6%80%BB%E7%BB%93/"/>
    <id>http://lisongda.com/2018/04/26/Android-Fragmentçš„ä¸€äº›å‘æ€»ç»“/</id>
    <published>2018-04-26T06:31:06.000Z</published>
    <updated>2018-04-29T14:21:19.519Z</updated>
    
    <content type="html"><![CDATA[<h2 id="getActivity-ä¸ºnull"><a href="#getActivity-ä¸ºnull" class="headerlink" title="getActivity()ä¸ºnull"></a>getActivity()ä¸ºnull</h2><p>  åœ¨ä¸€äº›æƒ…å†µä¸‹ä¼šé‡åˆ°framgnetçš„getActivity()æ–¹æ³•ä¸ºnullçš„é—®é¢˜ã€‚</p><p>  æ¯”å¦‚ï¼šfragmentä¸­çš„å¼‚æ­¥å›è°ƒæ–¹æ³•ï¼Œå‡è®¾æ­¤æ—¶fragmentå·²ç»onDetachäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶getActivity()è·å–åˆ°çš„å€¼ä¸ºnullï¼›Activityæ„å¤–é”€æ¯é‡å»ºåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜å¹¶å›å¤framgnetï¼Œå¯¼è‡´æ­¤æ—¶fragmenté‡å ï¼Œè€Œæ—§çš„fragmentå–åˆ°çš„activityä¸ºnullã€‚</p><p>  è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>ç›´æ¥åˆ¤æ–­<code>getActivity()!=null</code>,ç®€å•ç²—æš´ï¼Œå¦‚æœä¸å½±å“ä¸šåŠ¡é€»è¾‘æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p></li><li><p>onAttachä¸­å°†ä¸Šä¸‹æ–‡è¿›è¡Œä¿å­˜ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</p></li></ul><h2 id="java-lang-IllegalStateException-Can-not-perform-this-action-after-onSaveInstanceState"><a href="#java-lang-IllegalStateException-Can-not-perform-this-action-after-onSaveInstanceState" class="headerlink" title="java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState"></a>java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState</h2><p>  å‡ºç°è¿™ç§å¼‚å¸¸ä¿¡æ¯çš„å¸¸ç”¨åœºæ™¯æœ‰ä¸¤ä¸ªï¼š</p><ul><li><p>åœ¨ç³»ç»Ÿè°ƒç”¨activityçš„onSaveInstanceState()æ–¹æ³•ååŠ è½½fragmentæ—¶ä¼šæŠ¥ä¸Šè¿°å¼‚å¸¸ã€‚</p><p> è§£å†³æ–¹æ¡ˆï¼šåœ¨ä¸šåŠ¡å…è®¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>commitAllowingStateLoss</code>ä»£æ›¿<code>commit</code>ã€‚</p></li><li><p>ç³»ç»Ÿè°ƒç”¨äº†onSaveInstanceStateæ–¹æ³•åï¼Œç”¨æˆ·è°ƒç”¨äº†onBackPressedæ–¹æ³•ã€‚</p><p> è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>é‡å†™activityä¸çš„onSaveInstanceStateæ–¹æ³•ï¼Œä¸è°ƒç”¨superçš„onSaveInstanceStateæ–¹æ³• ã€‚å¹¶ä¸æ¨èï¼Œä¼šä¸¢æ‰å…¶ä»–çŠ¶æ€ä¿¡æ¯ã€‚</li><li>é‡å†™onBackPressedæ–¹æ³•ï¼Œä¸è°ƒç”¨super.onBackPressed()ï¼Œç›´æ¥finish()ã€‚å…¶å®è¿™ç§æ–¹æ³•ä¹Ÿä¸æ˜¯å¾ˆæ¨èï¼Œå› ä¸ºå¦‚æœæ­¤æ—¶æœ‰fragmentï¼Œé‚£ä¹ˆç‚¹å‡»backä¼šæŠŠfragmentå’Œactivityä¸€èµ·finishæ‰ã€‚</li><li><p>åœ¨onBackPressedæ–¹æ³•é‡Œï¼Œæ‰‹åŠ¨æ›´æ”¹æ˜¯å¦è°ƒç”¨äº†onSaveInstanceStateæ–¹æ³•çš„flagã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBackPressed</span><span class="params">()</span> </span>&#123; </span><br><span class="line">onStateNotSaved(); </span><br><span class="line"><span class="keyword">super</span>.onBackPressed();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;getActivity-ä¸ºnull&quot;&gt;&lt;a href=&quot;#getActivity-ä¸ºnull&quot; class=&quot;headerlink&quot; title=&quot;getActivity()ä¸ºnull&quot;&gt;&lt;/a&gt;getActivity()ä¸ºnull&lt;/h2&gt;&lt;p&gt;  åœ¨ä¸€äº›æƒ…å†µä¸‹
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="Fragment" scheme="http://lisongda.com/tags/Fragment/"/>
    
  </entry>
  
  <entry>
    <title>Android ConstraintLayout GuideLineé€‚é…RTL</title>
    <link href="http://lisongda.com/2018/04/25/Android-ConstraintLayout-GuideLine%E9%80%82%E9%85%8DRTL/"/>
    <id>http://lisongda.com/2018/04/25/Android-ConstraintLayout-GuideLineé€‚é…RTL/</id>
    <published>2018-04-25T06:22:00.000Z</published>
    <updated>2018-04-29T14:21:11.077Z</updated>
    
    <content type="html"><![CDATA[<p>ConstraintLayoutä¸­GuideLineæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ§ä»¶ï¼Œæˆ‘å½¢å®¹å®ƒä¸ºâ€œéšèº«çš„ç›‘ç®¡è€…â€ã€‚åœ¨ä½¿ç”¨å®ƒæ—¶å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒçš„<code>app:layout_constraintGuide_percent</code>å±æ€§æ— æ³•é€‚é…rtlï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åˆ‡æ¢å°†æ‰‹æœºè¯­è¨€è®¾ç½®åˆ‡æ¢é˜¿æ‹‰ä¼¯è¯­æˆ–è€…å¼ºåˆ¶è®¾ç½®ä¸ºTRLæ—¶ï¼ŒUIçš„å˜åŒ–å°±ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„äº†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".ThirdActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.constraint.Guideline</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/guideline"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintGuide_percent</span>=<span class="string">"0.4"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Button"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"@+id/guideline"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å±å¹•å·¦ä¾§40%å¤„æ·»åŠ ä¸€ä¸ªç«–ç›´GuideLineï¼Œåœ¨GuideLineå³ä¾§20dpå¤„æ·»åŠ ä¸€ä¸ªbuttonï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/images/16.png" alt=""></p><p>å½“åˆ‡æ¢RTLæ—¶ï¼Œç»“æœä¸ºï¼š</p><p><img src="/images/17.png" alt=""></p><p> å¾ˆæ˜æ˜¾è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œæˆ‘ä»¬æƒ³è¦GuideLineä»å±å¹•å³ä¾§å¼€å§‹çš„40%å¤„ã€‚å³ï¼š</p><p> <img src="/images/18.png" alt=""></p><p> è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p> æ—¢ç„¶ç³»ç»Ÿæ— æ³•ä¸ºæˆ‘ä»¬è‡ªåŠ¨é€‚é…ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨é€‚é…RTLï¼š</p><p> values/dimens.xmlï¼š</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"guideline_percent"</span> <span class="attr">format</span>=<span class="string">"float"</span> <span class="attr">type</span>=<span class="string">"dimen"</span>&gt;</span>0.4<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><p> values-ldrtl/dimens.xml:</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"guideline_percent"</span> <span class="attr">format</span>=<span class="string">"float"</span> <span class="attr">type</span>=<span class="string">"dimen"</span>&gt;</span>0.6<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><p> æˆ–è€…åœ¨<code>layout-ldrtl</code>ä¸‹é‡å†™layoutã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ConstraintLayoutä¸­GuideLineæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æ§ä»¶ï¼Œæˆ‘å½¢å®¹å®ƒä¸ºâ€œéšèº«çš„ç›‘ç®¡è€…â€ã€‚åœ¨ä½¿ç”¨å®ƒæ—¶å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒçš„&lt;code&gt;app:layout_constraintGuide_percent&lt;/code&gt;å±æ€§æ— æ³•é€‚é…rtlï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åˆ‡æ¢å°†æ‰‹æœºè¯­è¨€è®¾ç½®
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="ConstraintLayout" scheme="http://lisongda.com/tags/ConstraintLayout/"/>
    
  </entry>
  
  <entry>
    <title>mac Chromeå¸¸ç”¨å¿«æ·é”®</title>
    <link href="http://lisongda.com/2018/04/22/mac-Chrome%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <id>http://lisongda.com/2018/04/22/mac-Chromeå¸¸ç”¨å¿«æ·é”®/</id>
    <published>2018-04-22T08:12:58.000Z</published>
    <updated>2018-04-22T09:40:25.460Z</updated>
    
    <content type="html"><![CDATA[<ul><li>æ‰“å¼€æ–°çª—å£ï¼šâŒ˜ + n</li><li>æ‰“å¼€æ–°tabï¼šâŒ˜ + t</li><li>åœ¨æ— ç—•æ¨¡å¼ä¸‹æ‰“å¼€æ–°çª—å£ï¼šâŒ˜ + Shift + n</li><li>é‡æ–°æ‰“å¼€æœ€åå…³é—­çš„æ ‡ç­¾é¡µï¼Œå¹¶è·³è½¬åˆ°è¯¥æ ‡ç­¾é¡µï¼šâŒ˜ + Shift + t</li><li>è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ‰“å¼€çš„æ ‡ç­¾é¡µï¼šâŒ˜ + Option + å‘å³ç®­å¤´é”®</li><li>è·³è½¬åˆ°ä¸Šä¸€ä¸ªæ‰“å¼€çš„æ ‡ç­¾é¡µï¼šâŒ˜ + Option + å‘å·¦ç®­å¤´é”®</li><li>è·³è½¬åˆ°æœ€åä¸€ä¸ªæ ‡ç­¾é¡µï¼šâŒ˜ + 9</li><li>å…³é—­å½“å‰æ ‡ç­¾é¡µæˆ–å¼¹å‡ºå¼çª—å£ï¼šâŒ˜ + w</li><li>å…³é—­å½“å‰çª—å£ï¼šâŒ˜ + Shift + w</li><li>é‡æ–°åŠ è½½å½“å‰ç½‘é¡µï¼šâŒ˜ + R</li><li>é‡æ–°åŠ è½½å½“å‰ç½‘é¡µï¼ˆå¿½ç•¥ç¼“å­˜çš„å†…å®¹ï¼‰ï¼šâŒ˜ + Shift + r</li><li>æœ€å°åŒ–çª—å£ï¼šâŒ˜ + m</li><li>éšè— Google Chromeï¼šâŒ˜ + h</li><li>é€€å‡º Google Chromeï¼šâŒ˜ + q</li><li>æ‰“å¼€â€œå¼€å‘è€…å·¥å…·â€ï¼šâŒ˜ + Option + i</li><li>ä¸ºç½‘ç«™åç§°æ·»åŠ  www. å’Œ .comï¼Œå¹¶åœ¨å½“å‰æ ‡ç­¾é¡µä¸­æ‰“å¼€è¯¥ç½‘ç«™ï¼šè¾“å…¥ç½‘ç«™åç§°å¹¶æŒ‰ Control + Enter é”®</li><li>ä¸ºç½‘ç«™åç§°æ·»åŠ  www. å’Œ .comï¼Œå¹¶åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€è¯¥ç½‘ç«™ï¼šè¾“å…¥ç½‘ç«™åç§°å¹¶æŒ‰ Control + Shift + Enter é”®</li><li>åœæ­¢åŠ è½½ç½‘é¡µï¼šEsc</li><li>æ”¾å¤§ç½‘é¡µä¸Šçš„æ‰€æœ‰å†…å®¹ï¼šâŒ˜ å’Œ +</li><li>ç¼©å°ç½‘é¡µä¸Šçš„æ‰€æœ‰å†…å®¹ï¼šâŒ˜ å’Œ -</li><li>æ‰“å¼€å½“å‰æ ‡ç­¾é¡µæµè§ˆè®°å½•ä¸­è®°å½•çš„ä¸Šä¸€ä¸ªé¡µé¢ï¼šâŒ˜ + [ æˆ– âŒ˜ + å‘å·¦ç®­å¤´é”®</li><li>æ‰“å¼€å½“å‰æ ‡ç­¾é¡µæµè§ˆè®°å½•ä¸­è®°å½•çš„ä¸‹ä¸€ä¸ªé¡µé¢ï¼šâŒ˜ + ] æˆ– âŒ˜ + å‘å³ç®­å¤´é”®       </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;æ‰“å¼€æ–°çª—å£ï¼šâŒ˜ + n&lt;/li&gt;
&lt;li&gt;æ‰“å¼€æ–°tabï¼šâŒ˜ + t&lt;/li&gt;
&lt;li&gt;åœ¨æ— ç—•æ¨¡å¼ä¸‹æ‰“å¼€æ–°çª—å£ï¼šâŒ˜ + Shift + n&lt;/li&gt;
&lt;li&gt;é‡æ–°æ‰“å¼€æœ€åå…³é—­çš„æ ‡ç­¾é¡µï¼Œå¹¶è·³è½¬åˆ°è¯¥æ ‡ç­¾é¡µï¼šâŒ˜ + Shift + t&lt;/li&gt;
&lt;li&gt;è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ‰“å¼€
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="chrome" scheme="http://lisongda.com/tags/chrome/"/>
    
  </entry>
  
  <entry>
    <title>Android Activityç›¸å…³</title>
    <link href="http://lisongda.com/2018/04/21/Android-Activity%E7%9B%B8%E5%85%B3/"/>
    <id>http://lisongda.com/2018/04/21/Android-Activityç›¸å…³/</id>
    <published>2018-04-21T13:25:44.000Z</published>
    <updated>2018-04-28T09:10:02.998Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä»Activity Aæ‰“å¼€Activity Bï¼ŒAå’ŒBçš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•å˜åŒ–ï¼Ÿ</li></ul><ol><li>Aâ€“&gt;onPause()</li><li>Bâ€“&gt;onCreate()â€“&gt;onStart()â€“&gt;onResume()</li><li>Aâ€“&gt;onStop()</li></ol><ul><li><p>åœ¨å¼¹å‡ºä¸€ä¸ªåŠé€æ˜çš„activityï¼ˆæ¯”å¦‚Dialogï¼‰æ—¶ï¼ŒåŸActivityä¼šè°ƒç”¨onPause(),ä¸ä¼šè°ƒç”¨onStop();åœ¨Android 7.0åŠä»¥ä¸Šå¤šçª—å£æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªAppè·å–ç„¦ç‚¹åï¼Œå…¶ä»–Appä¼šè°ƒç”¨onPause();</p></li><li><p>å¯ä»¥ä½¿ç”¨onCreateæˆ–è€…onRestoreInstanceStateæ–¹æ³•æ¥æ¢å¤Activityä¿å­˜çš„æ•°æ®ï¼Œä¸åŒçš„æ˜¯ä½¿ç”¨onCreateæ—¶ï¼Œéœ€è¦åˆ¤æ–­<code>savedInstanceState != null</code>ï¼Œè€Œä½¿ç”¨onRestoreInstanceStateä¸éœ€è¦åšä¸Šé¢çš„åˆ¤æ–­ã€‚</p></li><li><p>å…³äºè¿›ç¨‹é—´ä¼ é€’æ•°æ®ï¼Œå°½é‡ä¸ä½¿ç”¨è‡ªå®šä¹‰Parcelableç±»ã€‚å¦‚æœä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„Parcelableç±»çš„å®šä¹‰ä¸ä¸€æ ·ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚åœ¨ä½¿ç”¨AlarmManagerä¼ é€’Intentæ•°æ®æ—¶ï¼Œä¸è¦ä½¿ç”¨è‡ªå®šä¹‰Parcelableç±»ï¼Œç³»ç»Ÿä¼šä¿®æ”¹intenté‡Œçš„æ•°æ®ï¼Œæ‰€ä»¥æ— æ³•è¯†åˆ«è‡ªå®šä¹‰çš„Parcelableç±»ï¼Œå¯¼è‡´æˆ‘ä»¬ä»Intentä¸­å–åˆ°çš„æ•°æ®ä¸ºç©ºï¼ˆåœ¨Android 6.0åŠä»¥ä¸Šï¼‰ã€‚<a href="https://developer.android.com/guide/components/activities/parcelables-and-bundles.html#sdbp" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>.<a href="https://medium.com/@hanru.yeh/alarms-pendingintents-cannot-include-custom-parcelable-class-instances-on-android-n-93a64aeedb33" target="_blank" rel="noopener">mediumç›¸å…³æ–‡ç« </a></p></li></ul><ul><li><p>å½“è¿›è¡ŒPreferenceé…ç½®çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨PreferenceFragmentæˆ–è€…PreferenceActivityã€‚</p></li><li><p>åœ¨ä½¿ç”¨éšå¼Intentæ‰“å¼€Activityæ—¶ï¼Œé¦–å…ˆè¦åˆ¤æ–­æ˜¯å¦æœ‰èƒ½å¤Ÿå¤„ç†è¿™æ ·çš„Intentçš„Activityå­˜åœ¨ï¼Œå¦åˆ™ä¼šcrashã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> PackageManager packageManager = getPackageManager();</span><br><span class="line">List&lt;ResolveInfo&gt; activities = packageManager.queryIntentActivities(intent,</span><br><span class="line">        PackageManager.MATCH_DEFAULT_ONLY);</span><br><span class="line">boolean isIntentSafe = activities.size() &gt; 0;</span><br></pre></td></tr></table></figure></li></ul><p> * </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;ä»Activity Aæ‰“å¼€Activity Bï¼ŒAå’ŒBçš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•å˜åŒ–ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Aâ€“&amp;gt;onPause()&lt;/li&gt;
&lt;li&gt;Bâ€“&amp;gt;onCreate()â€“&amp;gt;onStart()â€“&amp;gt;onResume()&lt;/l
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Activity" scheme="http://lisongda.com/tags/Activity/"/>
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸‰ä½¿ç”¨Transitionè¿›è¡ŒLayoutåŠ¨ç”»</title>
    <link href="http://lisongda.com/2018/04/14/Android%E5%8A%A8%E7%94%BB%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%89%E4%BD%BF%E7%94%A8Transition%E8%BF%9B%E8%A1%8CLayout%E5%8A%A8%E7%94%BB/"/>
    <id>http://lisongda.com/2018/04/14/AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸‰ä½¿ç”¨Transitionè¿›è¡ŒLayoutåŠ¨ç”»/</id>
    <published>2018-04-14T09:15:06.000Z</published>
    <updated>2018-04-16T06:09:35.913Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å­¦ä¹ æ€»ç»“äº<a href="https://developer.android.com/training/transitions/index.html" target="_blank" rel="noopener">https://developer.android.com/training/transitions/index.html</a>ã€‚</p><p>æœ¬æ–‡æ‰€æœ‰<a href="https://github.com/Brooks0129/Transition" target="_blank" rel="noopener">Demoåœ°å€</a></p><p>Android 4.4.2 (API level 19)å¼•å…¥Transitionæ¡†æ¶ï¼Œæˆ‘ä»¬åªè¦æä¾›åŠ¨ç”»çš„èµ·å§‹æ—¶çš„layoutå’Œç»ˆæ­¢æ—¶çš„layoutï¼ŒTransitionä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆå¸ƒå±€åŠ¨ç”»çš„è¿‡æ¸¡ï¼ŒåŒæ—¶ä¸ºæˆ‘ä»¬æä¾›äº†å‡ ç§å¯é€‰çš„è¿‡æ¸¡æ–¹å¼ï¼Œä¾‹å¦‚æ·¡å…¥æ·¡å‡ºã€æ”¹å˜ä½ç½®å¤§å°ç­‰ç­‰ã€‚</p><h2 id="Transition-Demo"><a href="#Transition-Demo" class="headerlink" title="Transition Demo"></a>Transition Demo</h2><p>å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š</p><p><img src="/images/10.gif" alt=""></p><p>å¦‚æœä¸ä½¿ç”¨Transitionï¼Œé‚£ä¹ˆè¿™ç§åŠ¨ç”»æ•ˆæœä¹Ÿéå¸¸å¥½å®ç°ï¼Œåªè¦é’ˆå¯¹ä¸¤ä¸ªImageViewåˆ†åˆ«ä½¿ç”¨å±æ€§åŠ¨ç”»æ”¹å˜å…¶ä½ç½®å’Œå¤§å°å³å¯ã€‚é‚£ä¹ˆä½¿ç”¨Transitionçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå½“æ¶‰åŠåˆ°çš„viewè¾ƒå¤šæ—¶ï¼ŒTransitionä¼šå¤§å¤§ç²¾ç®€æˆ‘ä»¬çš„ä»£ç å¤æ‚åº¦ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦æä¾›èµ·å§‹layoutå’Œç»“æŸlayoutå³å¯ã€‚</p><p>ç®€å•çœ‹ä¸‹ä¸Šé¢ä¾‹å­çš„Transitionä»£ç å®ç°ï¼š</p><p>é¦–å…ˆæ˜¯activity_main.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">"com.lsd.transition.MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"change"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/scene_root"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">"@+id/button"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span></span></span><br><span class="line"><span class="tag">            <span class="attr">layout</span>=<span class="string">"@layout/sence1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Buttonç”¨äºåŠ¨ç”»çš„åˆ‡æ¢ï¼Œç¨åæˆ‘ä»¬å¯ä»¥åœ¨javaä»£ç é‡Œçœ‹åˆ°å®ƒçš„ç‚¹å‡»äº‹ä»¶ã€‚ç„¶åæ˜¯ä¸€ä¸ªidä¸ºscene_rootçš„FrameLayoutï¼Œæ˜¯æˆ‘ä»¬éœ€è¦æ‰§è¡ŒåŠ¨ç”»éƒ¨åˆ†çš„æ ¹å¸ƒå±€ã€‚é»˜è®¤çŠ¶æ€ä¸‹å±•ç¤ºçš„æ˜¯scene1.xmlï¼Œæ‰§è¡ŒåŠ¨ç”»åå±•ç¤ºçš„æ˜¯scene2.xmlï¼š</p><p>scene1.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">"@+id/imageView2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_chainStyle</span>=<span class="string">"packed"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@drawable/pic1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"@+id/imageView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toEndOf</span>=<span class="string">"@+id/imageView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"@+id/imageView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@drawable/pic2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>previewå¦‚ä¸‹ï¼š</p><p><img src="/images/11.png" alt="scene1"></p><p>scene2.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toStartOf</span>=<span class="string">"@+id/imageView2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.328"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@drawable/pic1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"44dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:srcCompat</span>=<span class="string">"@drawable/pic2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure><p>previewå¦‚ä¸‹ï¼š</p><p><img src="/images/12.png" alt="scene1"></p><p>æœ€åæ˜¯java codeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ViewGroup mSceneRoot;</span><br><span class="line">    <span class="keyword">private</span> Scene mScene1;</span><br><span class="line">    <span class="keyword">private</span> Scene mScene2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mSceneRoot = findViewById(R.id.scene_root);</span><br><span class="line">        Button button = findViewById(R.id.button);</span><br><span class="line">        mScene1 = Scene.getSceneForLayout(mSceneRoot, R.layout.sence1, <span class="keyword">this</span>);</span><br><span class="line">        mScene2 = Scene.getSceneForLayout(mSceneRoot, R.layout.sence2, <span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span>[] mCurrentSence1 = &#123;<span class="keyword">true</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> ChangeBounds changeBounds = <span class="keyword">new</span> ChangeBounds();</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                TransitionManager.go(mCurrentSence1[<span class="number">0</span>] ? mScene2 : mScene1, changeBounds);</span><br><span class="line">                mCurrentSence1[<span class="number">0</span>] = !mCurrentSence1[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> é€šè¿‡javaä»£ç æˆ‘ä»¬å¯ä»¥ç®€å•çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ªSceneï¼Œåˆ†åˆ«æ˜¯Scene1å’ŒScene2ï¼Œä»–ä»¬åˆ†åˆ«å¯¹åº”äº†R.layout.sence1å’ŒR.layout.sence2ï¼Œè€Œå½“ç‚¹å‡»buttonæ‰§è¡Œåˆ‡æ¢åŠ¨ç”»æ—¶ï¼Œæ˜¯è°ƒç”¨äº†TransitionManagerçš„goæ–¹æ³•æ‰§è¡Œäº†mScene1å’ŒmScene2çš„åˆ‡æ¢ã€‚</p><h2 id="Transitionä»‹ç»"><a href="#Transitionä»‹ç»" class="headerlink" title="Transitionä»‹ç»"></a>Transitionä»‹ç»</h2><p>ç°åœ¨æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹Transitioné‡Œçš„ä¸€äº›æ¦‚å¿µï¼š</p><p>åœ¨ä¸¤ä¸ªlayoutä¹‹é—´æ‰§è¡ŒåŠ¨ç”»åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªè¿‡ç¨‹ï¼š</p><p>1.ä¸º<code>starting layout</code>å’Œ<code>ending layout</code>å„è‡ªåˆ›å»ºSceneï¼Œå½“å‰çš„layoutç»å¸¸ä¼šä½œä¸º<code>starting layout</code>ã€‚</p><p>2.åˆ›å»ºä¸€ä¸ªTransitionå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä½¿ç”¨å“ªç§æˆ–è€…å“ªäº›åŠ¨ç”»æ•ˆæœï¼Œæ¯”å¦‚æ·¡å…¥æ·¡å‡ºã€æ”¹å˜ä½ç½®å¤§å°ç­‰ç­‰ã€‚</p><p>3.è°ƒç”¨<code>TransitionManager.go()</code>æ‰§è¡ŒåŠ¨ç”»ã€‚</p><p>ç”¨å®˜ç½‘çš„ä¸€å¼ å›¾å¯ä»¥æ¸…æ¥šçš„è¡¨è¾¾å‡ºè¿™ä¸ªæµç¨‹ï¼š</p><p><img src="/images/13.png" alt="scene1"></p><h3 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h3><p>ä¸€ä¸ªSceneå­˜å‚¨äº†layoutä¸­viewçš„å±æ€§å€¼ã€‚transitionsæ¡†æ¶å¯ä»¥ä»starting sceneè¿‡æ¸¡åˆ°ending sceneã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªlayoutèµ„æºåˆ›å»ºä¸€ä¸ªsceneï¼Œ<code>Scene.getSceneForLayout(mSceneRoot, R.layout.sence1, this);</code>ï¼Œä¸Šé¢çš„demoå°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºSceneçš„ã€‚</p><blockquote><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªlayoutæ—¶ï¼Œä¸¤ä¸ªlayoutä¸­å¯¹åº”viewçš„idåº”è¯¥æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™åªèƒ½åšåˆ°ä¸¤ä¸ªlayoutçš„ç¬é—´è½¬æ¢ï¼Œè€Œæ²¡æœ‰ä¸€ä¸ªè¿‡æ¸¡çš„æ•ˆæœã€‚</p></blockquote><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä»ä¸€ä¸ªViewGroupä¸­åˆ›å»ºSceneå®ä¾‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Scene mScene;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Obtain the scene root element</span></span><br><span class="line">mSceneRoot = (ViewGroup) mSomeLayoutElement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Obtain the view hierarchy to add as a child of</span></span><br><span class="line"><span class="comment">// the scene root when this scene is entered</span></span><br><span class="line">mViewHierarchy = (ViewGroup) someOtherLayoutElement;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a scene</span></span><br><span class="line">mScene = <span class="keyword">new</span> Scene(mSceneRoot, mViewHierarchy);</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºScene-Actions"><a href="#åˆ›å»ºScene-Actions" class="headerlink" title="åˆ›å»ºScene Actions"></a>åˆ›å»ºScene Actions</h3><p>å½“æˆ‘ä»¬è¿›å…¥æˆ–è€…é€€å‡ºä¸€ä¸ªsceneçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€äº›è¡Œä¸ºï¼Œå½“ç„¶è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºTransitionæ¡†æ¶ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®ŒæˆåŠ¨ç”»è¿‡ç¨‹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢ä¸¤ä¸ªåœºæ™¯ä¸­ä½¿ç”¨Scene Actions:</p><p>1.å¯ä»¥ä¸ºä¸åœ¨åŒä¸€å±‚çº§çš„viewæ·»åŠ åŠ¨ç”»ã€‚</p><p>2.å¯ä»¥ä¸ºä¸èƒ½ç”±transitionæ¡†æ¶è‡ªåŠ¨æ‰§è¡Œçš„viewæ·»åŠ åŠ¨ç”»ï¼Œä¾‹å¦‚ListViewã€‚</p><p>Sceneä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªactionï¼Œ<code>Scene.setExitAction()</code>å’Œ<code>Scene.setEnterAction()</code>ï¼Œéœ€è¦æä¾›<code>Runnable</code>ä½œä¸ºå‚æ•°ã€‚åœ¨åŠ¨ç”»è¿è¡Œä¹‹å‰ï¼Œä¼šæ‰§è¡Œ<code>starting scene</code>çš„<code>setExitAction()</code>æ–¹æ³•ï¼›åœ¨åŠ¨ç”»è¿è¡Œä¹‹åï¼Œä¼šæ‰§è¡Œ<code>ending scene</code>çš„<code>setEnterAction()</code>æ–¹æ³•ã€‚</p><blockquote><p>ä¸è¦ä½¿ç”¨scene actionsåœ¨scenesçš„viewsä¹‹é—´ä¼ é€’æ•°æ®ã€‚</p></blockquote><p>ä¸‹é¢æˆ‘ä»¬åœ¨åŸæœ‰ä»£ç åŸºç¡€ä¸Šï¼Œå¢åŠ è¿™ä¸¤ä¸ªactionï¼Œç„¶åé€šè¿‡logï¼ŒéªŒè¯è¿™ä¸¤ä¸ªæ–¹æ³•è°ƒç”¨æ—¶æœºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lsd.transition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.transition.ChangeBounds;</span><br><span class="line"><span class="keyword">import</span> android.transition.Scene;</span><br><span class="line"><span class="keyword">import</span> android.transition.TransitionManager;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ViewGroup mSceneRoot;</span><br><span class="line">    <span class="keyword">private</span> Scene mScene1;</span><br><span class="line">    <span class="keyword">private</span> Scene mScene2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mSceneRoot = findViewById(R.id.scene_root);</span><br><span class="line">        Button button = findViewById(R.id.button);</span><br><span class="line">        mScene1 = Scene.getSceneForLayout(mSceneRoot, R.layout.sence1, <span class="keyword">this</span>);</span><br><span class="line">        mScene2 = Scene.getSceneForLayout(mSceneRoot, R.layout.sence2, <span class="keyword">this</span>);</span><br><span class="line">        mScene1.setEnterAction(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"MyTransition"</span>, <span class="string">"mScene1 enter"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mScene1.setExitAction(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"MyTransition"</span>, <span class="string">"mScene1 exit"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mScene2.setEnterAction(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"MyTransition"</span>, <span class="string">"mScene2 enter"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mScene2.setExitAction(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"MyTransition"</span>, <span class="string">"mScene2 exit"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span>[] mCurrentSence1 = &#123;<span class="keyword">true</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> ChangeBounds changeBounds = <span class="keyword">new</span> ChangeBounds();</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Log.d(<span class="string">"MyTransition"</span>, <span class="string">"click to change layout:"</span> + (mCurrentSence1[<span class="number">0</span>] ? <span class="string">"from Scene1 to Scene2"</span> : <span class="string">"from Scene2 to Scene1"</span>));</span><br><span class="line">                TransitionManager.go(mCurrentSence1[<span class="number">0</span>] ? mScene2 : mScene1, changeBounds);</span><br><span class="line">                mCurrentSence1[<span class="number">0</span>] = !mCurrentSence1[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å¤šæ¬¡ç‚¹å‡»buttonï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹è¾“å‡ºçš„logï¼š</p><blockquote><p>âœ  ~ adb logcat | grep â€œMyTransitionâ€</p><p>04-14 19:56:49.498 13662 13662 D MyTransition: click to change layout:from Scene1 to Scene2</p><p>04-14 19:56:49.507 13662 13662 D MyTransition: mScene2 enter</p><p>04-14 19:56:56.373 13662 13662 D MyTransition: click to change layout:from Scene2 to Scene1</p><p>04-14 19:56:56.373 13662 13662 D MyTransition: mScene2 exit</p><p>04-14 19:56:56.379 13662 13662 D MyTransition: mScene1 enter</p><p>04-14 19:57:02.466 13662 13662 D MyTransition: click to change layout:from Scene1 to Scene2</p><p>04-14 19:57:02.467 13662 13662 D MyTransition: mScene1 exit</p><p>04-14 19:57:02.473 13662 13662 D MyTransition: mScene2 enter</p><p>04-14 19:57:04.768 13662 13662 D MyTransition: click to change layout:from Scene2 to Scene1</p><p>04-14 19:57:04.769 13662 13662 D MyTransition: mScene2 exit</p><p>04-14 19:57:04.775 13662 13662 D MyTransition: mScene1 enter</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»buttonçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨<code>mScene1.setExitAction()</code>,æˆ‘ä¼šåœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« ä¸­ä»æºç å•ç‹¬åˆ†æè¿™ä¸€é—®é¢˜ã€‚</p><h2 id="åˆ›å»ºä¸€ä¸ªTransition"><a href="#åˆ›å»ºä¸€ä¸ªTransition" class="headerlink" title="åˆ›å»ºä¸€ä¸ªTransition"></a>åˆ›å»ºä¸€ä¸ªTransition</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„å‡ ä¸ªå­ç±»æ¥å®ä¾‹åŒ–Transitionï¼Œæ¯”å¦‚è¯´<code>AutoTransition</code>ã€<code>Fade</code>å’Œ<code>ChangeBounds</code>ã€‚</p><table><thead><tr><th>ç±»</th><th>æ ‡ç­¾</th><th>å±æ€§</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>AutoTransition</td><td><code>&lt;autoTansition/&gt;</code></td><td>-</td><td>é»˜è®¤æ•ˆæœï¼ŒæŒ‰ç…§æ·¡å‡ºã€æ›´æ”¹å¤§å°å’Œä½ç½®ã€æ·¡å…¥é¡ºåº</td></tr><tr><td>Fade</td><td><code>&lt;fade/&gt;</code></td><td><code>android:fadingMode=&quot;[fade_in\fade_out\fade_in_out]&quot;</code></td><td>fade_in æ·¡å…¥ fade_out æ·¡å‡º fade_in_out (é»˜è®¤) å…ˆæ·¡å‡ºåæ·¡å…¥</td></tr><tr><td>ChangeBounds</td><td><code>&lt;changeBounds/&gt;</code></td><td>-</td><td>æ›´æ”¹å¤§å°å’Œä½ç½®</td></tr></tbody></table><h3 id="ä»resourceæ–‡ä»¶ä¸­åˆ›å»ºtransition"><a href="#ä»resourceæ–‡ä»¶ä¸­åˆ›å»ºtransition" class="headerlink" title="ä»resourceæ–‡ä»¶ä¸­åˆ›å»ºtransition"></a>ä»resourceæ–‡ä»¶ä¸­åˆ›å»ºtransition</h3><p>res/transition/fade_transition.xmlï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fade</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Transition mFadeTransition =</span><br><span class="line">        TransitionInflater.from(<span class="keyword">this</span>).</span><br><span class="line">        inflateTransition(R.transition.fade_transition);</span><br></pre></td></tr></table></figure><h3 id="ç›´æ¥ä¸­javaä»£ç ä¸­åˆ›å»ºtransition"><a href="#ç›´æ¥ä¸­javaä»£ç ä¸­åˆ›å»ºtransition" class="headerlink" title="ç›´æ¥ä¸­javaä»£ç ä¸­åˆ›å»ºtransition"></a>ç›´æ¥ä¸­javaä»£ç ä¸­åˆ›å»ºtransition</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transition mFadeTransition = <span class="keyword">new</span> Fade();</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºäº†Transitionå®ä¾‹åï¼Œå¯ä»¥é€šè¿‡TransitionManagerçš„goæ–¹æ³•å¼€å¯åŠ¨ç”»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TransitionManager.go(mEndingScene, mFadeTransition);</span><br></pre></td></tr></table></figure><h2 id="ä¸ä½¿ç”¨Sceneæ¥å®ŒæˆTransition"><a href="#ä¸ä½¿ç”¨Sceneæ¥å®ŒæˆTransition" class="headerlink" title="ä¸ä½¿ç”¨Sceneæ¥å®ŒæˆTransition"></a>ä¸ä½¿ç”¨Sceneæ¥å®ŒæˆTransition</h2><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬åªæƒ³åœ¨å½“å‰è§†å›¾ä¸­å®Œæˆviewçš„æ·»åŠ åˆ é™¤æˆ–è€…æ˜¯ä¿®æ”¹æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸éœ€è¦å€ŸåŠ©Sceneã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå»¶è¿Ÿçš„transitionã€‚å³ä½¿ç”¨<code>TransitionManager.beginDelayedTransition()</code>æ¥å®Œæˆã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><p>  æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p>  <img src="/images/14.gif" alt=""></p><p>ä»£ç ä¹Ÿæå…¶ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lsd.transition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.transition.Fade;</span><br><span class="line"><span class="keyword">import</span> android.transition.TransitionManager;</span><br><span class="line"><span class="keyword">import</span> android.util.TypedValue;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.transition.Fade.IN;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.transition.Fade.OUT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TextView mLabelText;</span><br><span class="line">    <span class="keyword">private</span> ViewGroup mRootView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_second);</span><br><span class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!mLabelText.isAttachedToWindow())&#123;</span><br><span class="line">                    TransitionManager.beginDelayedTransition(mRootView, <span class="keyword">new</span> Fade(IN));</span><br><span class="line">                    mRootView.addView(mLabelText);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    TransitionManager.beginDelayedTransition(mRootView, <span class="keyword">new</span> Fade(OUT));</span><br><span class="line">                    mRootView.removeView(mLabelText);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Load the layout</span></span><br><span class="line"></span><br><span class="line">        mLabelText = <span class="keyword">new</span> TextView(<span class="keyword">this</span>);</span><br><span class="line">        mLabelText.setText(<span class="string">"Label"</span>);</span><br><span class="line">        mLabelText.setTextColor(Color.BLACK);</span><br><span class="line">        mLabelText.setTextSize(TypedValue.COMPLEX_UNIT_SP, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        mRootView = findViewById(R.id.mainLayout);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Transitionç”Ÿå‘½å‘¨æœŸå›è°ƒ"><a href="#Transitionç”Ÿå‘½å‘¨æœŸå›è°ƒ" class="headerlink" title="Transitionç”Ÿå‘½å‘¨æœŸå›è°ƒ"></a>Transitionç”Ÿå‘½å‘¨æœŸå›è°ƒ</h2><p>Transitionçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ ¹activityç±»ä¼¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Transition changeBounds = <span class="keyword">new</span> ChangeBounds();</span><br><span class="line">       changeBounds.addListener(<span class="keyword">new</span> Transition.TransitionListener() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionStart</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line">               </span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionEnd</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionCancel</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionPause</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionResume</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰Transition"><a href="#è‡ªå®šä¹‰Transition" class="headerlink" title="è‡ªå®šä¹‰Transition"></a>è‡ªå®šä¹‰Transition</h2><p>å½“å†…ç½®çš„Transitionæ•ˆæœä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰Transitionæ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿Transitionç±»ï¼Œå¹¶ä¸”é‡è½½å¿…è¦çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTransition</span> <span class="keyword">extends</span> <span class="title">Transition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureStartValues</span><span class="params">(TransitionValues values)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureEndValues</span><span class="params">(TransitionValues values)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animator <span class="title">createAnimator</span><span class="params">(ViewGroup sceneRoot,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   TransitionValues startValues,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   TransitionValues endValues)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Transitionå†…éƒ¨ä½¿ç”¨äº†å±æ€§åŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åƒå±æ€§åŠ¨ç”»é‚£æ ·æä¾›ä¸€ä¸ªèµ·å§‹å€¼å’Œç»“æŸå€¼ã€‚å®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦å­˜å‚¨ä¸€ä¸ªviewçš„ä¸€éƒ¨åˆ†å±æ€§ï¼Œæ¯”å¦‚å¦‚æœæˆ‘ä»¬è¦æ‰§è¡Œä¸€ä¸ªviewçš„èƒŒæ™¯è‰²çš„è¿‡æ¸¡ï¼Œé‚£ä¹ˆå°±éœ€è¦å­˜å‚¨èƒŒæ™¯è‰²è¿™æ ·çš„å±æ€§ï¼Œè€Œä¸éœ€è¦å»å­˜å‚¨ä½ç½®å¤§å°ã€‚</p><p>æˆ‘ä¹ˆåœ¨<code>captureStartValues(transitionValues)</code>æ–¹æ³•ä¸­ä¼ é€’èµ·å§‹viewçš„å€¼ï¼Œæ¡†æ¶ä¼šä¸º<code>starting scene</code>ä¸­çš„æ¯ä¸ªviewéƒ½è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å‚æ•°TransitionValuesåŒ…å«äº†å¯¹viewçš„å¼•ç”¨å’Œä¸€ä¸ªMapå®ä¾‹ï¼Œåœ¨Mapå®ä¾‹é‡Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨viewç›¸åº”çš„å±æ€§å€¼ã€‚</p><p>ä¸ºäº†ç¡®ä¿å­˜å‚¨çš„å±æ€§å€¼çš„keyä¸ä¸å…¶ä»–TransitionValuesçš„keyå†²çªï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„å‘½åæ–¹å¼ï¼š</p><p><code>package_name:transition_name:property_name</code></p><p>æ¯”å¦‚è¯´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTransition</span> <span class="keyword">extends</span> <span class="title">Transition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Define a key for storing a property value in</span></span><br><span class="line">    <span class="comment">// TransitionValues.values with the syntax</span></span><br><span class="line">    <span class="comment">// package_name:transition_class:property_name to avoid collisions</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PROPNAME_BACKGROUND =</span><br><span class="line">            <span class="string">"com.example.android.customtransition:CustomTransition:background"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureStartValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Call the convenience method captureValues</span></span><br><span class="line">        captureValues(transitionValues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For the view in transitionValues.view, get the values you</span></span><br><span class="line">    <span class="comment">// want and put them in transitionValues.values</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">captureValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Get a reference to the view</span></span><br><span class="line">        View view = transitionValues.view;</span><br><span class="line">        <span class="comment">// Store its background property in the values map</span></span><br><span class="line">        transitionValues.values.put(PROPNAME_BACKGROUND, view.getBackground());</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> <code>captureEndValues(TransitionValues)</code>ä¸ <code>captureStartValues(TransitionValues)</code>å«ä¹‰ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒæ˜¯ç”¨æ¥å­˜å‚¨<code>ending scene</code>çš„viewçš„å¯¹åº”çš„å±æ€§å€¼ã€‚</p><p> æˆ‘ä»¬åœ¨<code>createAnimator</code>æ–¹æ³•ä¸­è¿›è¡Œ<code>starting scene</code>å’Œ<code>ending scene</code>çš„è¿‡æ¸¡ï¼Œç³»ç»Ÿè°ƒç”¨<code>createAnimator</code>çš„æ¬¡æ•°å…·ä½“ä¾èµ–äºä¸¤ä¸ªsceneä¹‹é—´çš„å·®å¼‚ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨çš„è¦åœ¨<code>starting scene</code>å’Œ<code>ending scene</code>ä¹‹é—´è¿›è¡Œæ·¡å‡º/æ·¡å…¥åŠ¨ç”»ï¼Œ<code>starting scene</code>ä¸€å…±æœ‰5ä¸ªtarget viewï¼Œå…¶ä¸­ä¸¤ä¸ªä¼šåœ¨<code>ending scene</code>ä¸­ç§»é™¤ï¼Œå‰©ä¸‹ä¸‰ä¸ªä¿ç•™åœ¨<code>ending scene</code>ä¸­ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ<code>ending scene</code>ä¼šé¢å¤–æ·»åŠ ä¸€ä¸ªtarget viewï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè°ƒç”¨<code>createAnimator</code>æ–¹æ³•6æ¬¡ï¼šå…¶ä¸­3æ¬¡æ˜¯å¯¹åŒæ—¶ä¿ç•™åœ¨<code>starting scene</code>å’Œ<code>ending scene</code>ä¸­çš„target viewè¿›è¡Œæ·¡å‡ºæ·¡å…¥åŠ¨ç”»ï¼Œ2æ¬¡å¯¹<code>starting scene</code>ä¸­è¦ç§»é™¤çš„viewè¿›è¡Œæ·¡å‡ºåŠ¨ç”»ï¼Œ1æ¬¡æ˜¯å¯¹<code>ending scene</code>è¦æ·»åŠ çš„viewè¿›è¡Œæ·¡å…¥åŠ¨ç”»ã€‚</p><p> æœ‰çš„viewåŒæ—¶å­˜åœ¨äº<code>starting scene</code>å’Œ<code>ending scene</code>ä¸­ï¼Œæ­¤æ—¶<code>TransitionValues</code>çš„<code>startValues</code>å’Œ<code>endValues</code>éƒ½æ˜¯æœ‰å€¼çš„ï¼›ä½†æ˜¯æœ‰æ—¶å€™viewåªå­˜åœ¨äº<code>starting scene</code>æˆ–<code>ending scene</code>ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹åº”çš„<code>startValues</code>æˆ–<code>endValues</code>æ˜¯æœ‰å€¼çš„ï¼Œå¦ä¸€ä¸ªå€¼æ˜¯nullã€‚</p><p> æˆ‘ä»¬åœ¨<code>createAnimator(ViewGroup, TransitionValues, TransitionValues)</code>æ–¹æ³•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªAnimatorå®Œæˆæˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p> ä¸¤ç§’æ—¶é—´å†…å®ŒæˆèƒŒæ™¯è‰²çš„æ¸å˜ï¼š</p><p> <img src="/images/15.gif" alt=""></p><p> æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2014 The Android Open Source Project</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.lsd.transition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.animation.Animator;</span><br><span class="line"><span class="keyword">import</span> android.animation.ArgbEvaluator;</span><br><span class="line"><span class="keyword">import</span> android.animation.ValueAnimator;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.ColorDrawable;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"><span class="keyword">import</span> android.transition.Transition;</span><br><span class="line"><span class="keyword">import</span> android.transition.TransitionValues;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChangeColor</span> <span class="keyword">extends</span> <span class="title">Transition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Key to store a color value in TransitionValues object</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PROPNAME_BACKGROUND = <span class="string">"com.lsd.transition:change_color:background"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convenience method: Add the background Drawable property value</span></span><br><span class="line"><span class="comment">     * to the TransitionsValues.value Map for a target.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">captureValues</span><span class="params">(TransitionValues values)</span> </span>&#123;</span><br><span class="line">        values.values.put(PROPNAME_BACKGROUND, values.view.getBackground());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureStartValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        captureValues(transitionValues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">captureEndValues</span><span class="params">(TransitionValues transitionValues)</span> </span>&#123;</span><br><span class="line">        captureValues(transitionValues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animator <span class="title">createAnimator</span><span class="params">(ViewGroup sceneRoot,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   TransitionValues startValues, TransitionValues endValues)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == startValues || <span class="keyword">null</span> == endValues) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> View view = endValues.view;</span><br><span class="line">        Drawable startBackground = (Drawable) startValues.values.get(PROPNAME_BACKGROUND);</span><br><span class="line">        Drawable endBackground = (Drawable) endValues.values.get(PROPNAME_BACKGROUND);</span><br><span class="line">        <span class="keyword">if</span> (startBackground <span class="keyword">instanceof</span> ColorDrawable &amp;&amp; endBackground <span class="keyword">instanceof</span> ColorDrawable) &#123;</span><br><span class="line">            ColorDrawable startColor = (ColorDrawable) startBackground;</span><br><span class="line">            ColorDrawable endColor = (ColorDrawable) endBackground;</span><br><span class="line">            <span class="keyword">if</span> (startColor.getColor() != endColor.getColor()) &#123;</span><br><span class="line">                ValueAnimator animator = ValueAnimator.ofObject(<span class="keyword">new</span> ArgbEvaluator(),</span><br><span class="line">                        startColor.getColor(), endColor.getColor());</span><br><span class="line">                animator.setDuration(<span class="number">2000</span>);</span><br><span class="line">                animator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">                        Object value = animation.getAnimatedValue();</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">null</span> != value) &#123;</span><br><span class="line">                            view.setBackgroundColor((Integer) value);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> animator;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Transitioné™åˆ¶"><a href="#Transitioné™åˆ¶" class="headerlink" title="Transitioné™åˆ¶"></a>Transitioné™åˆ¶</h2><p>1.å¯¹äºSurfaceViewå¯èƒ½ä¸èµ·æ•ˆæœï¼Œå› ä¸ºSurfaceViewçš„å®ä¾‹æ˜¯åœ¨éUIçº¿ç¨‹æ›´æ–°çš„ï¼Œå¯èƒ½æ— æ³•ä¸å…¶ä»–viewçš„åŠ¨ç”»åŒæ­¥ã€‚</p><p>2.æŸäº›ç‰¹å®šçš„è¿‡æ¸¡ç±»å‹åœ¨åº”ç”¨åˆ°TextureViewä¸Šæ—¶å¯èƒ½ä¸ä¼šäº§ç”Ÿç‰¹å®šçš„æ•ˆæœã€‚</p><p>3.ç»§æ‰¿è‡ªAdapterViewçš„ç±»å¦‚ListViewï¼Œä¸è¯¥æ¡†æ¶ä¸å…¼å®¹ã€‚</p><p>4.åœ¨å¯¹TextViewè¿›è¡Œresizeæ—¶ï¼Œåœ¨åŠ¨ç”»å®Œæˆä¹‹å‰ï¼Œæ–‡æœ¬å¯èƒ½ä¼šè¢«æ”¾åˆ°ä¸€ä¸ªæ–°ä½ç½®ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œä¸è¦å¯¹åŒ…å«æ–‡æœ¬çš„viewè¿›è¡Œresizeã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡å­¦ä¹ æ€»ç»“äº&lt;a href=&quot;https://developer.android.com/training/transitions/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://developer.android.c
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="åŠ¨ç”»" scheme="http://lisongda.com/tags/%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>ä½³å¥æ”¶è—</title>
    <link href="http://lisongda.com/2018/04/07/%E4%BD%B3%E5%8F%A5%E6%94%B6%E8%97%8F/"/>
    <id>http://lisongda.com/2018/04/07/ä½³å¥æ”¶è—/</id>
    <published>2018-04-07T11:10:47.000Z</published>
    <updated>2018-04-07T11:25:57.733Z</updated>
    
    <content type="html"><![CDATA[<p>1.</p><blockquote><p>The steps you take donâ€™t need to be big, they just need to take you in the right direction.</p><p>ä½ è¿ˆå‡ºçš„æ­¥ä¼ä¸éå¾—å¾ˆå¤§ï¼Œåªè¦ä½ æ˜¯åœ¨å¾€æ­£ç¡®çš„æ–¹å‘å‰è¿›å°±è¡Œã€‚<br>â€”ã€Šç¥ç›¾å±€ç‰¹å·¥ã€‹</p></blockquote><p>è¿™æ®µè¯å‡ºè‡ªç¥ç›¾å±€ç‰¹å·¥ï¼Œä¸€éƒ¨æˆ‘è¿½äº†å¤§æ¦‚æœ‰ä¸‰å››å¹´å·¦å³çš„ç¾å‰§ã€‚</p><p>2.</p><blockquote><p>ä½ æ˜¯é˜³å…‰ä¸‹çš„æœ¨å¶ï¼Œæˆ‘æ˜¯é»‘æš—ä¸­çš„æ ¹ã€‚   â€”ã€Šç«å½±å¿è€…ã€‹</p></blockquote><p>ç«å½±å¿è€…ä¼´éšç€æˆ‘æˆé•¿ï¼Œç§Ÿæ¼«ç”»ä¹¦ã€ç§Ÿå…‰ç¢Ÿã€è·‘å»ç½‘å§çœ‹ç«å½±ã€ç©ç«å½±æ¸¸æˆï¼Œè¿™éƒ¨åŠ¨æ¼«ç°åœ¨ç®—ç®—å·²ç»é™ªä¼´æˆ‘åäº”å¹´äº†ï¼Œè™½ç„¶åœ¨å¤§äºŒæ—¶æ¼«ç”»å®Œç»“äº†ï¼Œä½†å¯¹è¿™éƒ¨åŠ¨æ¼«çš„æ„Ÿæƒ…åº”è¯¥æ˜¯æ— å¯æ›¿ä»£çš„ã€‚è¿™å¥è¯æ˜¯æˆ‘è®¤ä¸ºç«å½±ä¸­æœ€ç»å…¸çš„ä¸€å¥è¯ï¼Œç”±ä¸€ä¸ªåæ´¾è§’è‰²å¿—æ‘å›¢è—ä¸´æ­»å‰æ‰€è¯´ã€‚ä½ æ˜¯æ„¿æ„åšæ²æµ´ç€é˜³å…‰çš„æœ¨å¶å‘¢ï¼Ÿè¿˜æ˜¯æ„¿æ„åšéšå¿çš„æ ¹å‘¢ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;1.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The steps you take donâ€™t need to be big, they just need to take you in the right direction.&lt;/p&gt;
&lt;p&gt;ä½ è¿ˆå‡ºçš„æ­¥ä¼ä¸éå¾—å¾ˆå¤§ï¼Œåªè¦ä½ 
      
    
    </summary>
    
      <category term="ç”Ÿæ´»" scheme="http://lisongda.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="ç”Ÿæ´»" scheme="http://lisongda.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»ç³»åˆ—ä¹‹äºŒä½¿ç”¨åŠ¨ç”»æ˜¾ç¤ºæˆ–éšè—View</title>
    <link href="http://lisongda.com/2018/04/03/Android%E5%8A%A8%E7%94%BB%E7%B3%BB%E5%88%97%E4%B9%8B%E4%BA%8C%E4%BD%BF%E7%94%A8%E5%8A%A8%E7%94%BB%E6%98%BE%E7%A4%BA%E6%88%96%E9%9A%90%E8%97%8FView/"/>
    <id>http://lisongda.com/2018/04/03/AndroidåŠ¨ç”»ç³»åˆ—ä¹‹äºŒä½¿ç”¨åŠ¨ç”»æ˜¾ç¤ºæˆ–éšè—View/</id>
    <published>2018-04-03T09:05:18.000Z</published>
    <updated>2018-04-04T08:20:34.002Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œviewçš„ç°å®å’Œéšè—å¹¶ä¸æ˜¯ç®€å•çš„setVisibility(),è€Œæ˜¯ä½¿ç”¨åŠ¨ç”»æ¥å®Œæˆã€‚ä¸»è¦å‚è€ƒ<a href="https://developer.android.com/training/animation/reveal-or-hide-view.html" target="_blank" rel="noopener">https://developer.android.com/training/animation/reveal-or-hide-view.html</a>.</p><p>æœ¬æ–‡æ‰€æœ‰ä»£ç <a href="https://github.com/Brooks0129/RevealHideAnimation" target="_blank" rel="noopener">githubåœ°å€</a>ã€‚</p><h2 id="æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼ˆCrossfadeï¼‰"><a href="#æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼ˆCrossfadeï¼‰" class="headerlink" title="æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼ˆCrossfadeï¼‰"></a>æ·¡å…¥æ·¡å‡ºæ•ˆæœï¼ˆCrossfadeï¼‰</h2><p>æ·¡å…¥æ·¡å‡ºæ•ˆæœæŒ‡çš„æ˜¯ä¸€ä¸ªViewæˆ–è€…ViewGroupæ·¡å‡ºçš„åŒæ—¶å¦å¤–ä¸€ä¸ªViewæˆ–è€…ViewGroupæ·¡å…¥ã€‚</p><p> å…ˆçœ‹ä¸‹æ•ˆæœï¼š</p><p> <img src="/images/7.gif" alt=""></p><p> ä¸»è¦ä½¿ç”¨<code>ViewPropertyAnimator</code>å®ŒæˆåŠ¨ç”»ã€‚ å…³äº<code>ViewPropertyAnimator</code>çš„ä½¿ç”¨å¯ä»¥å‚è€ƒ<a href="https://lisongda.com/2018/04/03/AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸€å±æ€§åŠ¨ç”»çš„ä¸€äº›tips">https://lisongda.com/2018/04/03/AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸€å±æ€§åŠ¨ç”»çš„ä¸€äº›tips</a></p><p> æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">crossfade</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Set the content view to 0% opacity but visible, so that it is visible</span></span><br><span class="line">     <span class="comment">// (but fully transparent) during the animation.</span></span><br><span class="line">     mContentView.setAlpha(<span class="number">0f</span>);</span><br><span class="line">     mContentView.setVisibility(View.VISIBLE);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Animate the content view to 100% opacity, and clear any animation</span></span><br><span class="line">     <span class="comment">// listener set on the view.</span></span><br><span class="line">     mContentView.animate()</span><br><span class="line">             .alpha(<span class="number">1f</span>)</span><br><span class="line">             .setDuration(mShortAnimationDuration)</span><br><span class="line">             .setListener(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Animate the loading view to 0% opacity. After the animation ends,</span></span><br><span class="line">     <span class="comment">// set its visibility to GONE as an optimization step (it won't</span></span><br><span class="line">     <span class="comment">// participate in layout passes, etc.)</span></span><br><span class="line">     mLoadingView.animate()</span><br><span class="line">             .alpha(<span class="number">0f</span>)</span><br><span class="line">             .setDuration(mShortAnimationDuration)</span><br><span class="line">             .setListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">                     mLoadingView.setVisibility(View.GONE);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p> mShortAnimationDurationå¯ä»¥è‡ªå®šä¹‰æ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»Ÿå¯¹äºçŸ­æš‚åŠ¨ç”»é»˜è®¤çš„æ—¶é—´ã€‚</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrieve and cache the system's default "short" animation time.</span></span><br><span class="line">       mShortAnimationDuration = getResources().getInteger(</span><br><span class="line">               android.R.integer.config_shortAnimTime);</span><br></pre></td></tr></table></figure><h2 id="å¡ç‰‡ç¿»è½¬æ•ˆæœï¼ˆCard-flipï¼‰"><a href="#å¡ç‰‡ç¿»è½¬æ•ˆæœï¼ˆCard-flipï¼‰" class="headerlink" title="å¡ç‰‡ç¿»è½¬æ•ˆæœï¼ˆCard flipï¼‰"></a>å¡ç‰‡ç¿»è½¬æ•ˆæœï¼ˆCard flipï¼‰</h2><p>å…ˆæ¥çœ‹ä¸‹æ•ˆæœå›¾ï¼š</p><p><img src="/images/8.gif" alt=""></p><p>è¿™é‡Œçš„æ•ˆæœå…¶å®æ˜¯ä¸¤ä¸ªFragmentåˆ‡æ¢çš„åŠ¨ç”»ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªä¸¤ä¸ªFragmentåˆ†åˆ«å«åšCardFrontFragmentå’ŒCardBackFragmentã€‚</p><p>ä¸€å…±éœ€è¦å››ä¸ªåŠ¨ç”»xmlæ–‡ä»¶ã€‚å¯¹äºç¬¬ä¸€ä¸ªåˆ‡æ¢åŠ¨ç”»ï¼ŒCardFrontFragmenté€€å‡ºï¼ŒCardBackFragmentè¿›å…¥ã€‚äºŒè€…å¯¹åº”çš„åŠ¨ç”»æ–‡ä»¶åˆ†åˆ«ä¸ºï¼š</p><blockquote><p>RevealHideAnimation/app/src/main/res/animator/card_flip_right_out.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Rotate. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"-180"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"rotationY"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:interpolator/accelerate_decelerate"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"@integer/card_flip_time_full"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Half-way through the rotation (see startOffset), set the alpha to 0. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"@integer/card_flip_time_half"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CardFrontFragmenté€€å‡ºåŠ¨ç”»åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç»•yè½´ä»å³å‘å·¦æ—‹è½¬180åº¦ï¼Œæ•´ä¸ªåŠ¨ç”»æŒç»­æ—¶é—´<code>@integer/card_flip_time_full</code>å³2mï¼Œåœ¨åŠ¨ç”»è¿›è¡Œåˆ°ä¸€åŠå³1mæ—¶ï¼Œå¹¶è¡Œæ‰§è¡Œå¦å¤–ä¸€ä¸ªåŠ¨ç”»ï¼Œé€æ˜åº¦å˜ä¸ºå®Œå…¨é€æ˜ï¼ŒæŒç»­æ—¶é—´1msï¼Œè‚‰çœ¼æ„Ÿè§‰ç«‹åˆ»æ¶ˆå¤±ã€‚è¿™å°±æ˜¯CardFrontFragmenté€€å‡ºã€‚</p><blockquote><p>RevealHideAnimation/app/src/main/res/animator/card_flip_right_in.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Before rotating, immediately set the alpha to 0. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Rotate. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"180"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"rotationY"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:interpolator/accelerate_decelerate"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"@integer/card_flip_time_full"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Half-way through the rotation (see startOffset), set the alpha to 1. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"@integer/card_flip_time_half"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1000"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CardBackFragmentè¿›å…¥åŠ¨ç”»åˆ†ä¸ºä¸‰éƒ¨åˆ†ã€‚é¦–å…ˆé€šè¿‡æ”¹å˜alphaçš„å€¼è®©fragmentç«‹åˆ»æ¶ˆå¤±ï¼Œç„¶åç«‹åˆ»ç»•yè½´ä»å³å‘å·¦æ—‹è½¬180åº¦ï¼ˆç»ˆç‚¹æ˜¯0åº¦ï¼‰ï¼Œæ­¤æ—¶Fragmentä»ç„¶æ˜¯ä¸å¯è§çŠ¶æ€ï¼Œå½“æ—‹è½¬åˆ°ä¸€åŠæ—¶ï¼Œå¹¶è¡Œæ‰§è¡Œç¬¬ä¸‰ä¸ªåŠ¨ç”»ï¼Œé€æ˜åº¦ä»0åˆ°1,å˜ä¸ºå¯è§ã€‚</p><p>ç‚¹å‡»è¿”å›é”®æ—¶ï¼ŒCardBackFragmenté€€å‡ºï¼ŒCardFrontFragmentè¿›å…¥ï¼Œä»ç„¶éœ€è¦ä¸¤ä¸ªæ–‡ä»¶ã€‚åˆ†åˆ«å¯¹åº”ï¼š</p><blockquote><p>RevealHideAnimation/app/src/main/res/animator/card_flip_left_out.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Rotate. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"180"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"rotationY"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:interpolator/accelerate_decelerate"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"@integer/card_flip_time_full"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Half-way through the rotation (see startOffset), set the alpha to 0. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"@integer/card_flip_time_half"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>RevealHideAnimation/app/src/main/res/animator/card_flip_left_in.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Before rotating, immediately set the alpha to 0. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Rotate. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"-180"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"rotationY"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:interpolator</span>=<span class="string">"@android:interpolator/accelerate_decelerate"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"@integer/card_flip_time_full"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Half-way through the rotation (see startOffset), set the alpha to 1. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"0.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"@integer/card_flip_time_half"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŠ¨ç”»è¿‡ç¨‹ä¸ä¸Šé¢åˆ†æçš„å·®ä¸å¤šï¼Œå°±ä¸èµ˜è¿°äº†ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨activityåˆ›å»ºåˆ‡æ¢Fragmentçš„åœ°æ–¹ï¼Œè®¾ç½®è¿™å››ä¸ªåŠ¨ç”»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">getFragmentManager()</span><br><span class="line">        .beginTransaction()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Replace the default fragment animations with animator resources representing</span></span><br><span class="line">        <span class="comment">// rotations when switching to the back of the card, as well as animator</span></span><br><span class="line">        <span class="comment">// resources representing rotations when flipping back to the front (e.g. when</span></span><br><span class="line">        <span class="comment">// the system Back button is pressed).</span></span><br><span class="line">        .setCustomAnimations(</span><br><span class="line">                R.animator.card_flip_right_in, R.animator.card_flip_right_out,</span><br><span class="line">                R.animator.card_flip_left_in, R.animator.card_flip_left_out)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Replace any fragments currently in the container view with a fragment</span></span><br><span class="line">        <span class="comment">// representing the next page (indicated by the just-incremented currentPage</span></span><br><span class="line">        <span class="comment">// variable).</span></span><br><span class="line">        .replace(R.id.container, <span class="keyword">new</span> CardBackFragment())</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add this transaction to the back stack, allowing users to press Back</span></span><br><span class="line">        <span class="comment">// to get to the front of the card.</span></span><br><span class="line">        .addToBackStack(<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commit the transaction.</span></span><br><span class="line">        .commit();</span><br></pre></td></tr></table></figure><h2 id="ç¯å½¢æ˜¾ç¤ºæ•ˆæœï¼ˆCircular-Revealï¼‰"><a href="#ç¯å½¢æ˜¾ç¤ºæ•ˆæœï¼ˆCircular-Revealï¼‰" class="headerlink" title="ç¯å½¢æ˜¾ç¤ºæ•ˆæœï¼ˆCircular Revealï¼‰"></a>ç¯å½¢æ˜¾ç¤ºæ•ˆæœï¼ˆCircular Revealï¼‰</h2><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/images/9.gif" alt=""></p><p>ä½¿ç”¨<code>ViewAnimationUtils.createCircularReveal()</code>æ–¹æ³•æ¥å®ŒæˆåŠ¨ç”»ã€‚æ”¯æŒAndroid 5.0åŠä»¥ä¸Šã€‚</p><p>å±•å¼€åŠ¨ç”»ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check if the runtime version is at least Lollipop</span></span><br><span class="line">   <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">       <span class="comment">// get the center for the clipping circle</span></span><br><span class="line">       <span class="keyword">int</span> cx = view.getWidth() / <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">int</span> cy = view.getHeight() / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// get the final radius for the clipping circle</span></span><br><span class="line">       <span class="keyword">float</span> finalRadius = (<span class="keyword">float</span>) Math.hypot(cx, cy);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// create the animator for this view (the start radius is zero)</span></span><br><span class="line">       Animator anim =</span><br><span class="line">               ViewAnimationUtils.createCircularReveal(view, cx, cy, <span class="number">0</span>, finalRadius);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// make the view visible and start the animation</span></span><br><span class="line">       view.setVisibility(View.VISIBLE);</span><br><span class="line">       anim.setDuration(<span class="number">2000</span>);</span><br><span class="line">       anim.start();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">// set the view to visible without a circular reveal animation below Lollipop</span></span><br><span class="line">       view.setVisibility(View.VISIBLE);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>éšè—æ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">       <span class="keyword">int</span> cx = view.getWidth() / <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">int</span> cy = view.getHeight() / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">float</span> initialRadius = (<span class="keyword">float</span>) Math.hypot(cx, cy);</span><br><span class="line"></span><br><span class="line">       Animator anim =</span><br><span class="line">               ViewAnimationUtils.createCircularReveal(view, cx, cy, initialRadius, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">       anim.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">super</span>.onAnimationEnd(animation);</span><br><span class="line">               view.setVisibility(View.INVISIBLE);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       anim.setDuration(<span class="number">2000</span>);</span><br><span class="line">       anim.start();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       view.setVisibility(View.VISIBLE);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å…¶å®æ ¸å¿ƒä»£ç å°±æ˜¯<code>ViewAnimationUtils.createCircularReveal(view, cx, cy, 0, finalRadius);</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ“ä½œçš„viewï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯åœ†å½¢çš„åŸç‚¹åæ ‡ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯èµ·å§‹åŠå¾„ï¼Œç¬¬äº”ä¸ªå‚æ•°æ˜¯ç»“æŸåŠå¾„ã€‚</p><hr><p>ä¸Šè¿°ä¸‰ä¸ªåŠ¨ç”»å®Œæ•´ä»£ç åœ°å€<a href="https://github.com/Brooks0129/RevealHideAnimation" target="_blank" rel="noopener">github</a>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™é‡Œviewçš„ç°å®å’Œéšè—å¹¶ä¸æ˜¯ç®€å•çš„setVisibility(),è€Œæ˜¯ä½¿ç”¨åŠ¨ç”»æ¥å®Œæˆã€‚ä¸»è¦å‚è€ƒ&lt;a href=&quot;https://developer.android.com/training/animation/reveal-or-hide-view.html&quot; targe
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="AndroidåŠ¨ç”»" scheme="http://lisongda.com/tags/Android%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸€å±æ€§åŠ¨ç”»çš„ä¸€äº›tips</title>
    <link href="http://lisongda.com/2018/04/03/Android%E5%8A%A8%E7%94%BB%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB%E7%9A%84%E4%B8%80%E4%BA%9Btips/"/>
    <id>http://lisongda.com/2018/04/03/AndroidåŠ¨ç”»ç³»åˆ—ä¹‹ä¸€å±æ€§åŠ¨ç”»çš„ä¸€äº›tips/</id>
    <published>2018-04-03T07:02:50.000Z</published>
    <updated>2018-04-03T09:04:04.357Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡å­¦ä¹ æ€»ç»“äº<a href="https://developer.android.com/guide/topics/graphics/prop-animation.html" target="_blank" rel="noopener">https://developer.android.com/guide/topics/graphics/prop-animation.html</a></p><h2 id="ValueAnimatorä¸ObjectAnimatorçš„åŒºåˆ«"><a href="#ValueAnimatorä¸ObjectAnimatorçš„åŒºåˆ«" class="headerlink" title="ValueAnimatorä¸ObjectAnimatorçš„åŒºåˆ«"></a>ValueAnimatorä¸ObjectAnimatorçš„åŒºåˆ«</h2><p>ValueAnimatoræ˜¯å±æ€§åŠ¨ç”»çš„ä¸»è¦é©±åŠ¨å¼•æ“ï¼Œå®ƒä¼šè®¡ç®—éœ€è¦æ”¹å˜çš„å±æ€§å€¼ã€‚å±æ€§å€¼çš„æ”¹å˜ä¸€å…±éœ€è¦ä¸¤æ­¥å®Œæˆï¼š1æ˜¯æ”¹å˜å±æ€§å€¼ï¼Œ2æ˜¯å°†è®¡ç®—å‡ºçš„å€¼è®¾ç½®åˆ°å¯¹è±¡ä¸Šã€‚ValueAnimatoræ— æ³•è‡ªåŠ¨å®Œæˆç¬¬äºŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦ç›‘å¬å±æ€§å€¼çš„æ”¹å˜ï¼Œç„¶åæ‰‹åŠ¨è®¾ç½®åˆ°å¯¹è±¡ä¸Šã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator animation = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">100f</span>);</span><br><span class="line">animation.setDuration(<span class="number">1000</span>);</span><br><span class="line">animation.start();</span><br><span class="line">animation.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator updatedAnimation)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// You can use the animated value in a property that uses the</span></span><br><span class="line">        <span class="comment">// same type as the animation. In this case, you can use the</span></span><br><span class="line">        <span class="comment">// float value in the translationX property.</span></span><br><span class="line">        <span class="keyword">float</span> animatedValue = (<span class="keyword">float</span>)updatedAnimation.getAnimatedValue();</span><br><span class="line">        textView.setTranslationX(animatedValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ObjectAnimatoræ˜¯ValueAnimatorçš„å­ç±»ï¼Œå®ƒå¯ä»¥ç›´æ¥é©±åŠ¨å¯¹è±¡çš„ç›¸åº”å±æ€§ï¼Œå¯¹è±¡çš„å±æ€§å€¼ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬åœ¨<code>ValueAnimator.AnimatorUpdateListener</code>ä¸­æ‰‹åŠ¨è®¾ç½®ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator animation = ObjectAnimator.ofFloat(textView, <span class="string">"translationX"</span>, <span class="number">100f</span>);</span><br><span class="line">animation.setDuration(<span class="number">1000</span>);</span><br><span class="line">animation.start();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ObjectAnimatoræ˜¯æœ‰é™åˆ¶çš„ã€‚</p><ul><li><p>è¦æ”¹å˜çš„å±æ€§å€¼å¿…é¡»è¦æœ‰setteræ–¹æ³•ï¼Œ<code>set&lt;PropertyName&gt;()</code>ï¼Œå› ä¸ºObjectAnimatoråœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨æ›´æ–°å±æ€§å€¼ï¼Œå®ƒå¿…é¡»é€šè¿‡setteræ–¹æ³•æ¥èµ‹å€¼ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœå±æ€§åå­—æ˜¯fooï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ä¸€ä¸ªsetFoo()æ–¹æ³•ã€‚é‚£ä¹ˆç°åœ¨é—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘ä»¬è®¿é—®çš„ç±»ä¸­æ²¡æœ‰å¯¹åº”çš„setteræ–¹æ³•æ€ä¹ˆåŠï¼Ÿæœ‰ä¸‰ä¸ªè§£å†³åŠæ³•ï¼š</p><p>1.å¦‚æœæˆ‘ä»¬æœ‰æƒé™ä¿®æ”¹æ”¹ç±»çš„è¯ï¼Œç›´æ¥ä¸ºå¯¹åº”å±æ€§åŠ ä¸Šsetteræ–¹æ³•ã€‚</p><p>2.ä½¿ç”¨ä¸€ä¸ªåŒ…è£…ç±»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŒ…è£…ç±»é‡Œä½¿ç”¨setteræ–¹æ³•ï¼Œç„¶åå†æ”¹å˜åŸå¯¹è±¡å±æ€§çš„å€¼ã€‚</p><p>3.ä½¿ç”¨ValueAnimatorã€‚</p></li><li><p>å¦‚æœObjectAnimatorçš„<code>values...</code>å‚æ•°åªæœ‰ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼æ˜¯åŠ¨ç”»çš„ç»“æŸæ—¶çš„å€¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªèµ·å§‹å€¼ï¼Œç³»ç»Ÿä¼šè¯»å–è¯¥å±æ€§çš„é»˜è®¤å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±éœ€è¦getteræ–¹æ³•<code>get&lt;PropertyName&gt;()</code>ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœå±æ€§åå­—æ˜¯fooï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ä¸€ä¸ªgetFoo()æ–¹æ³•ã€‚</p></li><li><p>setteræ–¹æ³•ä¼ é€’çš„å€¼åº”è¯¥å’Œgetteræ–¹æ³•è·å–çš„å€¼çš„ç±»å‹ä¿æŒä¸€è‡´ã€‚</p></li></ul><h2 id="å±æ€§åŠ¨ç”»ä¸­çš„å›è°ƒ"><a href="#å±æ€§åŠ¨ç”»ä¸­çš„å›è°ƒ" class="headerlink" title="å±æ€§åŠ¨ç”»ä¸­çš„å›è°ƒ"></a>å±æ€§åŠ¨ç”»ä¸­çš„å›è°ƒ</h2><ul><li><p>Animator.AnimatorListener</p><p>  Animator.AnimatorListenerä¸­æœ‰å››ä¸ªéœ€è¦å»å®ç°çš„æ–¹æ³•ã€‚</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(textView, <span class="string">"translationX"</span>, <span class="number">0f</span>, <span class="number">100f</span>);</span><br><span class="line">objectAnimator.setDuration(<span class="number">100</span>);</span><br><span class="line">objectAnimator.start();</span><br><span class="line">objectAnimator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>ValueAnimator.AnimatorUpdateListener</p><p>ValueAnimator.AnimatorUpdateListenerä¸­çš„onAnimationUpdate()æ–¹æ³•ä¼šåœ¨åŠ¨ç”»çš„æ¯ä¸€å¸§è°ƒç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator valueAnimator = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">100f</span>);</span><br><span class="line">valueAnimator.setDuration(<span class="number">100</span>);</span><br><span class="line">valueAnimator.start();</span><br><span class="line">valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> animatedValue = (<span class="keyword">float</span>) animation.getAnimatedValue();</span><br><span class="line">        textView.setTranslationX(animatedValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>AnimatorListenerAdapter<br>ä½¿ç”¨AnimatorListenerAdapteræˆ‘ä»¬ä¸å¿…å»å®ç°Animator.AnimatorListenerä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ValueAnimator fadeAnim = ObjectAnimator.ofFloat(newBall, <span class="string">"alpha"</span>, <span class="number">1f</span>, <span class="number">0f</span>);</span><br><span class="line">fadeAnim.setDuration(<span class="number">250</span>);</span><br><span class="line">fadeAnim.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">    balls.remove(((ObjectAnimator)animation).getTarget());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨StateListAnimatoræ¥æç»˜viewä¸åŒçŠ¶æ€"><a href="#ä½¿ç”¨StateListAnimatoræ¥æç»˜viewä¸åŒçŠ¶æ€" class="headerlink" title="ä½¿ç”¨StateListAnimatoræ¥æç»˜viewä¸åŒçŠ¶æ€"></a>ä½¿ç”¨StateListAnimatoræ¥æç»˜viewä¸åŒçŠ¶æ€</h2><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨viewæŒ‰ä¸‹å’Œæ¾å¼€çš„æ—¶å€™ä¸ºviewæŒ‡å®šä¸åŒçš„åŠ¨ç”»æ•ˆæœï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- the pressed state; increase x and y size to 150% --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span> <span class="attr">android:propertyName</span>=<span class="string">"scaleX"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:duration</span>=<span class="string">"@android:integer/config_shortAnimTime"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueTo</span>=<span class="string">"1.5"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span> <span class="attr">android:propertyName</span>=<span class="string">"scaleY"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:duration</span>=<span class="string">"@android:integer/config_shortAnimTime"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueTo</span>=<span class="string">"1.5"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- the default, non-pressed state; set x and y size to 100% --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span> <span class="attr">android:propertyName</span>=<span class="string">"scaleX"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:duration</span>=<span class="string">"@android:integer/config_shortAnimTime"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueTo</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span> <span class="attr">android:propertyName</span>=<span class="string">"scaleY"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:duration</span>=<span class="string">"@android:integer/config_shortAnimTime"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueTo</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ºå¯¹åº”çš„viewè®¾ç½® android:stateListAnimatorå±æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button android:stateListAnimator=&quot;@xml/animate_scale&quot;</span><br><span class="line">        ... /&gt;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="/images/5.gif" alt=""></p><h2 id="æŒ‡å®šå…³é”®å¸§"><a href="#æŒ‡å®šå…³é”®å¸§" class="headerlink" title="æŒ‡å®šå…³é”®å¸§"></a>æŒ‡å®šå…³é”®å¸§</h2><p>Keyframeå¯¹è±¡åŒ…å«äº†ä¸€ä¸ªæ—¶é—´/å€¼çš„ä¸€ä¸ªå¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹ï¼Œvalueå¯¹åº”çš„å€¼ã€‚åŒæ ·å¯ä»¥ä½¿ç”¨æ’å€¼å™¨æ¥å†³å®šä¸¤ä¸ªKeyframeå¯¹åº”çš„æ—¶é—´é—´éš”ä¸­ï¼Œvalueå˜åŒ–çš„æ–¹å¼ã€‚Keyframeéœ€è¦ç”¨<code>ofInt()</code>/<code>ofFloat()</code>/<code>ofObject()</code>è¿™ä¸ªä¸‰ä¸ªå·¥å‚æ–¹æ³•ä¹‹ä¸€æ¥è¿›è¡Œåˆå§‹åŒ–çš„æ“ä½œï¼Œç„¶åéœ€è¦ç”¨PropertyValuesHolderçš„<code>ofKeyframe()</code>æ¥è·å–PropertyValuesHolderå¯¹è±¡ï¼Œå†æŠŠPropertyValuesHolderå¯¹è±¡ä¼ é€’ç»™ObjectAnimatorï¼›ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Keyframe kf0 = Keyframe.ofFloat(<span class="number">0f</span>, <span class="number">0f</span>);</span><br><span class="line">Keyframe kf1 = Keyframe.ofFloat(.<span class="number">5f</span>, <span class="number">360f</span>);</span><br><span class="line">Keyframe kf2 = Keyframe.ofFloat(<span class="number">1f</span>, <span class="number">0f</span>);</span><br><span class="line">PropertyValuesHolder pvhRotation = PropertyValuesHolder.ofKeyframe(<span class="string">"rotation"</span>, kf0, kf1, kf2);</span><br><span class="line">ObjectAnimator rotationAnim = ObjectAnimator.ofPropertyValuesHolder(target, pvhRotation)</span><br><span class="line">rotationAnim.setDuration(<span class="number">5000</span>ms);</span><br></pre></td></tr></table></figure><h2 id="ViewPropertyAnimator"><a href="#ViewPropertyAnimator" class="headerlink" title="ViewPropertyAnimator"></a>ViewPropertyAnimator</h2><p>ViewPropertyAnimatoræ˜¯ä¸ªç¥å™¨ï¼å®ƒå¯ä»¥å°†ä¸€ä¸ªviewçš„ä¸åŒå±æ€§åŠ¨ç”»å¹¶è¡Œè¿›è¡Œï¼Œè€Œä¸”ä»£ç ç®€æ´ï¼</p><p>å‡è®¾æˆ‘ä»¬è¦ç§»åŠ¨ä¸€ä¸ªviewï¼ŒåŒ…å«xå’Œyã€‚</p><p><strong>ä½¿ç”¨å¤šä¸ªObjectAnimatorå¯¹è±¡ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ObjectAnimator animX = ObjectAnimator.ofFloat(myView, <span class="string">"x"</span>, <span class="number">50f</span>);</span><br><span class="line">ObjectAnimator animY = ObjectAnimator.ofFloat(myView, <span class="string">"y"</span>, <span class="number">100f</span>);</span><br><span class="line">AnimatorSet animSetXY = <span class="keyword">new</span> AnimatorSet();</span><br><span class="line">animSetXY.playTogether(animX, animY);</span><br><span class="line">animSetXY.start();</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ä¸€ä¸ªObjectAnimatorå¯¹è±¡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PropertyValuesHolder pvhX = PropertyValuesHolder.ofFloat(<span class="string">"x"</span>, <span class="number">50f</span>);</span><br><span class="line">PropertyValuesHolder pvhY = PropertyValuesHolder.ofFloat(<span class="string">"y"</span>, <span class="number">100f</span>);</span><br><span class="line">ObjectAnimator.ofPropertyValuesHolder(myView, pvhX, pvyY).start();</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ViewPropertyAnimator</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myView.animate().x(<span class="number">50f</span>).y(<span class="number">100f</span>);</span><br></pre></td></tr></table></figure><p>æœ€æœ€ç‰›é€¼çš„æ˜¯ï¼ŒViewPropertyAnimatorå®ç°3Dæ—‹è½¬ï¼ŒçœŸçš„æ˜¯å¤ªå®¹æ˜“äº†ï¼ï¼ï¼</p><p>buttonæ—‹è½¬180åº¦ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="/images/6.gif" alt=""></p><p>æ ¸å¿ƒä»£ç å°±ä¸€è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">               button.animate().rotationYBy(<span class="number">180</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…è¯·æŸ¥é˜…<a href="https://android-developers.googleblog.com/2011/05/introducing-viewpropertyanimator.html" target="_blank" rel="noopener">https://android-developers.googleblog.com/2011/05/introducing-viewpropertyanimator.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡å­¦ä¹ æ€»ç»“äº&lt;a href=&quot;https://developer.android.com/guide/topics/graphics/prop-animation.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://developer
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="http://lisongda.com/tags/Android/"/>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="AndroidåŠ¨ç”»" scheme="http://lisongda.com/tags/Android%E5%8A%A8%E7%94%BB/"/>
    
      <category term="å±æ€§åŠ¨ç”»" scheme="http://lisongda.com/tags/%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/"/>
    
  </entry>
  
  <entry>
    <title>Androidä¸­å¸¸ç”¨çº¿ç¨‹ä»‹ç»åŠå¯¹æ¯”</title>
    <link href="http://lisongda.com/2018/04/01/Android%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%BA%BF%E7%A8%8B%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AF%B9%E6%AF%94/"/>
    <id>http://lisongda.com/2018/04/01/Androidä¸­å¸¸ç”¨çº¿ç¨‹ä»‹ç»åŠå¯¹æ¯”/</id>
    <published>2018-04-01T12:02:46.000Z</published>
    <updated>2018-04-01T14:08:32.447Z</updated>
    
    <content type="html"><![CDATA[<p>Androidä¸­éœ€è¦ç”¨åˆ°çº¿ç¨‹çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼ŒThreadPoolã€AsyncTaskã€ThreadHandlerå’ŒIntentServiceç­‰ï¼Œæœ¬æ–‡ä¼šå¯¹ä»–ä»¬è¿›è¡Œä»‹ç»å’Œéƒ¨åˆ†æºç åˆ†æã€‚</p><table><thead><tr><th>Thread name</th><th>Function</th></tr></thead><tbody><tr><td><a href="https://developer.android.com/reference/java/util/concurrent/ThreadPoolExecutor.html" target="_blank" rel="noopener">ThreadPool</a></td><td>å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡</td></tr><tr><td><a href="https://developer.android.com/reference/android/os/AsyncTask.html" target="_blank" rel="noopener">AsyncTask</a></td><td>worker Threadæ‰§è¡Œåå°ä»»åŠ¡å¹¶å°†è¿›åº¦å’Œç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</td></tr><tr><td><a href="https://developer.android.com/reference/android/os/HandlerThread.html" target="_blank" rel="noopener">HandlerThread</a></td><td>ä¸€ä¸ªåŒ…å«Looperçš„Threadï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œè€—æ—¶çš„ã€å¯èƒ½æœ‰å¤šä¸ªä»»åŠ¡çš„æ“ä½œ</td></tr><tr><td><a href="https://developer.android.com/reference/android/app/IntentService.html" target="_blank" rel="noopener">IntentService</a></td><td>åœ¨åå°æ‰§è¡Œè€—æ—¶çš„å¼‚æ­¥ä»»åŠ¡ï¼Œå½“ä»»åŠ¡å®Œæˆåä¼šè‡ªåŠ¨åœæ­¢ï¼Œæœ¬è´¨æ˜¯Service</td></tr></tbody></table><h2 id="ThreadPool"><a href="#ThreadPool" class="headerlink" title="ThreadPool"></a>ThreadPool</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ol><li>é‡ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</li><li>èƒ½æœ‰æ•ˆæ§åˆ¶çº¿ç¨‹æ± çš„æœ€å¤§å¹¶å‘æ•°ï¼Œé¿å…å¤§é‡çº¿ç¨‹ä¹‹é—´å› äº’ç›¸æŠ¢å ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ã€‚</li><li>èƒ½å¤Ÿå¯¹çº¿ç¨‹è¿›è¡Œç®€å•çš„ç®¡ç†ï¼Œå¹¶ä¸”æä¾›å®šæ—¶æ‰§è¡Œä»¥åŠæŒ‡å®šé—´éš”å¾ªç¯æ‰§ç­‰åŠŸèƒ½ã€‚</li></ol><h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><p>çº¿ç¨‹æ± çš„çœŸæ­£å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                              ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                              RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²çŠ¶æ€ä¹Ÿä¸€ç›´å­˜æ´»ï¼Œé™¤éallowCoreThreadTimeOutè®¾ç½®ä¸ºtrue</li><li>maximumPoolSizeï¼šçº¿ç¨‹æ± å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå½“æ´»åŠ¨çº¿ç¨‹æ•°è¾¾åˆ°è¿™ä¸ªæ•°å€¼ä¹‹åï¼Œåç»­çš„æ–°ä»»åŠ¡ä¼šé˜»å¡</li><li>keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®æ—¶çš„è¶…æ—¶æ—¶é•¿ï¼Œè¶…æ—¶åï¼Œä¼šè¢«å›æ”¶</li><li>workQueueï¼šçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—</li><li>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸ºçº¿ç¨‹æ± æä¾›æ–°çº¿ç¨‹çš„åŠŸèƒ½ã€‚</li><li>handlerï¼šå½“çº¿ç¨‹æ± æ— æ³•æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºä»»åŠ¡é˜Ÿåˆ—å·²æ»¡æˆ–è€…æ˜¯æ— æ³•æˆåŠŸæ‰§è¡Œä»»åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™ThreadPoolExecutorä¼šè°ƒç”¨handlerçš„rejectedExecutionæ–¹æ³•æ¥é€šçŸ¥è°ƒç”¨è€…ã€‚</li></ul><h3 id="ThreadPoolExecutoræ‰§è¡Œä»»åŠ¡æ—¶å¤§è‡´éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š"><a href="#ThreadPoolExecutoræ‰§è¡Œä»»åŠ¡æ—¶å¤§è‡´éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š" class="headerlink" title="ThreadPoolExecutoræ‰§è¡Œä»»åŠ¡æ—¶å¤§è‡´éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š"></a>ThreadPoolExecutoræ‰§è¡Œä»»åŠ¡æ—¶å¤§è‡´éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</h3><ol><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œé‚£ä¹ˆä¼šç›´æ¥å¯åŠ¨ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æˆ–è€…è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œé‚£ä¹ˆä»»åŠ¡ä¼šè¢«æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚</li><li>å¦‚æœæ­¥éª¤2ä¸­æ— æ³•å°†ä»»åŠ¡æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè¿™å¾€å¾€æ˜¯ç”±äºä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœçº¿ç¨‹æ•°é‡æœªè¾¾åˆ°çº¿ç¨‹æ± è§„å®šçš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆä¼šç«‹å³å¯åŠ¨ä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li><li>å¦‚æœæ­¥éª¤3ä¸­çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°çº¿ç¨‹æ± è§„å®šçš„æœ€å¤§å€¼ï¼Œé‚£ä¹ˆå°±æ‹’ç»æ‰§è¡Œæ­¤ä»»åŠ¡ï¼ŒThreadPoolExecutorä¼šè°ƒç”¨handlerçš„rejectedExecutionæ–¹æ³•æ¥é€šçŸ¥è°ƒç”¨è€…ã€‚</li></ol><h3 id="AsyncTaskä¸­çº¿ç¨‹æ± çš„åº”ç”¨ï¼š"><a href="#AsyncTaskä¸­çº¿ç¨‹æ± çš„åº”ç”¨ï¼š" class="headerlink" title="AsyncTaskä¸­çº¿ç¨‹æ± çš„åº”ç”¨ï¼š"></a>AsyncTaskä¸­çº¿ç¨‹æ± çš„åº”ç”¨ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span>&lt;<span class="title">Params</span>, <span class="title">Progress</span>, <span class="title">Result</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"AsyncTask"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CPU_COUNT = Runtime.getRuntime().availableProcessors();</span><br><span class="line">    <span class="comment">// We want at least 2 threads and at most 4 threads in the core pool,</span></span><br><span class="line">    <span class="comment">// preferring to have 1 less than the CPU count to avoid saturating</span></span><br><span class="line">    <span class="comment">// the CPU with background work</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CORE_POOL_SIZE = Math.max(<span class="number">2</span>, Math.min(CPU_COUNT - <span class="number">1</span>, <span class="number">4</span>));</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_POOL_SIZE = CPU_COUNT * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> KEEP_ALIVE_SECONDS = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadFactory sThreadFactory = <span class="keyword">new</span> ThreadFactory() &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger mCount = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">"AsyncTask #"</span> + mCount.getAndIncrement());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =</span><br><span class="line">            <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">128</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * An &#123;<span class="doctag">@link</span> Executor&#125; that can be used to execute tasks in parallel.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor THREAD_POOL_EXECUTOR;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        ThreadPoolExecutor threadPoolExecutor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,</span><br><span class="line">                sPoolWorkQueue, sThreadFactory);</span><br><span class="line">        threadPoolExecutor.allowCoreThreadTimeOut(<span class="keyword">true</span>);</span><br><span class="line">        THREAD_POOL_EXECUTOR = threadPoolExecutor;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± çš„åˆ†ç±»ï¼š"><a href="#çº¿ç¨‹æ± çš„åˆ†ç±»ï¼š" class="headerlink" title="çº¿ç¨‹æ± çš„åˆ†ç±»ï¼š"></a>çº¿ç¨‹æ± çš„åˆ†ç±»ï¼š</h3><p>1.FixedThreadPool</p><blockquote><p>çº¿ç¨‹æ•°é‡å›ºå®šçš„çº¿ç¨‹æ± ï¼Œå½“çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œä»–ä»¬å¹¶ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éçº¿ç¨‹æ± è¢«å…³é—­ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæ–°ä»»åŠ¡éƒ½ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°æœ‰çº¿ç¨‹ç©ºé—²å‡ºæ¥ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>2.CachedThreadPool</p><blockquote><p>çº¿ç¨‹æ•°é‡ä¸å®šçš„çº¿ç¨‹æ± ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œè¿™ç±»çº¿ç¨‹æ± æ¯”è¾ƒé€‚åˆæ‰§è¡Œå¤§é‡çš„è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.ScheduledThreadPool</p><blockquote><p>å®ƒçš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡æ˜¯å›ºå®šçš„ï¼Œè€Œéæ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œå¹¶ä¸”å½“å‰éæ ¸å¿ƒçº¿ç¨‹é—²ç½®æ—¶ä¼šè¢«ç«‹å³å›æ”¶ã€‚ä¸»è¦ç”¨äºæ‰§è¡Œå®šæ—¶ä»»åŠ¡å’Œå…·æœ‰å›ºå®šå‘¨æœŸçš„é‡å¤ä»»åŠ¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE,</span><br><span class="line">    DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,<span class="keyword">new</span> DelayedWorkQueue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.SingleThreadExecutor</p><blockquote><p>çº¿ç¨‹æ± å†…éƒ¨åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå®ƒç¡®ä¿æ‰€æœ‰çš„ä»»åŠ¡éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œã€‚ç»Ÿä¸€æ‰€æœ‰çš„å¤–ç•Œä»»åŠ¡åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä½¿å¾—è¿™äº›ä»»åŠ¡ä¹‹é—´ä¸éœ€è¦å¤„ç†çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h2><h3 id="AsyncTaskç®€ä»‹"><a href="#AsyncTaskç®€ä»‹" class="headerlink" title="AsyncTaskç®€ä»‹"></a>AsyncTaskç®€ä»‹</h3><p>AsyncTaskæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¼‚æ­¥ä»»åŠ¡ç±»ã€‚å®ƒå¯ä»¥åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œåå°ä»»åŠ¡ï¼Œç„¶åæŠŠæ‰§è¡Œçš„è¿›åº¦å’Œæœ€ç»ˆç»“æœä¼ é€’ç»™æœ±çº¿ç¨‹ä¸­æ›´æ–°UIã€‚ä»å®ç°ä¸Šæ¥è¯´ï¼ŒAsyncTaskå°è£…äº†Threadå’ŒHandlerï¼Œé€šè¿‡AsyncTaskå¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°æ‰§è¡Œåå°ä»»åŠ¡ä»¥åŠåœ¨ä¸»çº¿ç¨‹ä¸­è®¿é—®UIï¼Œä½†æ˜¯AsyncTaskå¹¶ä¸é€‚åˆè¿›è¡Œç‰¹åˆ«è€—æ—¶çš„åå°ä»»åŠ¡ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span>&lt;<span class="title">Params</span>, <span class="title">Progress</span>, <span class="title">Result</span>&gt; </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸‰ç§æ³›å‹ç±»å‹åˆ†åˆ«ä»£è¡¨â€œå¯åŠ¨ä»»åŠ¡æ‰§è¡Œçš„è¾“å…¥å‚æ•°â€ã€â€œåå°ä»»åŠ¡æ‰§è¡Œçš„è¿›åº¦â€ã€â€œåå°è®¡ç®—ç»“æœçš„ç±»å‹â€ã€‚åœ¨ç‰¹å®šåœºåˆä¸‹ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ç±»å‹éƒ½è¢«ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯ä»¥ç”¨java.lang.Voidç±»å‹ä»£æ›¿ã€‚</p><p>ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><p>execute(Paramsâ€¦ params)ï¼Œæ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œéœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­è°ƒç”¨æ­¤æ–¹æ³•ï¼Œè§¦å‘å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚</p></li><li><p>onPreExecute()ï¼Œåœ¨execute(Paramsâ€¦ params)è¢«è°ƒç”¨åç«‹å³æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨æ¥åœ¨æ‰§è¡Œåå°ä»»åŠ¡å‰å¯¹UIåšä¸€äº›æ ‡è®°ã€‚</p></li><li><p>doInBackground(Paramsâ€¦ params)ï¼Œåœ¨onPreExecute()å®Œæˆåç«‹å³æ‰§è¡Œï¼Œç”¨äºæ‰§è¡Œè¾ƒä¸ºè´¹æ—¶çš„æ“ä½œï¼Œæ­¤æ–¹æ³•å°†æ¥æ”¶è¾“å…¥å‚æ•°å’Œè¿”å›è®¡ç®—ç»“æœã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥è°ƒç”¨publishProgress(Progressâ€¦ values)æ¥æ›´æ–°è¿›åº¦ä¿¡æ¯ã€‚</p></li><li><p>onProgressUpdate(Progressâ€¦ values)ï¼Œåœ¨è°ƒç”¨publishProgress(Progressâ€¦ values)æ—¶ï¼Œæ­¤æ–¹æ³•è¢«æ‰§è¡Œï¼Œç›´æ¥å°†è¿›åº¦ä¿¡æ¯æ›´æ–°åˆ°UIç»„ä»¶ä¸Šã€‚</p></li><li><p>onPostExecute(Result result)ï¼Œå½“åå°æ“ä½œç»“æŸæ—¶ï¼Œæ­¤æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨ï¼Œè®¡ç®—ç»“æœå°†åšä¸ºå‚æ•°ä¼ é€’åˆ°æ­¤æ–¹æ³•ä¸­ï¼Œç›´æ¥å°†ç»“æœæ˜¾ç¤ºåˆ°UIç»„ä»¶ä¸Šã€‚ </p></li></ol><h3 id="AsyncTaskæºç è§£æï¼š"><a href="#AsyncTaskæºç è§£æï¼š" class="headerlink" title="AsyncTaskæºç è§£æï¼š"></a>AsyncTaskæºç è§£æï¼š</h3><p>ä»AsyncTaskçš„executeæ–¹æ³•å¼€å§‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Executes the task with the specified parameters. The task returns</span></span><br><span class="line"><span class="comment"> * itself (this) so that the caller can keep a reference to it.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: this function schedules the task on a queue for a single background</span></span><br><span class="line"><span class="comment"> * thread or pool of threads depending on the platform version.  When first</span></span><br><span class="line"><span class="comment"> * introduced, AsyncTasks were executed serially on a single background thread.</span></span><br><span class="line"><span class="comment"> * Starting with &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#DONUT&#125;, this was changed</span></span><br><span class="line"><span class="comment"> * to a pool of threads allowing multiple tasks to operate in parallel. Starting</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> android.os.Build.VERSION_CODES#HONEYCOMB&#125;, tasks are back to being</span></span><br><span class="line"><span class="comment"> * executed on a single thread to avoid common application errors caused</span></span><br><span class="line"><span class="comment"> * by parallel execution.  If you truly want parallel execution, you can use</span></span><br><span class="line"><span class="comment"> * the &#123;<span class="doctag">@link</span> #executeOnExecutor&#125; version of this method</span></span><br><span class="line"><span class="comment"> * with &#123;<span class="doctag">@link</span> #THREAD_POOL_EXECUTOR&#125;; however, see commentary there for warnings</span></span><br><span class="line"><span class="comment"> * on its use.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method must be invoked on the UI thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params The parameters of the task.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> This instance of AsyncTask.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalStateException If &#123;<span class="doctag">@link</span> #getStatus()&#125; returns either</span></span><br><span class="line"><span class="comment"> *         &#123;<span class="doctag">@link</span> AsyncTask.Status#RUNNING&#125; or &#123;<span class="doctag">@link</span> AsyncTask.Status#FINISHED&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #executeOnExecutor(java.util.concurrent.Executor, Object[])</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #execute(Runnable)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">execute</span><span class="params">(Params... params)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> executeOnExecutor(sDefaultExecutor, params);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MainThread</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="title">executeOnExecutor</span><span class="params">(Executor exec,</span></span></span><br><span class="line"><span class="function"><span class="params">        Params... params)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mStatus != Status.PENDING) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (mStatus) &#123;</span><br><span class="line">            <span class="keyword">case</span> RUNNING:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></span><br><span class="line">                        + <span class="string">" the task is already running."</span>);</span><br><span class="line">            <span class="keyword">case</span> FINISHED:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot execute task:"</span></span><br><span class="line">                        + <span class="string">" the task has already been executed "</span></span><br><span class="line">                        + <span class="string">"(a task can be executed only once)"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mStatus = Status.RUNNING;</span><br><span class="line">    onPreExecute();</span><br><span class="line">    mWorker.mParams = params;</span><br><span class="line">    exec.execute(mFuture);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>executeæ–¹æ³•å’ŒexecuteOnExecutoræ–¹æ³•å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ï¼Œåœ¨Android1.6ä¹‹å‰ï¼ŒAsyncTaskæ˜¯ä¸²è¡Œæ‰§è¡Œä»»åŠ¡çš„ã€‚1.6å¼€å§‹é‡‡ç”¨çº¿ç¨‹æ± å¤„ç†å¹¶è¡Œä»»åŠ¡ï¼Œä½†æ˜¯ä»3.0å¼€å§‹ï¼Œä¸ºäº†é¿å…AsyncTaskæ‰€å¸¦æ¥çš„å¹¶å‘é”™è¯¯ï¼ŒAsynctaskåˆé‡‡ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ¥ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨Android3.0ä»¥åŠä»¥åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡AsyncTaskçš„executeOnExecutoræ–¹æ³•æ¥å¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ã€‚<br>executeæ–¹æ³•è°ƒç”¨äº†executeOnExecutoræ–¹æ³•ï¼ŒsDefaultExecutoræ˜¯ä¸€ä¸ªä¸²è¡Œçš„çº¿ç¨‹æ± ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An &#123;<span class="doctag">@link</span> Executor&#125; that executes tasks one at a time in serial</span></span><br><span class="line"><span class="comment"> * order.  This serialization is global to a particular process.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor SERIAL_EXECUTOR = <span class="keyword">new</span> SerialExecutor();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Executor sDefaultExecutor = SERIAL_EXECUTOR;</span><br></pre></td></tr></table></figure><p>åœ¨executorOnExecutorä¸­ï¼ŒonPreExecuteæ–¹æ³•æœ€å…ˆæ‰§è¡Œï¼Œç„¶åçº¿ç¨‹æ± å¼€å§‹æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="keyword">new</span> ArrayDeque&lt;Runnable&gt;();</span><br><span class="line">      Runnable mActive;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">final</span> Runnable r)</span> </span>&#123;</span><br><span class="line">          mTasks.offer(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                      r.run();</span><br><span class="line">                  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                      scheduleNext();</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">if</span> (mActive == <span class="keyword">null</span>) &#123;</span><br><span class="line">              scheduleNext();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">scheduleNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> ((mActive = mTasks.poll()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">              THREAD_POOL_EXECUTOR.execute(mActive);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>//ToDo FutureTaskè§£æ</p><p>AsyncTaskçš„Paramså‚æ•°å°è£…ä¸ºFutueTaskå¯¹è±¡ï¼ŒFutureTaskæ˜¯ä¸€ä¸ªå¹¶å‘ç±»ã€‚SerialExecutorçš„executeæ–¹æ³•é¦–å…ˆä¼šå§FutureTaskå¯¹è±¡æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—mTasksä¸­ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æ²¡æœ‰æ­£åœ¨æ´»åŠ¨çš„AsyncTaskä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨SerialExecutorçš„scheduleNextæ¥æ‰§è¡Œä¸‹ä¸€ä¸ªAsyncTaskä»»åŠ¡ï¼ŒåŒæ—¶å½“ä¸€ä¸ªAsyncTaskä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼ŒAsyncTaskä¼šç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ç›´åˆ°æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šè¢«æ‰§è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAsyncTaskæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ã€‚</p><p>AsyncTaskä¸­æœ‰ä¸¤ä¸ªçº¿ç¨‹æ± ï¼ˆSerialExecutorå’Œ<code>THREAD_POOL_EXECUTOR</code>ï¼‰å’Œä¸€ä¸ªHandlerï¼ˆInternalHandlerï¼‰ï¼Œå…¶ä¸­çº¿ç¨‹æ± SerialExecutorç”¨äºä»»åŠ¡çš„æ’é˜Ÿï¼Œè€Œçº¿ç¨‹æ± <code>THREAD_POOL_EXECUTOR</code>ç”¨äºçœŸæ­£çš„æ‰§è¡Œä»»åŠ¡ï¼ŒInternalThreadç”¨äºå°†æ‰§è¡Œç¯å¢ƒä»çº¿ç¨‹æ± åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ã€‚</p><p>ç”±äºFutureTaskçš„runæ–¹æ³•ä¼šè°ƒç”¨mWorkerçš„callæ–¹æ³•ï¼Œå› æ­¤mWorkerçš„callæ–¹æ³•æœ€ç»ˆä¼šåœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mWorker = <span class="keyword">new</span> WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> Result <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">         mTaskInvoked.set(<span class="keyword">true</span>);</span><br><span class="line">         Result result = <span class="keyword">null</span>;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class="line">             <span class="comment">//noinspection unchecked</span></span><br><span class="line">             result = doInBackground(mParams);</span><br><span class="line">             Binder.flushPendingCommands();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (Throwable tr) &#123;</span><br><span class="line">             mCancelled.set(<span class="keyword">true</span>);</span><br><span class="line">             <span class="keyword">throw</span> tr;</span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">             postResult(result);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> result;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p>åœ¨mWorkerçš„callæ–¹æ³•ä¸­ï¼Œé¦–å…ˆmTaskInvokedè®¾ä¸ºtrueï¼Œè¡¨ç¤ºå½“å‰ä»»åŠ¡å·²ç»è¢«è°ƒç”¨è¿‡äº†ï¼Œç„¶åæ‰§è¡ŒdoInBackgroundæ–¹æ³•ï¼Œæ¥ç€å°†å…¶è¿”å›å€¼ä¼ é€’ç»™postResultæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> InternalHandler sHandler;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Result <span class="title">postResult</span><span class="params">(Result result)</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT,</span><br><span class="line">            <span class="keyword">new</span> AsyncTaskResult&lt;Result&gt;(<span class="keyword">this</span>, result));</span><br><span class="line">    message.sendToTarget();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> Handler <span class="title">getHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mHandlerèµ‹å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mHandler = callbackLooper == <span class="keyword">null</span> || callbackLooper == Looper.getMainLooper()</span><br><span class="line">        ? getMainHandler()</span><br><span class="line">        : <span class="keyword">new</span> Handler(callbackLooper);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Handler <span class="title">getMainHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (AsyncTask.class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sHandler = <span class="keyword">new</span> InternalHandler(Looper.getMainLooper());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sHandler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿™é‡Œè·å–çš„mHandlerä¸€å®šæ˜¯ä¸»çº¿ç¨‹çš„handlerçš„å—ï¼Ÿé€šè¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">(@Nullable Looper callbackLooper)</span> </span>&#123;</span><br><span class="line">    mHandler = callbackLooper == <span class="keyword">null</span> || callbackLooper == Looper.getMainLooper()</span><br><span class="line">            ? getMainHandler()</span><br><span class="line">            : <span class="keyword">new</span> Handler(callbackLooper);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœå½“å‰çš„callbackLooperä¸ºnullæˆ–è€…æ˜¯ä¸»çº¿ç¨‹çš„Looperçš„è¯ï¼Œé‚£ä¹ˆå¯¹åº”çš„handlerå°±æ˜¯ä¸»çº¿ç¨‹çš„handlerï¼ŒcallbackLooperæœ‰æ²¡æœ‰å¯èƒ½ä¸ºå…¶ä»–å€¼å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new asynchronous task. This constructor must be invoked on the UI thread.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@hide</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AsyncTask</span><span class="params">(@Nullable Handler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(handler != <span class="keyword">null</span> ? handler.getLooper() : <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ„é€ æ–¹æ³•å¹¶ä¸å¯¹å¤–å¼€æ”¾ï¼Œæ‰€ä»¥handlerä¸€å®šä¸ºä¸»çº¿ç¨‹çš„handlerã€‚è¿™ä¹Ÿå°±åšåˆ°äº†çº¿ç¨‹çš„åˆ‡æ¢ã€‚</p><p>InternalHandlerçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InternalHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InternalHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(looper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"unchecked"</span>, <span class="string">"RawUseOfParameterizedType"</span>&#125;)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="keyword">case</span> MESSAGE_POST_RESULT:</span><br><span class="line">                <span class="comment">// There is only one result</span></span><br><span class="line">                result.mTask.finish(result.mData[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MESSAGE_POST_PROGRESS:</span><br><span class="line">                result.mTask.onProgressUpdate(result.mData);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“sHandleræ”¶åˆ°<code>MESSAGE_POST_RESULT</code>æ¶ˆæ¯æ—¶ï¼Œä¼šè°ƒç”¨AsyncTaskçš„finishæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(Result result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isCancelled()) &#123;</span><br><span class="line">        onCancelled(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        onPostExecute(result);</span><br><span class="line">    &#125;</span><br><span class="line">    mStatus = Status.FINISHED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AsyncTaskæ³¨æ„äº‹é¡¹ï¼š"><a href="#AsyncTaskæ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="AsyncTaskæ³¨æ„äº‹é¡¹ï¼š"></a>AsyncTaskæ³¨æ„äº‹é¡¹ï¼š</h3><p>1.AsyncTaskä¸­çš„æ‰€æœ‰ä»»åŠ¡å°†ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œï¼›</p><p>2.How to cancel taskï¼Ÿ<br>è°ƒç”¨cancelæ–¹æ³•ï¼š</p><pre><code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</span><br><span class="line">       mCancelled.set(<span class="keyword">true</span>);</span><br><span class="line">       <span class="keyword">return</span> mFuture.cancel(mayInterruptIfRunning);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»ˆæ­¢æ›´æ–°è¿›åº¦</span></span><br><span class="line">    <span class="meta">@WorkerThread</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">publishProgress</span><span class="params">(Progress... values)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (!isCancelled()) &#123;</span><br><span class="line">           getHandler().obtainMessage(MESSAGE_POST_PROGRESS,</span><br><span class="line">                   <span class="keyword">new</span> AsyncTaskResult&lt;Progress&gt;(<span class="keyword">this</span>, values)).sendToTarget();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// å›è°ƒonCancelledæ–¹æ³•</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">(Result result)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (isCancelled()) &#123;</span><br><span class="line">           onCancelled(result);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           onPostExecute(result);</span><br><span class="line">       &#125;</span><br><span class="line">       mStatus = Status.FINISHED;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></code></pre><p><code>mFuture.cancel(mayInterruptIfRunning);</code>ä¼šè°ƒç”¨çº¿ç¨‹çš„interruptæ–¹æ³•ã€‚å³ä½¿æˆ‘ä»¬æ­£ç¡®åœ°è°ƒç”¨äº†cancle() ä¹Ÿæœªå¿…èƒ½çœŸæ­£åœ°å–æ¶ˆä»»åŠ¡ã€‚å› ä¸ºå¦‚æœåœ¨doInBackgroudé‡Œæœ‰ä¸€ä¸ªä¸å¯ä¸­æ–­çš„æ“ä½œï¼Œæ¯”å¦‚BitmapFactory.decodeStream()ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œä¼šç»§ç»­ä¸‹å»ã€‚</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer... value)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// åˆ¤æ–­æ˜¯å¦è¢«å–æ¶ˆ</span></span><br><span class="line">   <span class="keyword">if</span>(isCancelled()) <span class="keyword">return</span>;</span><br><span class="line">.........</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Integer <span class="title">doInBackground</span><span class="params">(Void... mgs)</span> </span>&#123;</span><br><span class="line"><span class="comment">// Taskè¢«å–æ¶ˆäº†ï¼Œé©¬ä¸Šé€€å‡º</span></span><br><span class="line"><span class="keyword">if</span>(isCancelled()) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.å†…å­˜æ³„æ¼</p><p> å¦‚æœAsyncTaskè¢«å£°æ˜ä¸ºActivityçš„éé™æ€çš„å†…éƒ¨ç±»ï¼Œé‚£ä¹ˆAsyncTaskä¼šä¿ç•™ä¸€ä¸ªå¯¹åˆ›å»ºäº†AsyncTaskçš„Activityçš„å¼•ç”¨ã€‚å¦‚æœActivityå·²ç»è¢«é”€æ¯ï¼ŒAsyncTaskçš„åå°çº¿ç¨‹è¿˜åœ¨æ‰§è¡Œï¼Œå®ƒå°†ç»§ç»­åœ¨å†…å­˜é‡Œä¿ç•™è¿™ä¸ªå¼•ç”¨ï¼Œå¯¼è‡´Activityæ— æ³•è¢«å›æ”¶ï¼Œå¼•èµ·å†…å­˜æ³„éœ²ã€‚</p><h2 id="HandlerThread"><a href="#HandlerThread" class="headerlink" title="HandlerThread"></a>HandlerThread</h2><p>HandlerThreadç»§æ‰¿äº†Threadï¼Œå®ƒæ˜¯ä¸€ç§å¯ä»¥ä½¿ç”¨Handlerçš„Threadï¼Œå®ƒçš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨runæ–¹æ³•ä¸­é€šè¿‡Looper.prepare()æ¥åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶é€šè¿‡Looper.loop()æ¥å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼Œè¿™æ ·åœ¨å®é™…çš„ä½¿ç”¨ä¸­å°±å…è®¸åœ¨HandlerThreadä¸­åˆ›å»ºHandleräº†ã€‚æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mPriority;</span><br><span class="line">    <span class="keyword">int</span> mTid = -<span class="number">1</span>;</span><br><span class="line">    Looper mLooper;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HandlerThread</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        mPriority = Process.THREAD_PRIORITY_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HandlerThread</span><span class="params">(String name, <span class="keyword">int</span> priority)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">        mPriority = priority;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLooperPrepared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mTid = Process.myTid();</span><br><span class="line">        Looper.prepare();</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            mLooper = Looper.myLooper();</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">        Process.setThreadPriority(mPriority);</span><br><span class="line">        onLooperPrepared();</span><br><span class="line">        Looper.loop();</span><br><span class="line">        mTid = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Looper <span class="title">getLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isAlive()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// If the thread has been started, wait until the looper has been created.</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive() &amp;&amp; mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mLooper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">quit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper looper = getLooper();</span><br><span class="line">        <span class="keyword">if</span> (looper != <span class="keyword">null</span>) &#123;</span><br><span class="line">            looper.quit();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">quitSafely</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper looper = getLooper();</span><br><span class="line">        <span class="keyword">if</span> (looper != <span class="keyword">null</span>) &#123;</span><br><span class="line">            looper.quitSafely();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the identifier of this thread. See Process.myTid().</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getThreadId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mTid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HandlerThreadå’Œæ™®é€šçš„Threadæœ‰æ˜¾è‘—çš„ä¸åŒä¹‹å¤„ã€‚æ™®é€šThreadä¸»è¦ç”¨äºåœ¨run æ–¹æ³•ä¸­æ‰§è¡Œä¸€ä¸ªè€—æ—¶ä»»åŠ¡ï¼Œè€ŒHandlerThreadåœ¨å†…éƒ¨åˆ›å»ºäº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤–ç•Œéœ€è¦é€šè¿‡Handlerçš„æ¶ˆæ¯æ–¹å¼æ¥é€šçŸ¥HandlerThreadæ‰§è¡Œä¸€ä¸ªå…·ä½“çš„ä»»åŠ¡ã€‚</p><p>HandlerThreadçš„ç®€å•ç”¨æ³•å¦‚ä¸‹ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HandlerThread handlerThread = <span class="keyword">new</span> HandlerThread(<span class="string">"MyHandlerThread"</span>);</span><br><span class="line">     handlerThread.start();</span><br><span class="line">     Handler handler = <span class="keyword">new</span> Handler(handlerThread.getLooper()) &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">             <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure><h2 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h2><p>IntentServiceæ˜¯ä¸€ç§ç‰¹æ®Šçš„Serviceï¼Œå®ƒç»§æ‰¿äº†Serviceå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œåå°è€—æ—¶çš„ä»»åŠ¡ï¼Œå½“ä»»åŠ¡æ‰§è¡Œåå®ƒä¼šè‡ªåŠ¨åœæ­¢ï¼ŒåŒæ—¶ç”±äºIntentServiceæ˜¯æœåŠ¡çš„åŸå› ï¼Œå®ƒçš„ä¼˜å…ˆçº§è¦æ¯”å•çº¯çš„çº¿ç¨‹é«˜ï¼Œæ‰€ä»¥IntentServiceæ¯”è¾ƒé€‚åˆæ‰§è¡Œä¸€äº›é«˜ä¼˜å…ˆçº§çš„åå°ä»»åŠ¡ã€‚å®ƒçš„onCreateæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> It would be nice to have an option to hold a partial wakelock</span></span><br><span class="line">    <span class="comment">// during processing, and to have a static startService(Context, Intent)</span></span><br><span class="line">    <span class="comment">// method that would launch the service &amp; hand off a wakelock.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">"IntentService["</span> + mName + <span class="string">"]"</span>);</span><br><span class="line">    thread.start();</span><br><span class="line"></span><br><span class="line">    mServiceLooper = thread.getLooper();</span><br><span class="line">    mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ServiceHandlerçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(looper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        onHandleIntent((Intent)msg.obj);</span><br><span class="line">        stopSelf(msg.arg1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IntentServiceå†…éƒ¨å°è£…äº†HanderThreadå’ŒHandlerï¼Œå½“å®ƒè¢«ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒçš„onCreateæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼ŒonCreateæ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªHandlerThreadï¼Œç„¶åä½¿ç”¨å®ƒçš„Looperæ¥æ„é€ ä¸€ä¸ªHandlerå¯¹è±¡mServiceHandlerï¼Œè¿™æ ·é€šè¿‡mServiceHandlerå‘é€çš„æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šåœ¨HandlerThreadä¸­æ‰§è¡Œã€‚<br>æ¯æ¬¡å¯åŠ¨IntentServiceï¼Œå®ƒçš„onStartCommandæ–¹æ³•å°±ä¼šè°ƒç”¨ä¸€æ¬¡ï¼ŒIntentServiceåœ¨onStartCommandä¸­å¤„ç†æ¯ä¸ªåå°ä»»åŠ¡çš„Intentã€‚onStartCommandæ–¹æ³•è°ƒç”¨äº†onStartï¼ŒonStartå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">    Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">    msg.arg1 = startId;</span><br><span class="line">    msg.obj = intent;</span><br><span class="line">    mServiceHandler.sendMessage(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IntentServiceé€šè¿‡mServiceHandlerå‘é€äº†ä¸€æ¡æ¶ˆæ¯ï¼ŒmServiceHandleræ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šå°†Intentå¯¹è±¡ä¼ é€’ç»™onHandleIntentå¤„ç†ã€‚å½“onHandleIntentæ–¹æ³•ç»“æŸåï¼ŒIntentServiceä¼šé€šè¿‡stopSelf(int startId)æ¥å°è¯•åœæ­¢æœåŠ¡ã€‚stopSelf(int startId)ä¼šç­‰å¾…æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å¤„ç†å®Œæ¯•åæ‰ç»ˆæ­¢æœåŠ¡ï¼›stopSelf()åˆ™ä¼šç«‹å³åœæ­¢æœåŠ¡ã€‚<br>IntentServiceçš„onHandlerIntentæ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»Intentçš„å‚æ•°ä¸­åŒºåˆ†å…·ä½“çš„ä»»åŠ¡å¹¶æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚å¦‚æœå½“å‰åªå­˜åœ¨ä¸€ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆonHandleIntentæ–¹æ³•æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åï¼ŒstopSelf(int startId)å°±ä¼šç›´æ¥åœæ­¢æœåŠ¡ï¼›å¦‚æœç›®å‰å­˜åœ¨å¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå½“onHandleIntentæ–¹æ³•æ‰§è¡Œå®Œæœ€åä¸€ä¸ªä»»åŠ¡ï¼ŒstopSelf(int startId)æ‰ä¼šç›´æ¥åœæ­¢æœåŠ¡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Androidä¸­éœ€è¦ç”¨åˆ°çº¿ç¨‹çš„åœ°æ–¹æœ‰å¾ˆå¤šï¼ŒThreadPoolã€AsyncTaskã€ThreadHandlerå’ŒIntentServiceç­‰ï¼Œæœ¬æ–‡ä¼šå¯¹ä»–ä»¬è¿›è¡Œä»‹ç»å’Œéƒ¨åˆ†æºç åˆ†æã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Thread name&lt;/th&gt;
&lt;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="çº¿ç¨‹" scheme="http://lisongda.com/tags/%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Androidä¸­TextViewéƒ¨åˆ†æ–‡å­—é«˜äº®åŠå¯ç‚¹å‡»</title>
    <link href="http://lisongda.com/2018/03/29/Android%E4%B8%ADTextView%E9%83%A8%E5%88%86%E6%96%87%E5%AD%97%E9%AB%98%E4%BA%AE%E5%8F%8A%E5%8F%AF%E7%82%B9%E5%87%BB/"/>
    <id>http://lisongda.com/2018/03/29/Androidä¸­TextViewéƒ¨åˆ†æ–‡å­—é«˜äº®åŠå¯ç‚¹å‡»/</id>
    <published>2018-03-29T03:11:37.000Z</published>
    <updated>2018-03-31T10:08:06.629Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆçœ‹ä¸‹TextViewå¦‚ä½•å®ç°éƒ¨åˆ†æ–‡å­—é«˜äº®ï¼Ÿ</p><p>å®ç°æ•ˆæœï¼š</p><p><img src="/images/4.png" alt=""></p><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œåˆ©ç”¨h5æ ‡ç­¾å°±å¯ä»¥ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// string.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span>&lt;![CDATA[ä½ åŒæ„&lt;font color="#4AC7BA"&gt;ç”¨æˆ·åè®®&lt;/font&gt;å—?]]&gt;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line"> CharSequence html = Html.fromHtml(getResources().getString(R.string.text));</span><br><span class="line">        TextView textView = (TextView) findViewById(R.id.textView);</span><br><span class="line">        textView.setText(html);</span><br></pre></td></tr></table></figure><p> ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CDATAï¼Ÿä½¿ç”¨&lt;![CDATA[]]&gt;æ¥åŒ…å«ä¸è¢«xmlè§£æå™¨è§£æçš„å†…å®¹ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ï¼Œé‚£ä¹ˆstring.xmlä¸­å­—ç¬¦ä¸²åº”è¯¥ä¸ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span>ä½ åŒæ„&amp;lt;font color="#4AC7BA"&gt;ç”¨æˆ·åè®®&amp;lt;/font&gt;å—?<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>  å¤§äºå·å’Œå°äºå·éƒ½å¯ä»¥ä½¿ç”¨å¯¹åº”çš„è½¬ç§»å­—ç¬¦æ¥è¡¨ç¤ºã€‚<code>&amp;lt;å¯¹åº” &lt;</code>,<code>&amp;gt;å¯¹åº” &gt;</code><br>  å½“ç„¶,&gt;ä¹Ÿå¯ä»¥ç”¨ç›¸åº”çš„è½¬ä¹‰ç¬¦è¡¨ç¤ºã€‚ä½†æ˜¯å¦‚æœæ—¢ä¸ä½¿ç”¨è½¬ä¹‰ç¬¦ï¼Œä¹Ÿä¸ä½¿ç”¨CDATAï¼ŒåªæŒ‰ç…§å¦‚ä¸‹æ ¼å¼ï¼Œæ˜¯æ— æ³•äº§ç”Ÿé«˜äº®æ•ˆæœçš„ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span>ä½ åŒæ„<span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"#4AC7BA"</span>&gt;</span>ç”¨æˆ·åè®®<span class="tag">&lt;/<span class="name">font</span>&gt;</span>å—?<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="comment">&lt;!--æ— æ³•äº§ç”Ÿé«˜äº®æ•ˆæœ--&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼åº”è¯¥æ˜¯æœ€ç®€å•çš„ä¸€ç§å®ç°éƒ¨åˆ†æ–‡æ¡ˆé«˜äº®çš„æ–¹æ³•ã€‚</p><hr><p>ä½†æ˜¯ç°åœ¨å¦‚æœè¦åŠ ä¸ªéœ€æ±‚ï¼Œé«˜äº®éƒ¨åˆ†å¯ä»¥ç‚¹å‡»ï¼Œéé«˜äº®éƒ¨åˆ†ä¸èƒ½ç‚¹å‡»å‘¢ï¼Ÿ</p><p><strong>å°±è¦ä½¿ç”¨åˆ°SpannableStringæ¥å®ç°äº†ã€‚</strong><br>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// string.xml</span><br><span class="line">   &lt;string name=&quot;text&quot;&gt;ä½ åŒæ„ç”¨æˆ·åè®®å—?&lt;/string&gt;</span><br><span class="line">   &lt;string name=&quot;text_sub&quot;&gt;ç”¨æˆ·åè®®&lt;/string&gt;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        TextView textView = (TextView) findViewById(R.id.textView);</span><br><span class="line">        setSpanTextInfo(textView, clickableSpan, getResources().getString(R.string.text), getResources().getString(R.string.text_sub));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ClickableSpan clickableSpan = <span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View widget)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSpanTextInfo</span><span class="params">(TextView textView, ClickableSpan clickableSpan, String fullTips, String spanTips)</span> </span>&#123;</span><br><span class="line">        SpannableString resultTipStr = <span class="keyword">new</span> SpannableString(fullTips);</span><br><span class="line">        <span class="keyword">int</span> start = fullTips.indexOf(spanTips);</span><br><span class="line">        <span class="keyword">int</span> end = start + spanTips.length();</span><br><span class="line">        <span class="keyword">int</span> defColor = Color.parseColor(<span class="string">"#4AC7BA"</span>);</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¯ç‚¹å‡»</span></span><br><span class="line">            resultTipStr.setSpan(clickableSpan, start, end, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line">            <span class="comment">// é«˜äº®</span></span><br><span class="line">            resultTipStr.setSpan(<span class="keyword">new</span> ForegroundColorSpan(defColor), start, end, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">        textView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">        textView.setText(resultTipStr);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡ ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>è¿™é‡Œçš„é«˜äº®å…¶å®æ²¡æœ‰å¿…è¦æ–°åˆ›å»ºä¸€ä¸ªForegroundColorSpanï¼Œè¦†ç›–ClickableSpançš„updateDrawStateæ–¹æ³•åŒæ ·å¯ä»¥åšåˆ°ï¼›</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        TextView textView = (TextView) findViewById(R.id.textView);</span><br><span class="line">        setSpanTextInfo(textView, clickableSpan, getResources().getString(R.string.text), getResources().getString(R.string.text_sub));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ClickableSpan clickableSpan = <span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View widget)</span> </span>&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(TextPaint ds)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.updateDrawState(ds);</span><br><span class="line">            <span class="comment">// é«˜äº®</span></span><br><span class="line">            ds.setColor(Color.parseColor(<span class="string">"#4AC7BA"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setSpanTextInfo</span><span class="params">(TextView textView, ClickableSpan clickableSpan, String fullTips, String spanTips)</span> </span>&#123;</span><br><span class="line">        SpannableString resultTipStr = <span class="keyword">new</span> SpannableString(fullTips);</span><br><span class="line">        <span class="keyword">int</span> start = fullTips.indexOf(spanTips);</span><br><span class="line">        <span class="keyword">int</span> end = start + spanTips.length();</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// å¯ç‚¹å‡»</span></span><br><span class="line">            resultTipStr.setSpan(clickableSpan, start, end, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">        textView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">        textView.setText(resultTipStr);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å…¶å®åˆšå¼€å§‹çš„ä»£ç ä¸æ˜¯è¿™æ ·çš„ï¼Œ</p><p>åˆšå¼€å§‹çš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é«˜äº®</span></span><br><span class="line">resultTipStr.setSpan(<span class="keyword">new</span> ForegroundColorSpan(defColor), start, end, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line"><span class="comment">// å¯ç‚¹å‡»</span></span><br><span class="line">resultTipStr.setSpan(clickableSpan, start, end, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure><p>åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿå°±æ˜¯è¿™ä¸¤è¡Œä»£ç é¡ºåºåäº†ï¼Œä½†æ˜¯è¡¨ç°ç»“æœå°±å‡ºé—®é¢˜äº†ï¼Œè¿™é‡Œå°±ä¸è´´å›¾äº†ï¼Œè¡¨ç°ä¸ºé«˜äº®éƒ¨åˆ†çš„é¢œè‰²å˜äº†ï¼Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„é¢œè‰²ã€‚è¿™é‡ŒæŸ¥é˜…äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œ</p></li></ul><blockquote><p>The text with a ClickableSpan attached will be underlined and the link color will be used as a text color.<br>The default link color is the themeâ€™s accent color or android:textColorLink if this attribute is defined in the theme. </p></blockquote><p> å³ClickableSpanæ˜¯ç”±é»˜è®¤é¢œè‰²çš„ï¼Œè€Œä¸”å®ƒè¦†ç›–äº†æˆ‘ä»¬é€šè¿‡ForegroundColorSpanè®¾ç½®çš„é¢œè‰²ã€‚</p><p> æˆ‘å°è¯•åœ¨æºç ä¸­æ‰¾ä¸€ä¸‹ClickableSpanæ˜¯ä½•æ—¶è®¾ç½®è¯¥é¢œè‰²çš„ï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ‰¾åˆ°ã€‚ã€‚ã€‚ã€‚</p><ul><li><p>å½“æˆ‘ä»¬åœ¨ç½‘ä¸ŠæŸ¥çœ‹ç±»ä¼¼çš„ä»£ç æ—¶ï¼Œå…¶å®å¤§éƒ¨åˆ†ä»£ç éƒ½è·Ÿå¦‚ä¸‹ç›¸ä¼¼ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SpannableString string = <span class="keyword">new</span> SpannableString(<span class="string">"Text with clickable text"</span>);</span><br><span class="line">string.setSpan(<span class="keyword">new</span> CustomClickableSpan(), <span class="number">10</span>, <span class="number">19</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br></pre></td></tr></table></figure></li></ul><p>è¿™æ ·çš„ä»£ç æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿjavaæ–‡ä»¶é‡Œå­—ç¬¦ä¸²ç¡¬ç¼–ç ï¼Œåº”è¯¥æ”¾åœ¨string.xmlé‡Œã€‚å½“ç„¶è¿™æ˜¯å°é—®é¢˜ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸ªä¾‹å­å˜›ï¼Ÿä½†æ˜¯æ›´ä¸¥é‡çš„é—®é¢˜å°±æ˜¯å½“æˆ‘ä»¬setSpanæ—¶èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®è¯¥å¦‚ä½•ç¡®å®šå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬è¦é€‚é…å¤šç§è¯­è¨€ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿæ¯”å¦‚æˆ‘å‚ä¸çš„é¡¹ç›®æ˜¯é’ˆå¯¹æµ·å¤–ç”¨æˆ·çš„äº§å“ï¼Œè¦é€‚é…20+çš„è¯­è¨€ï¼Œå½“ç„¶æ˜¯æ ¹æ®ä¸åŒçš„æ–‡æ¡ˆæ¥é€‰æ‹©ä¸åŒçš„ä½ç½®ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸èƒ½æŠŠä½ç½®å†™æ­»ã€‚</p><p> å°±åƒå¤§å®¶åˆšå¼€å§‹çœ‹åˆ°çš„ï¼Œæˆ‘ä½¿ç”¨äº†ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ–¹å¼æ¥å®Œæˆè¿™é¡¹æ“ä½œï¼Œå¤§è‡´æ„æ€æ˜¯å°†éœ€è¦é«˜äº®çš„éƒ¨åˆ†å•ç‹¬æå–å‡ºæ¥æˆä¸ºä¸€ä¸ªæ–‡æ¡ˆï¼Œè¿™æ ·é€šè¿‡å­—ç¬¦ä¸²åŒ¹é…çš„æ–¹å¼æ¥æ‰¾åˆ°èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚è¿™ç§æ–¹å¼æœ‰æ²¡æœ‰ä»€ä¹ˆç¼ºç‚¹å‘¢ï¼Ÿç†è®ºä¸Šæ²¡æœ‰ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­å´å‡ºç°äº†é—®é¢˜ã€‚</p><p> é¦–å…ˆï¼Œæˆ‘ä»¬è¦é€‚é…20+çš„è¯­è¨€ï¼Œè¿™ä¸ªç¿»è¯‘å·¥ä½œä¸æ˜¯ç”±PMæ¥å®Œæˆçš„ï¼Œè€Œæ˜¯äº¤ç»™ç¬¬ä¸‰æ–¹ç¿»è¯‘å…¬å¸å®Œæˆã€‚é‚£ä¹ˆä»–ä»¬åœ¨ç¿»è¯‘çš„æ—¶å€™ï¼Œå°±ç»å¸¸å‡ºç°ä¸¤ä¸ªå­—ç¬¦ä¸²æ— æ³•åŒ¹é…çš„æƒ…å†µï¼Œå³ä½¿æˆ‘ä»¬å·²ç»æ˜ç¡®å¼ºè°ƒäº†ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¸€å®šè¦æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ï¼Œä½†æ˜¯ç»“æœä»ç„¶ä¸å¦‚äººæ„ï¼ŒçœŸçš„ä¸çŸ¥é“ä»–ä»¬çš„å·¥ä½œå¦‚ä½•å®Œæˆçš„ã€‚ã€‚ã€‚æ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦RDæ¥æ‰‹åŠ¨æ ¡éªŒã€‚å¦‚æœå‡ºç°äº†ä¸åŒ¹é…ï¼Œå°±ä¼šå¯¼è‡´é«˜äº®å’Œç‚¹å‡»æ•ˆæœå¤±æ•ˆã€‚</p><p> åæ¥æˆ‘ä»¬è¿™è¾¹çš„RDæå‡ºäº†ä¸€ä¸ªæ–¹æ¡ˆï¼Œå³é€šè¿‡ä¸‹é¢çš„æ–¹å¼å°±å¯ä»¥ä¿è¯ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸€å®šä¼šåŒ¹é…ä¸Šï¼š</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> // string.xml</span><br><span class="line"> &lt;string name=&quot;text&quot;&gt;ä½ åŒæ„%så—?&lt;/string&gt;</span><br><span class="line">&lt;string name=&quot;text_sub&quot;&gt;ç”¨æˆ·åè®®&lt;/string&gt;</span><br></pre></td></tr></table></figure> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line">String child = getResources().getString(R.string.text_sub);</span><br><span class="line">String parent = getResources().getString(R.string.text, child);</span><br><span class="line">setSpanTextInfo(textView, clickableSpan, parent, child);</span><br></pre></td></tr></table></figure><p> ä¸çŸ¥é“å¤§å®¶çœ‹æ‡‚äº†æ²¡ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­éœ€è¦é«˜äº®çš„éƒ¨åˆ†æå–å‡ºæ¥ï¼Œä½¿ç”¨%sä»£æ›¿ï¼Œå†åœ¨javaä»£ç ä¸­æ›¿æ¢å›å»ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¸€å®šæ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­ä¸²ï¼Œè¿™æ ·ä¹ä¸€çœ‹æ˜¯ä¸æ˜¯å¾ˆå®Œç¾ï¼Ÿä½†æ˜¯å®ƒæœ‰ä¸ªè‡´å‘½ç¼ºç‚¹ã€‚</p><p> å°±æ˜¯åœ¨åšå¤šè¯­ç¿»è¯‘çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½æ— æ³•getåˆ°æ•´ä¸ªå­—ç¬¦ä¸²çš„è¯­æ„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ç°åœ¨æ•´ä¸ªå­—ç¬¦ä¸²ä¸ºâ€œä½ ä»Šå¤©è·Ÿå¥¹æ‰“æ‹›å‘¼äº†å—â€ï¼Œâ€œæ‰“æ‹›å‘¼â€éœ€è¦é«˜äº®å¯ç‚¹å‡»ï¼Œé‚£ä¹ˆä½¿ç”¨æœ€åçš„æ–¹æ¡ˆå°±æ˜¯â€œä½ ä»Šå¤©è·Ÿå¥¹%säº†å—â€ï¼Œå…¶å®è¿™å¥è¯çš„è¯­æ„æ˜¯ä¸å®Œæ•´çš„ï¼Œåœ¨ç¿»è¯‘æˆå…¶ä»–è¯­è¨€çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å®Œå…¨ä¸çŸ¥æ‰€äº‘ï¼å½“ç„¶ï¼Œå¦‚æœåªæ˜¯ä¸­æ–‡æˆ–è‹±æ–‡ï¼Œå€’æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p> ç»¼ä¸Šï¼Œè¿˜æ˜¯é‡‡ç”¨ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²åŒ¹é…çš„æ–¹å¼ï¼Œå¦‚æœéœ€è¦åšå¤šä¸ªå›½å®¶çš„è¯­è¨€é€‚é…ï¼Œé‚£ä¹ˆè¿˜æ˜¯æ¨èæœ€åŸå§‹çš„æ–¹æ¡ˆã€‚<br> å³ï¼š</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// string.xml</span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span>ä½ åŒæ„ç”¨æˆ·åè®®å—?<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"text_sub"</span>&gt;</span>ç”¨æˆ·åè®®<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é¦–å…ˆçœ‹ä¸‹TextViewå¦‚ä½•å®ç°éƒ¨åˆ†æ–‡å­—é«˜äº®ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®ç°æ•ˆæœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/4.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå¾ˆç®€å•ï¼Œåˆ©ç”¨h5æ ‡ç­¾å°±å¯ä»¥ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;t
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="android" scheme="http://lisongda.com/tags/android/"/>
    
      <category term="TextView" scheme="http://lisongda.com/tags/TextView/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å°çš„Java&amp;AndroidçŸ¥è¯†ç‚¹</title>
    <link href="http://lisongda.com/2018/03/27/%E4%B8%80%E4%BA%9B%E5%B0%8F%E7%9A%84Java-Android%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <id>http://lisongda.com/2018/03/27/ä¸€äº›å°çš„Java-AndroidçŸ¥è¯†ç‚¹/</id>
    <published>2018-03-27T12:06:07.000Z</published>
    <updated>2018-04-29T14:20:44.837Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>==ã€equalsæ–¹æ³•å’Œhashcodeçš„åŒºåˆ«</p><p>  <code>==</code>ï¼šå½“åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´æ¯”è¾ƒæ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯ä»–ä»¬çš„å€¼ï¼›å¦åˆ™æ¯”è¾ƒçš„æ˜¯ä»–ä»¬åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚</p><p>  <code>equalsæ–¹æ³•</code>ï¼šå¦‚æœæˆ‘ä»¬ä¸è¦†ç›–Objectä¸­çš„equalsæ–¹æ³•ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„æ˜¯å†…å­˜ä¸­çš„åœ°å€ï¼›</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Object.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">return</span> (<span class="keyword">this</span> == obj);  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>  å½“ç„¶æˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚é‡å†™è¯¥æ–¹æ³•ã€‚</p><p> <code>hashCodeæ–¹æ³•</code>ï¼š<br> equals()ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ä»–ä»¬çš„hashCode()è‚¯å®šç›¸ç­‰ï¼Œä¹Ÿå°±æ˜¯ç”¨equals()å¯¹æ¯”æ˜¯ç»å¯¹å¯é çš„ï¼›hashCode()ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ä»–ä»¬çš„equals()ä¸ä¸€å®šç›¸ç­‰ï¼Œä¹Ÿå°±æ˜¯hashCode()ä¸æ˜¯ç»å¯¹å¯é çš„ï¼›å¯¹äºå¤§é‡éœ€è¦æ¯”è¾ƒçš„å¯¹è±¡ï¼Œå¦‚æœè°ƒç”¨equals()é‚£ä¹ˆæ•ˆç‡å¾ˆä½ï¼Œæ‰€ä»¥å…ˆè°ƒç”¨hashCode(ï¼‰æ–¹æ³•ã€‚å¦‚æœhashCode()æ–¹æ³•å¾—åˆ°çš„å€¼ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆä¸¤ä¸ªå¯¹è±¡è‚¯å®šä¸ç›¸ç­‰ã€‚å¦‚æœhashCode()æ–¹æ³•å¾—åˆ°çš„å€¼ä¸€æ ·ï¼Œé‚£ä¹ˆå†è°ƒç”¨equals(ï¼‰æ–¹æ³•ã€‚è¿™æ ·ä¼šå¤§å¤§æé«˜æ•ˆç‡ã€‚  </p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;p&gt;==ã€equalsæ–¹æ³•å’Œhashcodeçš„åŒºåˆ«&lt;/p&gt;
&lt;p&gt;  &lt;code&gt;==&lt;/code&gt;ï¼šå½“åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´æ¯”è¾ƒæ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯ä»–ä»¬çš„å€¼ï¼›å¦åˆ™æ¯”è¾ƒçš„æ˜¯ä»–ä»¬åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;  &lt;code&gt;equalsæ–¹æ³•&lt;/code&gt;ï¼šå¦‚æœæˆ‘ä»¬ä¸è¦†ç›–Ob
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>Android onSaveInstanceStateè°ƒç”¨æ—¶æœº</title>
    <link href="http://lisongda.com/2018/03/22/Android-onSaveInstanceState%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA/"/>
    <id>http://lisongda.com/2018/03/22/Android-onSaveInstanceStateè°ƒç”¨æ—¶æœº/</id>
    <published>2018-03-22T06:50:54.000Z</published>
    <updated>2018-04-29T14:22:09.369Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®ä¸­PMåŠ äº†ä¸ªéœ€æ±‚ï¼Œè¦åšä¸€ä¸ªAndroidåº”ç”¨å†…é€šçŸ¥ï¼Œå³å½“Appåœ¨å‰å°æ”¶åˆ°ç›¸åº”é€šçŸ¥æ¶ˆæ¯æ—¶ï¼Œåœ¨å±å¹•é¡¶éƒ¨å±•ç¤ºä¸€ä¸ªé€šçŸ¥ï¼ˆå¹¶éç³»ç»ŸNotificationï¼‰ã€‚ç”±äºç§ç§åŸå› ï¼Œæœ€åæŠ€æœ¯é€‰å‹å°†åº”ç”¨å†…é€šçŸ¥é€‰æ‹©ä½œä¸ºä¸€ä¸ªactivityï¼Œä¹Ÿå°±æ˜¯åœ¨å½“å‰activityä¸Šå¼¹å‡ºä¸€ä¸ªèƒŒæ™¯é€æ˜çš„activityã€‚ç„¶åæˆ‘å‘ç°ä¸‹å±‚çš„activityåœ¨onPauseä¹‹åè°ƒç”¨äº†onSaveInstanceStateæ–¹æ³•ï¼Œwhyï¼Ÿéš¾é“onSaveInstanceStateä¸æ˜¯åœ¨activityå¼‚å¸¸é”€æ¯çš„æ—¶å€™æ‰ä¼šè°ƒç”¨å—ï¼Ÿæˆ‘ä»¬ç”¨onSaveInstanceStateæ¥ä¿å­˜activityçŠ¶æ€ï¼Œä½†æ˜¯onSaveInstanceStateçœŸæ­£çš„è°ƒç”¨æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿæœ¬æ–‡å°†å¯¹onSaveInstanceStateæ–¹æ³•çš„è°ƒç”¨æ—¶æœºä¸€æ¢ç©¶ç«Ÿã€‚</p><h2 id="onSaveInstanceStateä»‹ç»"><a href="#onSaveInstanceStateä»‹ç»" class="headerlink" title="onSaveInstanceStateä»‹ç»"></a>onSaveInstanceStateä»‹ç»</h2><p>é¦–å…ˆçœ‹ä¸€ä¸‹<a href="https://developer.android.com/reference/android/app/Activity.html#onSaveInstanceState%28android.os.Bundle%29" target="_blank" rel="noopener">onSaveInstanceState</a><br>å®˜æ–¹APIä»‹ç»ã€‚</p><blockquote><p>Called to retrieve per-instance state from an activity before being killed so that the state can be restored in onCreate(Bundle) or onRestoreInstanceState(Bundle) (the Bundle populated by this method will be passed to both).</p></blockquote><blockquote><p>This method is called before an activity may be killed so that when it comes back some time in the future it can restore its state. For example, if activity B is launched in front of activity A, and at some point activity A is killed to reclaim resources, activity A will have a chance to save the current state of its user interface via this method so that when the user returns to activity A, the state of the user interface can be restored via onCreate(Bundle) or onRestoreInstanceState(Bundle).</p></blockquote><blockquote><p>Do not confuse this method with activity lifecycle callbacks such as onPause(), which is always called when an activity is being placed in the background or on its way to destruction, or onStop() which is called before destruction. One example of when onPause() and onStop() is called and not this method is when a user navigates back from activity B to activity A: there is no need to call onSaveInstanceState(Bundle) on B because that particular instance will never be restored, so the system avoids calling it. An example when onPause() is called and not onSaveInstanceState(Bundle) is when activity B is launched in front of activity A: the system may avoid calling onSaveInstanceState(Bundle) on activity A if it isnâ€™t killed during the lifetime of B since the state of the user interface of A will stay intact.</p></blockquote><blockquote><p>The default implementation takes care of most of the UI per-instance state for you by calling onSaveInstanceState() on each view in the hierarchy that has an id, and by saving the id of the currently focused view (all of which is restored by the default implementation of onRestoreInstanceState(Bundle)). If you override this method to save additional information not captured by each individual view, you will likely want to call through to the default implementation, otherwise be prepared to save all of the state of each view yourself.</p></blockquote><blockquote><p>If called, this method will occur after onStop() for applications targeting platforms starting with P. For applications targeting earlier platform versions this method will occur before onStop() and there are no guarantees about whether it will occur before or after onPause().</p></blockquote><p>ä»‹ç»æœ‰ç‚¹é•¿ï¼Œæˆ‘ç¿»è¯‘äº†ä¸€ä¸‹ï¼š</p><blockquote><p>åœ¨acitivtyè¢«é”€æ¯ä¹‹å‰ï¼Œè¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œç”¨æ¥å­˜å‚¨æ¯ä¸ªå®ä¾‹çš„çŠ¶æ€ã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨Bundleä¸­ï¼Œé€šè¿‡onCreate(Bundle)æˆ–è€…onRestoreInstanceState(Bundle)æ–¹æ³•æ¢å¤å®ä¾‹çš„çš„çŠ¶æ€ã€‚</p></blockquote><blockquote><p>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨activityå¯èƒ½è¢«é”€æ¯ä¹‹å‰è°ƒç”¨ï¼Œå¦‚æœå°†æ¥activityå›åˆ°äº†å‰å°ï¼Œå°±å¯ä»¥æ¢å¤å®ƒçš„çŠ¶æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœactivity Aæ‰“å¼€äº†Activity Bï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¸ºäº†å›æ”¶èµ„æºè€Œå¯¼è‡´Acitvity Aè¢«é”€æ¯ï¼Œé‰´äºæœ‰è¿™ç§æƒ…å†µå‡ºç°ï¼Œé‚£ä¹ˆä¸ºäº†èƒ½è®©ç”¨æˆ·åœ¨å°†æ¥å†æ¬¡å›åˆ°Acitivty Aæ—¶ä»ç„¶èƒ½å¤Ÿçœ‹åˆ°ä¹‹å‰çš„äº¤äº’ä¿¡æ¯ï¼Œå°±ä¼šè°ƒç”¨onSaveInstanceStateæ–¹æ³•ä¿å­˜activityçš„çŠ¶æ€ã€‚é€šè¿‡onCreate(Bundle)æˆ–è€…onRestoreInstanceState(Bundle)æ–¹æ³•æ¢å¤å®ä¾‹çš„çš„çŠ¶æ€ã€‚</p></blockquote><blockquote><p>ä¸è¦æŠŠè¿™ä¸ªæ–¹æ³•ä¸activityç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸€äº›æ–¹æ³•æ··æ·†äº†ï¼ŒonPause()ä¼šåœ¨acitivityä¸”åå°çš„æ—¶å€™è¢«è°ƒç”¨ã€‚ä»€ä¹ˆæ—¶å€™onPauseå’ŒonStopä¼šè°ƒç”¨ï¼Œä½†æ˜¯onSaveInstanseStateä¸ä¼šè°ƒç”¨å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œå½“ä»Activity Bå›åˆ°Activity Aåï¼Œç”±äºBçš„çŠ¶æ€ä¸éœ€è¦ä¿å­˜äº†ï¼Œæ‰€ä»¥ç³»ç»Ÿå°±ä¸ä¼šè°ƒç”¨onSaveInstanseStateæ–¹æ³•äº†ã€‚ä»€ä¹ˆæ—¶å€™onPauseä¼šè°ƒç”¨ä½†æ˜¯onSaveInstanseStateä¸ä¼šè°ƒç”¨å‘¢ï¼Ÿå½“Activity Aä¸Šæ‰“å¼€äº†Activity Båï¼Œå¦‚æœAåœ¨Bçš„ç”Ÿå‘½å‘¨æœŸå†…ä¸ä¼šè¢«é”€æ¯ï¼Œé‚£ä¹ˆAå°±ä¸ä¼šè°ƒç”¨onSaveInstanceStateæ–¹æ³•ï¼ŒAçš„ç”¨æˆ·äº¤äº’ä¿¡æ¯ä»å°†ä¿æŒå®Œæ•´æ€§ã€‚</p></blockquote><blockquote><p>è¯¥æ–¹æ³•çš„é»˜è®¤å®ç°å­˜å‚¨äº†å¤§éƒ¨åˆ†UIçš„çŠ¶æ€ï¼Œå­˜å‚¨äº†æ¯ä¸ªviewåŠå…¶å¯¹åº”çš„idï¼ˆé€šè¿‡onRestoreInstanceStateçš„é»˜è®¤å®ç°å¯ä»¥å°†å­˜å‚¨çš„ä¿¡æ¯æ¢å¤å‡ºæ¥ï¼‰ã€‚å¦‚æœä½ è¦†ç›–äº†è¿™ä¸ªæ–¹æ³•ï¼Œæƒ³åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¤–æ·»åŠ ä¸€äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆæœ€å¥½è°ƒç”¨ä¸‹é»˜è®¤å®ç°ï¼ˆsuper. onSaveInstanseStateï¼‰,å¦åˆ™ä½ å°±è¦è‡ªå·±æ¥æ‰‹åŠ¨å­˜å‚¨æ‰€æœ‰viewçš„çŠ¶æ€äº†ã€‚<br>ä»android På¼€å§‹ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨onStop()ä¹‹åè¢«è°ƒç”¨ã€‚å¯¹äºç‰ˆæœ¬è¾ƒä½çš„ç³»ç»Ÿï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨onStopä¹‹å‰è°ƒç”¨ï¼Œæ— æ³•ä¿è¯ä¸onPauseçš„å…ˆåè°ƒç”¨é¡ºåºã€‚</p></blockquote><p>è™½ç„¶è¿™æ®µå†…å®¹å¾ˆé•¿ï¼Œä½†æ˜¯éƒ½æ˜¯æ»¡æ»¡çš„å¹²è´§ã€‚å¤§éƒ¨åˆ†ä¹Ÿéƒ½å¾ˆå¥½ç†è§£ï¼Œä¸è¿‡æˆ‘å¯¹ä¸‹é¢è¿™å¥è¯ä¸€ç›´å­˜åœ¨ç–‘é—®ï¼Œ</p><blockquote><p>An example when onPause() is called and not onSaveInstanceState(Bundle) is when activity B is launched in front of activity A: the system may avoid calling onSaveInstanceState(Bundle) on activity A if it isnâ€™t killed during the lifetime of B since the state of the user interface of A will stay intact.</p></blockquote><p>Activity Aæ‰“å¼€äº†Activity Bï¼ŒçœŸçš„å¯ä»¥ä¿è¯Activity Aåœ¨Activity Bçš„ç”Ÿå‘½å‘¨æœŸå†…ç»å¯¹ä¸ä¼šè¢«æ€å—ï¼Ÿå¦‚ä½•ç»å¯¹ä¿è¯å‘¢ï¼Ÿå¦‚æœæ— æ³•ä¿è¯ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šè°ƒç”¨onSaveInstanceStateå§ã€‚</p><p>ç®€å•æ¥è¯´ï¼ŒonSaveInstanceStateä½œç”¨å°±æ˜¯åœ¨activityå¯èƒ½è¢«é”€æ¯æ—¶è¢«è°ƒç”¨æ¥å­˜å‚¨activityçš„çŠ¶æ€ï¼Œç„¶åå¯ä»¥åœ¨onCreateæˆ–è€…onRestoreInstanceStateä¸­æ¢å¤è¿™äº›ä¿¡æ¯ã€‚</p><p>å…¶å®ä¸Šé¢çš„ä»‹ç»å·²ç»æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜äº†è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æ—¶æœºï¼Œå³ï¼š</p><blockquote><p>ä»android På¼€å§‹ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨onStop()ä¹‹åè¢«è°ƒç”¨ã€‚å¯¹äºç‰ˆæœ¬è¾ƒä½çš„ç³»ç»Ÿï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨onStopä¹‹å‰è°ƒç”¨ï¼Œæ— æ³•ä¿è¯ä¸onPauseçš„å…ˆåè°ƒç”¨é¡ºåºã€‚</p></blockquote><p>æˆ‘ä»¬ç°åœ¨ä»æºç çš„è§’åº¦éªŒè¯è¿™ä¸€è§‚ç‚¹ã€‚æˆ‘ä»¬éªŒè¯çš„ç‰ˆæœ¬æ˜¯Android 8.0ï¼ˆAPI 26ï¼‰ï¼š</p><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹Activity.javaä¸­çš„onSaveInstanceStateæ–¹æ³•å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Activity.java</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;</span><br><span class="line">    outState.putBundle(WINDOW_HIERARCHY_TAG, mWindow.saveHierarchyState());</span><br><span class="line"></span><br><span class="line">    outState.putInt(LAST_AUTOFILL_ID, mLastAutofillId);</span><br><span class="line">    Parcelable p = mFragments.saveAllState();</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        outState.putParcelable(FRAGMENTS_TAG, p);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mAutoFillResetNeeded) &#123;</span><br><span class="line">        outState.putBoolean(AUTOFILL_RESET_NEEDED, <span class="keyword">true</span>);</span><br><span class="line">        getAutofillManager().onSaveInstanceState(outState);</span><br><span class="line">    &#125;</span><br><span class="line">    getApplication().dispatchActivitySaveInstanceState(<span class="keyword">this</span>, outState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¤§æ¦‚å¯ä»¥çœ‹åˆ°onSaveInstanceStateè¿™ä¸ªæ–¹æ³•ä¿å­˜äº†uiçš„ä¿¡æ¯å’Œfragmentçš„çŠ¶æ€ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸‹activity<br>ä¸­è°ƒç”¨è¯¥æ–¹æ³•çš„åœ°æ–¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Activity.java</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">performSaveInstanceState</span><span class="params">(Bundle outState)</span> </span>&#123;</span><br><span class="line">    onSaveInstanceState(outState);</span><br><span class="line">    saveManagedDialogs(outState);</span><br><span class="line">    mActivityTransitionState.saveState(outState);</span><br><span class="line">    storeHasCurrentPermissionRequest(outState);</span><br><span class="line">    <span class="keyword">if</span> (DEBUG_LIFECYCLE) Slog.v(TAG, <span class="string">"onSaveInstanceState "</span> + <span class="keyword">this</span> + <span class="string">": "</span> + outState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Activityçš„performSaveInstanceStateæ–¹æ³•æ˜¯ç”±Instrumentationçš„callActivityOnSaveInstanceStateæ–¹æ³•è°ƒç”¨çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Instrumentation.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callActivityOnSaveInstanceState</span><span class="params">(Activity activity, Bundle outState)</span> </span>&#123;</span><br><span class="line">    activity.performSaveInstanceState(outState);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Instrumentationçš„callActivityOnSaveInstanceStateæ–¹æ³•æ˜¯ç”±ActivityThreadçš„callCallActivityOnSaveInstanceStateæ–¹æ³•è°ƒç”¨çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ActivityThread.java</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callCallActivityOnSaveInstanceState</span><span class="params">(ActivityClientRecord r)</span> </span>&#123;</span><br><span class="line">    r.state = <span class="keyword">new</span> Bundle();</span><br><span class="line">    r.state.setAllowFds(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (r.isPersistable()) &#123;</span><br><span class="line">        r.persistentState = <span class="keyword">new</span> PersistableBundle();</span><br><span class="line">        mInstrumentation.callActivityOnSaveInstanceState(r.activity, r.state,</span><br><span class="line">                r.persistentState);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mInstrumentation.callActivityOnSaveInstanceState(r.activity, r.state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å››å¤„è°ƒç”¨äº†callCallActivityOnSaveInstanceStateæ–¹æ³•ï¼š</p><p><img src="/images/1.png" alt="&quot;callCallActivityOnSaveInstanceStateè°ƒç”¨&quot;"></p><p>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹è¿™å››ä¸ªæ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬æ‰çŸ¥é“activityåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼š</p><ul><li>performPauseActivity</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Bundle <span class="title">performPauseActivity</span><span class="params">(ActivityClientRecord r, <span class="keyword">boolean</span> finished,</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">boolean</span> saveState, String reason)</span> </span>&#123;</span><br><span class="line">       ...</span><br><span class="line">       <span class="keyword">if</span> (finished) &#123;</span><br><span class="line">           r.activity.mFinished = <span class="keyword">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Next have the activity save its current state and managed dialogs...</span></span><br><span class="line">       <span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; saveState) &#123;</span><br><span class="line">           callCallActivityOnSaveInstanceState(r);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       performPauseActivityIfNeeded(r, reason);</span><br><span class="line"></span><br><span class="line">       ...</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> !r.activity.mFinished &amp;&amp; saveState ? r.state : <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>åœ¨performPauseActivityæ–¹æ³•ä¸­ï¼Œå¦‚æœ<code>!r.activity.mFinished &amp;&amp; saveState</code>ä¸ºtrueï¼Œåˆ™ä¼šæ‰§è¡ŒcallCallActivityOnSaveInstanceStateæ–¹æ³•ï¼Œç„¶åæ‰ä¼šæ‰§è¡ŒperformPauseActivityIfNeededæ–¹æ³•ï¼Œåœ¨performPauseActivityIfNeededæ–¹æ³•é‡Œï¼Œè°ƒç”¨äº†activity<br>çš„onPauseæ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡æœ€å¼€å§‹ä»‹ç»äº†è§£åˆ°ï¼ŒonSaveInstanceStateæ–¹æ³•çš„æ‰§è¡Œæ—¶æœºä¸onPauseæ²¡æœ‰å¿…ç„¶è”ç³»ï¼Œä½†æ˜¯è¿™æ®µä»£ç å´æ˜¯åœ¨onPauseä¹‹å‰æ‰§è¡Œçš„ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹çŸ›ç›¾ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹<code>!r.activity.mFinished &amp;&amp; saveState</code>ç©¶ç«Ÿä»€ä¹ˆæ—¶å€™ä¸ºtrueã€‚é¦–å…ˆçœ‹ä¸€ä¸‹<code>r.activity.mFinished</code>è¿™ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡åœ¨activity<br>æ˜ç¡®è¦finishçš„æ—¶å€™ä¸ºtrueï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨äº†finish()æ–¹æ³•ï¼›å†çœ‹ä¸€ä¸‹saveStateå˜é‡ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼Œæˆ‘ä»¬è¿½æº¯çš„è¿™ä¸ªå˜é‡çš„æºå¤´å¯ä»¥å‘ç°saveStateå˜é‡å³æ˜¯<code>activity.getApplicationInfo().targetSdkVersion &lt; android.os.Build.VERSION_CODES.HONEYCOMB</code>çš„å€¼ï¼Œå³åˆ¤æ–­targetSdkVersionæ˜¯å¦å°äº11ã€‚æ‰€ä»¥åˆ°ç°åœ¨æˆ‘ä»¬å°±çŸ¥é“äº†ï¼Œå¦‚æœæˆ‘ä»¬çš„targetSdkVersionå°äº11ï¼Œé‚£ä¹ˆonSaveInstanceStateæ–¹æ³•ç¡®å®å¯èƒ½åœ¨onPauseä¹‹å‰è°ƒç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å‡ ä¹æ‰€æœ‰é¡¹ç›®çš„targetSdkVersionéƒ½å¤§äº11ï¼Œæ‰€ä»¥å…¶å®å‡ ä¹ä¸ä¼šåœ¨è¯¥æ—¶å€™è°ƒç”¨onSaveInstanceæ–¹æ³•ã€‚</p><ul><li>performStopActivityInner</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performStopActivityInner</span><span class="params">(ActivityClientRecord r,</span></span></span><br><span class="line"><span class="function"><span class="params">         StopInfo info, <span class="keyword">boolean</span> keepShown, <span class="keyword">boolean</span> saveState, String reason)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (localLOGV) Slog.v(TAG, <span class="string">"Performing stop of "</span> + r);</span><br><span class="line">     <span class="keyword">if</span> (r != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (!keepShown &amp;&amp; r.stopped) &#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">         <span class="comment">// One must first be paused before stopped...</span></span><br><span class="line">         performPauseActivityIfNeeded(r, reason);</span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Next have the activity save its current state and managed dialogs...</span></span><br><span class="line">         <span class="keyword">if</span> (!r.activity.mFinished &amp;&amp; saveState) &#123;</span><br><span class="line">             <span class="keyword">if</span> (r.state == <span class="keyword">null</span>) &#123;</span><br><span class="line">                 callCallActivityOnSaveInstanceState(r);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (!keepShown) &#123;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 <span class="comment">// Now we are idle.</span></span><br><span class="line">                 r.activity.performStop(<span class="keyword">false</span> <span class="comment">/*preserveWindow*/</span>);</span><br><span class="line">             &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                 <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</span><br><span class="line">                     <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                             <span class="string">"Unable to stop activity "</span></span><br><span class="line">                             + r.intent.getComponent().toShortString()</span><br><span class="line">                             + <span class="string">": "</span> + e.toString(), e);</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">             r.stopped = <span class="keyword">true</span>;</span><br><span class="line">             EventLog.writeEvent(LOG_AM_ON_STOP_CALLED, UserHandle.myUserId(),</span><br><span class="line">                     r.activity.getComponentName().getClassName(), reason);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°åœ¨performStopActivityInneræ–¹æ³•é‡Œé¦–å…ˆæ‰§è¡Œäº†performPauseActivityIfNeededï¼Œå³å†æ¬¡ä¿è¯äº†åœ¨onStopä¹‹å‰ä¸€å®šä¼šè°ƒç”¨onPauseã€‚ç„¶ååˆ¤æ–­æ˜¯å¦åº”è¯¥è°ƒç”¨callCallActivityOnSaveInstanceStateï¼Œæœ€åæ‰§è¡Œ<code>r.activity.performStop(false /*preserveWindow*/);</code>ï¼Œå³è°ƒç”¨activity<br>çš„onStopã€‚é‚£ä¹ˆè¿™é‡Œçš„callCallActivityOnSaveInstanceStateåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ‰§è¡Œå‘¢ï¼Ÿ<code>r.activity.mFinished</code>å˜é‡ä¸ä¸Šé¢åˆ†æçš„ä¸€æ ·ï¼Œä½†æ˜¯saveStateæœ‰ä¸€äº›ä¸åŒï¼Œæˆ‘ä»¬æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¸ºtrueï¼Œ</p><p><img src="/images/2.png" alt="&quot;saveState&quot;"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ç¬¬äºŒä¸ªæ–¹æ³•è°ƒç”¨é‡Œï¼ŒsaveStateä¸ºtrueï¼Œè€Œä¸”è¯¥æ–¹æ³•æ˜¯ç”±handleStopActivityè°ƒç”¨çš„ï¼Œå³å½“å‡†å¤‡è°ƒç”¨activityçš„onStopæ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ActivityThread<br>çš„handleStopActivityæ–¹æ³•ï¼Œæ­¤æ—¶å¦‚æœ<code>r.activity.mFinished</code>ä¸ºfalseï¼Œä¼šè°ƒç”¨onSaveInstanceStateæ–¹æ³•ã€‚å…¶å®æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™çœ‹åˆ°çš„onSaveInstanceStateæ–¹æ³•è°ƒç”¨éƒ½æ˜¯åœ¨è¿™ä¸ªæ—¶å€™å‘ç”Ÿçš„ã€‚</p><ul><li>handleSleeping</li></ul><p>æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„ä»‹ç»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   // TODO: This method should be changed to use &#123;@link #performStopActivityInner&#125; to perform to</span><br><span class="line">    // stop operation on the activity to reduce code duplication and the chance of fixing a bug in</span><br><span class="line">    // one place and missing the other.</span><br><span class="line">    private void handleSleeping(IBinder token, boolean sleeping) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªæ–¹æ³•é‡Œçš„é€»è¾‘è·ŸperformStopActivityInneræ–¹æ³•é‡Œå·®ä¸å¤šï¼Œè€Œä¸”é€šè¿‡è¿™ä¸ªtodoæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°æœ¬èº«è¿™ä¸ªæ–¹æ³•é‡Œçš„é€»è¾‘å°±åº”è¯¥ä½¿ç”¨performStopActivityInneræ¥å®Œæˆã€‚æ‰€ä»¥å¯¹è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å°±ä¸åšè¿‡å¤šè§£é‡Šäº†ã€‚</p><ul><li>handleRelaunchActivity</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleRelaunchActivity</span><span class="params">(ActivityClientRecord tmp)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Need to ensure state is saved.</span></span><br><span class="line">      <span class="keyword">if</span> (!r.paused) &#123;</span><br><span class="line">          performPauseActivity(r.token, <span class="keyword">false</span>, r.isPreHoneycomb(), <span class="string">"handleRelaunchActivity"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (r.state == <span class="keyword">null</span> &amp;&amp; !r.stopped &amp;&amp; !r.isPreHoneycomb()) &#123;</span><br><span class="line">          callCallActivityOnSaveInstanceState(r);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      handleDestroyActivity(r.token, <span class="keyword">false</span>, configChanges, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line">      handleLaunchActivity(r, currentIntent, <span class="string">"handleRelaunchActivity"</span>);</span><br><span class="line"></span><br><span class="line">      ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>handleRelaunchActivityæ–¹æ³•ä¼šåœ¨activityé‡æ–°åˆ›å»ºæ—¶è°ƒç”¨ï¼Œä¾‹å¦‚æˆ‘ä»¬æ—‹è½¬äº†å±å¹•ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¦–å…ˆè°ƒç”¨äº†performPauseActivityæ–¹æ³•ï¼Œå³activity<br>çš„onPauseï¼Œç„¶åè°ƒç”¨callCallActivityOnSaveInstanceStateçŠ¯æ³•ï¼Œå³onSaveInstanceStateï¼Œç„¶åè°ƒç”¨handleDestroyActivityæ–¹æ³•å®Œæˆactivity<br>çš„é”€æ¯æ“ä½œã€‚ä¹ä¸€çœ‹æ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªï¼ŸonStopå‘¢ï¼Ÿåœ¨onSaveInstanceStateå’ŒonDestoryä¹‹é—´ä¸æ˜¯åº”è¯¥æœ‰ä¸ªonStopå—ï¼Ÿå…¶å®æ˜¯åœ¨handleDestroyActivityé‡Œé¢ï¼Œæˆ‘ä»¬ç®€å•çœ‹ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleDestroyActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finishing,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> getNonConfigInstance)</span> </span>&#123;</span><br><span class="line">        ActivityClientRecord r = performDestroyActivity(token, finishing,</span><br><span class="line">                configChanges, getNonConfigInstance);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> ActivityClientRecord <span class="title">performDestroyActivity</span><span class="params">(IBinder token, <span class="keyword">boolean</span> finishing,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> configChanges, <span class="keyword">boolean</span> getNonConfigInstance)</span> </span>&#123;</span><br><span class="line">        ActivityClientRecord r = mActivities.get(token);</span><br><span class="line">        Class&lt;? extends Activity&gt; activityClass = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (localLOGV) Slog.v(TAG, <span class="string">"Performing finish of "</span> + r);</span><br><span class="line">        <span class="keyword">if</span> (r != <span class="keyword">null</span>) &#123;</span><br><span class="line">            activityClass = r.activity.getClass();</span><br><span class="line">            r.activity.mConfigChangeFlags |= configChanges;</span><br><span class="line">            <span class="keyword">if</span> (finishing) &#123;</span><br><span class="line">                r.activity.mFinished = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            performPauseActivityIfNeeded(r, <span class="string">"destroy"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!r.stopped) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    r.activity.performStop(r.mPreserveWindow);  <span class="comment">// ***here</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (SuperNotCalledException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> e;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                                <span class="string">"Unable to stop activity "</span></span><br><span class="line">                                + safeToComponentShortString(r.intent)</span><br><span class="line">                                + <span class="string">": "</span> + e.toString(), e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                r.stopped = <span class="keyword">true</span>;</span><br><span class="line">                EventLog.writeEvent(LOG_AM_ON_STOP_CALLED, UserHandle.myUserId(),</span><br><span class="line">                        r.activity.getComponentName().getClassName(), <span class="string">"destroy"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">           ...</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                r.activity.mCalled = <span class="keyword">false</span>;</span><br><span class="line">                mInstrumentation.callActivityOnDestroy(r.activity);</span><br><span class="line">                <span class="keyword">if</span> (!r.activity.mCalled) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> SuperNotCalledException(</span><br><span class="line">                        <span class="string">"Activity "</span> + safeToComponentShortString(r.intent) +</span><br><span class="line">                        <span class="string">" did not call through to super.onDestroy()"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (r.window != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    r.window.closeAllPanels();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SuperNotCalledException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mInstrumentation.onException(r.activity, e)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                            <span class="string">"Unable to destroy activity "</span> + safeToComponentShortString(r.intent)</span><br><span class="line">                            + <span class="string">": "</span> + e.toString(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mActivities.remove(token);</span><br><span class="line">        StrictMode.decrementExpectedActivityCount(activityClass);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨performDestroyActivityæ–¹æ³•é‡Œï¼Œä¼šåˆ¤æ–­activtyçš„pauseå’ŒstopçŠ¶æ€æ˜¯å¦æ‰§è¡Œè¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæ‰§è¡Œå¯¹åº”ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•ï¼Œæœ€åè°ƒç”¨<code>mInstrumentation.callActivityOnDestroy(r.activity);</code>ï¼Œå³activity<br>çš„onDestoryæ–¹æ³•ã€‚<br>åˆ°è¿™é‡Œæˆ‘ä»¬åŸºæœ¬å°±åˆ†æå®Œäº†ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ï¼š</p><blockquote><p>åœ¨Android Pä¹‹å‰ï¼š<br>åœ¨targetSdkVersionå°äº11æ—¶ï¼Œå¦‚æœè¦æ‰§è¡ŒonSaveInstanceStateæ–¹æ³•ï¼Œåˆ™ä¼šåœ¨onPauseä¹‹å‰æ‰§è¡Œã€‚å½“targetSdkVersionå¤§äºç­‰äº11æ—¶ï¼Œæ˜¯åœ¨onPauseä¹‹åæ‰§è¡Œçš„ï¼Œä½†æ˜¯éƒ½ä¸€å®šä¼šåœ¨onStopä¹‹å‰ã€‚</p></blockquote><p>å½“ç„¶ï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸­æ‰€è¯´çš„ï¼Œåœ¨Android Pä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨onStop()ä¹‹åè¢«è°ƒç”¨ã€‚è¿™ä¸ªçš„åˆ†æä»¥åå¾…è¡¥å……ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘é¡¹ç›®ä¸­PMåŠ äº†ä¸ªéœ€æ±‚ï¼Œè¦åšä¸€ä¸ªAndroidåº”ç”¨å†…é€šçŸ¥ï¼Œå³å½“Appåœ¨å‰å°æ”¶åˆ°ç›¸åº”é€šçŸ¥æ¶ˆæ¯æ—¶ï¼Œåœ¨å±å¹•é¡¶éƒ¨å±•ç¤ºä¸€ä¸ªé€šçŸ¥ï¼ˆå¹¶éç³»ç»ŸNotificationï¼‰ã€‚ç”±äºç§ç§åŸå› ï¼Œæœ€åæŠ€æœ¯é€‰å‹å°†åº”ç”¨å†…é€šçŸ¥é€‰æ‹©ä½œä¸ºä¸€ä¸ªactivityï¼Œä¹Ÿå°±æ˜¯åœ¨å½“å‰activityä¸Šå¼¹å‡ºä¸€ä¸ªèƒŒæ™¯é€æ˜çš„a
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="æŠ€æœ¯" scheme="http://lisongda.com/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="onSaveInstanceState" scheme="http://lisongda.com/tags/onSaveInstanceState/"/>
    
  </entry>
  
</feed>
